webpackJsonp([2],{"3kzI":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("woOf"),o=r.n(i),n=r("mvHQ"),a=r.n(n),s=r("7+uW");const l=s.default.prototype.$isServer,p=(l||Number(document.documentMode),!l&&document.addEventListener?function(e,t,r){e&&t&&r&&e.addEventListener(t,r,!1)}:function(e,t,r){e&&t&&r&&e.attachEvent("on"+t,r)});!l&&document.removeEventListener;const c=[],d="@@clickoutsideContext";let u,m=0;function f(e,t,r){return function(i={},o={}){!(r&&r.context&&i.target&&o.target)||e.contains(i.target)||e.contains(o.target)||e===i.target||r.context.popperElm&&(r.context.popperElm.contains(i.target)||r.context.popperElm.contains(o.target))||(t.expression&&e[d].methodName&&r.context[e[d].methodName]?r.context[e[d].methodName]():e[d].bindingFn&&e[d].bindingFn())}}!s.default.prototype.$isServer&&p(document,"mousedown",e=>u=e),!s.default.prototype.$isServer&&p(document,"mouseup",e=>{c.forEach(t=>t[d].documentHandler(e,u))});var h={name:"tree-select",directives:{Clickoutside:{bind(e,t,r){c.push(e);const i=m++;e[d]={id:i,documentHandler:f(e,t,r),methodName:t.expression,bindingFn:t.value}},update(e,t,r){e[d].documentHandler=f(e,t,r),e[d].methodName=t.expression,e[d].bindingFn=t.value},unbind(e){let t=c.length;for(let r=0;r<t;r++)if(c[r][d].id===e[d].id){c.splice(r,1);break}delete e[d]}}},props:{size:String,value:{default:function(){return[]}},type:{type:String,default:"checkbox"},disabled:Boolean},data:function(){var e,t,r=this,i=this;return{nodes:(e=function(e){return("00"+e).substr((e+"").length)},t=new Array(5).fill("").map(function(t,i){return{name:"node-"+e(i),code:e(i)+"",open:!0,nocheck:"radio"===r.type,nextTier:new Array(5).fill("").map(function(t,o){return{name:"node-"+e(i)+e(o),code:e(i)+""+e(o),open:!0,nocheck:"radio"===r.type,nextTier:new Array(5).fill("").map(function(t,r){return{name:"node-"+e(i)+e(o)+e(r),code:e(i)+""+e(o)+e(r),open:!0,nextTier:[]}})}})}}),[{name:"全部",open:!0,nocheck:"radio"===r.type,nextTier:t}]),treeSetting:{check:{enable:!0,chkStyle:this.type,radioType:"all",chkboxType:{Y:"ps",N:"ps"}},view:{showIcon:!1,showLine:!1,showTitle:!1,dblClickExpand:!1},data:{key:{children:"nextTier",name:"name",title:"code"}},callback:{onExpand:function(){r.updateDropdown()},onCollapse:function(){r.updateDropdown()},onClick:function(e,t,r){!1===r.nocheck&&i.$refs.tree.ztreeObj.checkNode(r,!r.checked,!0,!0)},onCheck:function(){r.checkedNodes=r.$refs.tree.ztreeObj.getCheckedNodes().filter(function(e){return 3===e.level}),r.innerValue=r.checkedNodes.map(function(e){return e.code}),r.$emit("input","radio"===r.type?r.innerValue[0]:r.innerValue)}}},showDropdown:!1,dropdownWidth:0,checkedNodes:[],innerValue:[]}},computed:{inputValue:function(){return this.checkedNodes.length?1===this.checkedNodes.length?this.checkedNodes[0].name:this.checkedNodes[0].name+" 等"+(this.checkedNodes.length-1)+"个选项":""}},methods:{updateDropdown:function(){var e=this;this.calcLinearTreeNodes();var t=this.$el.getBoundingClientRect(),r=t.left,i=t.top+this.$el.offsetHeight;this.dropdownLeft=r,this.dropdownTop=i,window.innerHeight-(t.bottom+Math.min(400,40*this.linearTreeNodes.length+10))<0&&(i=t.top-Math.min(400,40*this.linearTreeNodes.length+10)),this.treeSelectDropdownEl.setAttribute("style","\n        width: "+(this.$el.offsetWidth+50)+"px;\n        top: "+i+"px;\n        left: "+r+"px;\n        height: "+(40*this.linearTreeNodes.length+10)+"px;\n      "),setTimeout(function(){e.$refs.scrollbar.update()},200)},updatePosition:function(){if(this.showDropdown){var e=this.$el.getBoundingClientRect(),t=e.left,r=e.top+this.$el.offsetHeight;this.dropdownLeft===t&&this.dropdownTop===r||this.updateDropdown()}},handleClickOutside:function(){this.toHideDropdown()},calcLinearTreeNodes:function(){var e=[];this.$refs.tree.ztreeObj.getNodes().forEach(function t(r){e.push(r),r.open&&r.nextTier&&r.nextTier.forEach(t)}),this.linearTreeNodes=e},checkNodesByCode:function(e){if(e&&e.length){var t=this.$refs.tree.ztreeObj,r=t.getNodes()[0];t.checkNode(r,!1,!0);var i=function(t,r){t.level<3?(t.nextTier.forEach(function(e){i(e,e.code)}),t.toBeChecked=t.nextTier.every(function(e){return e.toBeChecked})):t.toBeChecked=e.indexOf(r)>-1};i(r,""),(i=function(e){e.toBeChecked?t.checkNode(e,!0,!0):e.nextTier&&e.nextTier.forEach(function(e){i(e)})})(r)}},toShowDropdown:function(){var e=this;this.showDropdown=!0,this.updatePositionInterval=setInterval(function(){e.updatePosition()},200)},toHideDropdown:function(){this.showDropdown=!1,clearInterval(this.updatePositionInterval)},valueWatcher:function(e,t){if(a()(e)!==a()(t))if(e&&e.length){if(!Array.isArray(e)&&(e=[e]),e.length===this.innerValue.length&&this.innerValue.every(function(t){return e.indexOf(t)>-1}))return;this.checkNodesByCode(e),this.checkedNodes=this.$refs.tree.ztreeObj.getCheckedNodes().filter(function(e){return 3===e.level}),this.innerValue=this.checkedNodes.map(function(e){return e.code})}else this.$refs.tree.ztreeObj.checkAllNodes(!1),this.checkedNodes=[],this.innerValue=[]}},watch:{showDropdown:function(e){e&&this.updateDropdown()},value:function(e,t){this.valueWatcher(e,t)}},mounted:function(){var e=this;this.$nextTick(function(){e.treeSelectDropdownEl=e.$el.querySelector(".tree-select-dropdowm")}),document.addEventListener("scroll",this.updateDropdown),this.$nextTick(function(){e.valueWatcher(e.value,null)})},beforeDestroy:function(){document.removeEventListener("scroll",this.updateDropdown),clearInterval(this.updatePositionInterval)}},y={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.handleClickOutside,expression:"handleClickOutside"}],staticClass:"tree-select"},[r("el-input",{staticStyle:{width:"100%"},attrs:{readonly:"",disabled:e.disabled,value:e.inputValue,size:e.size,placeholder:"请选择"},nativeOn:{click:function(t){e.disabled||e.toShowDropdown()}}},[e.disabled?e._e():r("i",{staticClass:"el-input__icon el-icon-circle-close",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){t.stopPropagation(),e.$emit("input","radio"===e.type?null:[]),e.toHideDropdown()}},slot:"suffix"})]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.showDropdown,expression:"showDropdown"}],staticClass:"tree-select-dropdowm"},[r("el-scrollbar",{ref:"scrollbar",staticClass:"tree-select-scrollbar",attrs:{"wrap-class":"tree-select-scrollbar__wrap","view-class":"tree"}},[r("tree",{ref:"tree",attrs:{nodes:e.nodes,setting:e.treeSetting}})],1)],1)],1)},staticRenderFns:[]};var g={components:{treeSelect:r("VU/8")(h,y,!1,function(e){r("J79N")},null,null).exports},data:function(){var e=this;return{curService:JSON.parse(localStorage.curService),curEnterprise:JSON.parse(localStorage.curEnterprise),query:[],layoutTree:{},reportList:[],pagination:{page:1,pageSize:15,total:0,handleCurrentChange:function(t){e.pagination.page=t,e.getPagi()},pageSizeChange:function(){e.pagination.pageSize=v,e.getPagi()}},setReportDetailVisible:!1,setReportDetailForm:{}}},computed:{setReportDetailRules:function(){var e=this,t={reportName:[{required:!0,trigger:"blur",message:"请输入"}],taskType:[{required:!0,trigger:"blur",message:"请选择"}],rhythm:[{validator:function(t,r,i){return r?e.$util.RegExp.positiveInteger.test(r)?i():void i(new Error("请输入正整数")):i()},trigger:"blur"}]};return new Array(20).fill("").forEach(function(r,i){t["extend"+i]={validator:function(t,r,o){i>=e.setReportDetailForm.extendProperties.length&&o();var n=e.setReportDetailForm.extendProperties[i].field,a=e.setReportDetailForm.extendProperties[i].type,s=e.setReportDetailForm.condition[n];switch(a){case"STRING":return o();case"DATE":return!s||s.getTime||e.$util.RegExp.integerCheck.test(""+s)?o():o(new Error("请输入正确的日期"));case"DISTRICT":return!s||/^\d{6}$/.test(s+"")?o():o(new Error("请选择正确的区域"))}},trigger:"blur"}}),t}},methods:{getReportList:function(){var e=this;this.pagination.page=1;var t=[],r=[],i=2,n=function(){r.forEach(function(e){return e.reportServerCode=e.serverCode}),r=r.filter(function(e){return!t.find(function(t){return t.operaCode===e.operaCode&&t.reportServerCode===e.reportServerCode})}),e.reportListAll=[].concat(t).concat(r),e.pagination.total=e.reportListAll.length,e.getPagi()};this.$api.reportsGetReportsOperaCodeList().then(function(t){r=t||[],(e.query.reportName||e.query.taskType)&&(r=[]),r=r.filter(function(t){return(!e.query.reportServerCode||t.serverCode.indexOf(e.query.reportServerCode)>-1)&&(!e.query.operaCode||t.operaCode.indexOf(e.query.operaCode)>-1)}),!--i&&n()}),this.$api.reportsGetReportTaskList(o()({enterpriseCode:this.curEnterprise.code,serverCode:this.curService.code,page:1,count:999999999},this.query)).then(function(r){r.list.forEach(function(t){t.__operaValidity=t.operaValidity>0?e.$util.dateFormat(new Date(t.operaValidity)):"永久"}),t=r.list,!--i&&n()})},getPagi:function(){this.reportList=this.reportListAll.slice((this.pagination.page-1)*this.pagination.pageSize,this.pagination.page*this.pagination.pageSize)},setReportDetailToModal:function(e,t){var r=this;this.setReportDetailVisible=!0,this.$nextTick(function(){var i=o()({},e);i.forever=i.operaValidity<=0,i.condition=o()({},i.condition),i.validity=!!i.enterpriseCode,i.operaValidity=-1===i.operaValidity?-1:(new Date).getTime(),i.__isDetail=!!t,i.lastStartTime=i.startTime,r.setReportDetailForm=i})},setReportDetailSubmit:function(){var e=this;this.$refs.setReportDetail.validate(function(t){if(t){var r=o()({},e.setReportDetailForm);(r.extendProperties||[]).forEach(function(e){r.condition[e.field]?"DATE"===e.type&&(r.condition[e.field]=new Date(r.condition[e.field]).getTime()):delete r.condition[e.field]}),r.forever?r.operaValidity=-1:r.operaValidity=new Date(r.operaValidity).getTime(),r.validity?r.startTime=new Date(r.startTime).getTime():r.startTime=r.lastStartTime,r.serverCode=e.curService.code,r.enterpriseCode=e.curEnterprise.code,r.reportType=r.taskType,r.rhythm&&(r.rhythm=+r.rhythm),delete r.forever,delete r.__operaValidity,delete r.__isDetail,delete r.lastStartTime,r.executorType="execute",e.$api.reportsTestSyn(r).then(function(t){e.setReportDetailVisible=!1,e.$refs.setReportDetail.resetFields(),e.getReportList()})}})},activate:function(e){var t=this,r=o()({},e);r.validity=0===r.taskStatus,delete r.__operaValidity,delete r.__isDetail,r.reportType=r.taskType,this.$api.reportsTestSyn(r).then(function(e){t.getReportList()})}},mounted:function(){this.getReportList()}},k={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"report-setting-page"}},[r("div",{staticClass:"wrapper df dfv"},[r("div",{staticClass:"query-form df"},[r("el-form",{attrs:{inline:!0,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"任务类型",prop:"name"}},[r("el-select",{attrs:{size:"mini"},on:{change:e.getReportList},model:{value:e.query.taskType,callback:function(t){e.$set(e.query,"taskType",t)},expression:"query.taskType"}},[r("el-option",{attrs:{value:void 0,label:"全部"}},[e._v(e._s("全部"))]),e._v(" "),e._l([{name:"单次任务",value:"singleTask"},{name:"周期任务",value:"schecduled"}],function(t,i){return r("el-option",{key:i,attrs:{label:t.name,value:t.value}},[e._v(e._s(t.name))])})],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"报表名称",prop:"reportName"}},[r("el-input",{attrs:{size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getReportList(t)}},model:{value:e.query.reportName,callback:function(t){e.$set(e.query,"reportName",t)},expression:"query.reportName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"报表服务编码",prop:"reportServerCode"}},[r("el-input",{attrs:{size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getReportList(t)}},model:{value:e.query.reportServerCode,callback:function(t){e.$set(e.query,"reportServerCode",t)},expression:"query.reportServerCode"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"报表编码",prop:"operaCode"}},[r("el-input",{attrs:{size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getReportList(t)}},model:{value:e.query.operaCode,callback:function(t){e.$set(e.query,"operaCode",t)},expression:"query.operaCode"}})],1),e._v(" "),r("el-form-item",[r("el-button",{staticStyle:{"margin-left":"33px"},attrs:{type:"primary",size:"mini"},on:{click:e.getReportList}},[e._v("确认")]),e._v(" "),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.query={}}}},[e._v("清除")])],1)],1)],1),e._v(" "),r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.$apiLoading.reportsGetReportsOperaCodeList||e.$apiLoading.reportsGetReportTaskList,expression:"$apiLoading.reportsGetReportsOperaCodeList || $apiLoading.reportsGetReportTaskList"}],staticClass:"list df dfv"},[e._m(0),e._v(" "),r("div",{staticClass:"table-box df dfv"},[r("el-table",{attrs:{height:"100%",data:e.reportList}},[r("el-table-column",{attrs:{label:"报表编码",prop:"operaCode"}}),e._v(" "),r("el-table-column",{attrs:{label:"报表服务编码",prop:"reportServerCode"}}),e._v(" "),r("el-table-column",{attrs:{label:"报表名称",prop:"reportName",formatter:e.$tableFilter("nullFilter")}}),e._v(" "),r("el-table-column",{attrs:{label:"任务类型",prop:"taskType",formatter:e.$tableFilter("taskTypeFilter")}}),e._v(" "),r("el-table-column",{attrs:{label:"任务状态",prop:"taskStatus",formatter:e.$tableFilter("taskStatusFilter")}}),e._v(" "),r("el-table-column",{attrs:{label:"有效期",prop:"__operaValidity"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.enterpriseCode?r("label",[r("a",{staticClass:"icomoon pic-look",attrs:{title:"详情"},on:{click:function(r){return e.setReportDetailToModal(t.row,"detail")}}})]):e._e(),e._v(" "),r("label",[r("a",{staticClass:"icomoon pic-edit",attrs:{title:"修改"},on:{click:function(r){return e.setReportDetailToModal(t.row)}}})])]}}])})],1),e._v(" "),r("el-col",{staticClass:"toolbar",attrs:{span:24}},[r("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next,sizes, jumper","page-sizes":[10,15,50,100],"page-size":e.pagination.pageSize,total:e.pagination.total},on:{"current-change":e.pagination.handleCurrentChange,"size-change":e.pagination.pageSizeChange}})],1)],1)])]),e._v(" "),r("el-dialog",{staticClass:"m400",attrs:{title:e.setReportDetailForm.__isDetail?"详情":"报表任务修改","close-on-click-modal":!1,visible:e.setReportDetailVisible},on:{close:function(t){e.setReportDetailVisible=!1}}},[r("el-form",{ref:"setReportDetail",attrs:{model:e.setReportDetailForm,rules:e.setReportDetailRules,"label-width":"100px",disabled:e.setReportDetailForm.__isDetail}},[r("el-form-item",{attrs:{label:"报表名称",prop:"reportName"}},[r("el-input",{staticStyle:{width:"240px"},attrs:{size:"mini"},model:{value:e.setReportDetailForm.reportName,callback:function(t){e.$set(e.setReportDetailForm,"reportName",t)},expression:"setReportDetailForm.reportName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"任务类型",prop:"taskType"}},[r("el-select",{staticStyle:{width:"240px"},attrs:{size:"mini"},model:{value:e.setReportDetailForm.taskType,callback:function(t){e.$set(e.setReportDetailForm,"taskType",t)},expression:"setReportDetailForm.taskType"}},e._l([{name:"单次任务",value:"singleTask"},{name:"周期任务",value:"schecduled"}],function(t,i){return r("el-option",{key:i,attrs:{label:t.name,value:t.value}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),"schecduled"===e.setReportDetailForm.taskType?r("el-form-item",{attrs:{label:"节拍",prop:"rhythm"}},[r("el-input",{staticStyle:{width:"240px"},attrs:{size:"mini"},model:{value:e.setReportDetailForm.rhythm,callback:function(t){e.$set(e.setReportDetailForm,"rhythm",t)},expression:"setReportDetailForm.rhythm"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"有效期",prop:"operaValidity"}},[r("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:!e.setReportDetailForm.forever,expression:"!setReportDetailForm.forever"}],staticStyle:{width:"175px"},attrs:{type:"datetime",size:"mini",placeholder:"选择日期时间"},model:{value:e.setReportDetailForm.operaValidity,callback:function(t){e.$set(e.setReportDetailForm,"operaValidity",t)},expression:"setReportDetailForm.operaValidity"}}),e._v(" "),r("el-checkbox",{staticStyle:{"margin-left":"10px"},attrs:{label:"永久"},model:{value:e.setReportDetailForm.forever,callback:function(t){e.$set(e.setReportDetailForm,"forever",t)},expression:"setReportDetailForm.forever"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"是否有效",prop:"validity"}},[r("el-switch",{model:{value:e.setReportDetailForm.validity,callback:function(t){e.$set(e.setReportDetailForm,"validity",t)},expression:"setReportDetailForm.validity"}})],1),e._v(" "),e.setReportDetailForm.validity?r("el-form-item",{attrs:{label:"生效时间",prop:"startTime"}},[r("el-date-picker",{staticStyle:{width:"240px"},attrs:{type:"datetime",size:"mini",placeholder:"选择日期时间"},model:{value:e.setReportDetailForm.startTime,callback:function(t){e.$set(e.setReportDetailForm,"startTime",t)},expression:"setReportDetailForm.startTime"}})],1):e._e(),e._v(" "),e._l((e.setReportDetailForm.extendProperties||[]).filter(function(e){return"execute"===e.belongs}),function(t,i){return r("el-form-item",{key:i,attrs:{label:t.name,prop:"extend"+i}},["DATE"===t.type?r("el-date-picker",{staticStyle:{width:"240px"},attrs:{type:"datetime",size:"mini",placeholder:"选择日期时间"},model:{value:e.setReportDetailForm.condition[t.field],callback:function(r){e.$set(e.setReportDetailForm.condition,t.field,r)},expression:"setReportDetailForm.condition[item.field]"}}):e._e(),e._v(" "),"STRING"===t.type?r("el-input",{staticStyle:{width:"240px"},attrs:{size:"mini"},model:{value:e.setReportDetailForm.condition[t.field],callback:function(r){e.$set(e.setReportDetailForm.condition,t.field,r)},expression:"setReportDetailForm.condition[item.field]"}}):e._e(),e._v(" "),"DISTRICT"===t.type?r("tree-select",{staticStyle:{width:"240px"},attrs:{size:"mini",disabled:e.setReportDetailForm.__isDetail,type:"radio"},model:{value:e.setReportDetailForm.condition[t.field],callback:function(r){e.$set(e.setReportDetailForm.condition,t.field,r)},expression:"setReportDetailForm.condition[item.field]"}}):e._e()],1)})],2),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"mini",type:"default"},on:{click:function(t){e.setReportDetailVisible=!1}}},[e._v("取 消")]),e._v(" "),e.setReportDetailForm.__isDetail?e._e():r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.setReportDetailSubmit()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"list-header"},[t("h3",[this._v("活动告警列表")])])}]};var b=r("VU/8")(g,k,!1,function(e){r("P8sx")},"data-v-0edac7cd",null);t.default=b.exports},J79N:function(e,t){},P8sx:function(e,t){},mvHQ:function(e,t,r){e.exports={default:r("qkKv"),__esModule:!0}},qkKv:function(e,t,r){var i=r("FeBl"),o=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}}});