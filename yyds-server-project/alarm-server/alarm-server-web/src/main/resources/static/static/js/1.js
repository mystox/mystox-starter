webpackJsonp([1],{"5zde":function(e,t,n){n("zQR9"),n("qyJz"),e.exports=n("FeBl").Array.from},"6rjw":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("mvHQ"),o=n.n(i),r=n("//Fk"),s=n.n(r),a=n("woOf"),c=n.n(a),d=n("Gu7T"),l=n.n(d),h={data:function(){return{globleConfig:{row:24,column:20,contentWidth:0,contentHeight:0},curView:"0",lastView:"0",componentList:[],sceneList:new Array(10).fill("").map(function(e,t){return{name:"页面"+(t+1)}})}},computed:{gridWidth:function(){return this.globleConfig.contentWidth/this.globleConfig.column},gridHeight:function(){return this.globleConfig.contentHeight/this.globleConfig.row}},methods:{calcComponentsStyle:function(e){var t="";switch(e.state){case"standBy":break;case"inPage":t+="z-index: "+e.zIndex+";";break;case"transforming":t+="opacity: 0.7;",t+=e.valid||e.isDropping?"":"background: rgba(255,36,0, 0.5);",t+="z-index: "+e.zIndex+";";break;case"dropZone":t+="z-index: "+e.zIndex+";",t+="background: rgba(102, 170, 102, 0.5);"}return t},updateComponent:function(e){var t=this;!function e(n){n._dom.style.webkitTransform=n._dom.style.transform="translate("+n.pos.x*t.gridWidth+"px, "+n.pos.y*t.gridHeight+"px)",n._dom.style.width=n.size.width*t.gridWidth+"px",n._dom.style.height=n.size.height*t.gridHeight+"px",n.children.forEach(e)}(e)},conflictCheck:function(e){var t={pos:{x:0,y:this.globleConfig.row},size:{width:this.globleConfig.column,height:100}},n={pos:{x:this.globleConfig.column,y:0},size:{width:100,height:this.globleConfig.column}},i={pos:{x:0,y:-100},size:{width:this.globleConfig.column,height:100}},o={pos:{x:-100,y:0},size:{width:100,height:this.globleConfig.column}};return[].concat(l()(this.componentList),[t,n,i,o]).filter(function(t){if(e!==t){var n=e.size.width,i=t.size.width,o=e.size.height,r=t.size.height,s=e.pos.x+n/2,a=e.pos.y+o/2,c=t.pos.x+i/2,d=t.pos.y+r/2;return Math.abs(c-s)<n/2+i/2&&Math.abs(d-a)<o/2+r/2}})},setValidState:function(e,t){!function e(n){n.valid=t,n.children.forEach(e)}(e)},generateInteractInstance:function(e,t){var n=this,i=t.fromLoad,o={},r=i;this.$nextTick(function(){var t=document.getElementById("component-"+e.dId);e._dom=t,t._component=e,n.interact(t).draggable({modifiers:[n.interact.modifiers.snap({targets:[n.interact.createSnapGrid({x:n.gridWidth,y:n.gridHeight})],range:1/0,relativePoints:[{x:0,y:0}]})],inertia:!1}).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},modifiers:[n.interact.modifiers.restrictSize({min:{width:100,height:50}}),n.interact.modifiers.snapSize({targets:[n.interact.createSnapGrid({x:n.gridWidth,y:n.gridHeight})],range:1/0,relativePoints:[{x:0,y:0}]})],inertia:!1}).on("dragmove",function(t){r=!0;var i=Math.round(t.dx/n.gridWidth),o=Math.round(t.dy/n.gridHeight);!function e(t){t.pos.x+=i,t.pos.y+=o,n.updateComponent(t),t.children.forEach(e)}(e),n.setValidState(e,0===n.conflictCheck(e).length)}).on("resizemove",function(t){var i=Math.round(t.rect.width/n.gridWidth),o=Math.round(t.rect.height/n.gridHeight),r=!1,s=e.pos.x,a=e.pos.y;if(e.parent&&(r=!0,t.edges.top&&(a=e.pos.y+(e.size.height-o))<e.parent.pos.y&&(o+=a-e.parent.pos.y,a=e.parent.pos.y),t.edges.left&&(s=e.pos.x+(e.size.width-i))<e.parent.pos.x&&(i+=s-e.parent.pos.x,s=e.parent.pos.x),t.edges.bottom&&(o=Math.min(o,e.parent.size.height+e.parent.pos.y-e.pos.y)),t.edges.right&&(i=Math.min(i,e.parent.size.width+e.parent.pos.x-e.pos.x))),e.children.length>0){r=!0;var c=n.getComponentsRect(e.children);t.edges.top&&(a=e.pos.y+(e.size.height-o))>c[0]&&(o+=a-c[0],a=c[0]),t.edges.left&&(s=e.pos.x+(e.size.width-i))>c[3]&&(i+=s-c[3],s=c[3]),t.edges.bottom&&(o=Math.max(o,c[2]-e.pos.y)),t.edges.right&&(i=Math.max(i,c[1]-e.pos.x))}if(e.pos.y=a,e.pos.x=s,!r){if(t.edges.top){e.pos.y,e.size.height;e.pos.y+=e.size.height-o}t.edges.left&&(e.pos.x+=e.size.width-i)}e.size.width=i,e.size.height=o,n.updateComponent(e),n.setValidState(e,0===n.conflictCheck(e).length)}).on(["dragstart","resizestart"],function(t){o={};!function e(t,n){n.pos=c()({},t.pos),n.size=c()({},t.size),n.offset=t.offset,n.parent=t.parent,n.children=[],t.children.forEach(function(t){var i={};n.children.push(i),e(t,i)})}(e,o);!function e(t){t.zIndex=10+t.originZIndex,t.state="transforming",t.children.forEach(e)}(e)}).on(["dragend","resizeend"],function(t){n.$nextTick(function(){if(!e.valid&&!e.isDropping){if(o.pos.x<0&&o.pos.y<0)return void n.deleteComponent(e);!function e(t,n){t.pos.x=n.pos.x,t.pos.y=n.pos.y,t.size.width=n.size.width,t.size.height=n.size.height,t.offset=n.offset,t.parent=n.parent,t.parent&&!t.parent.children.find(function(e){return e===t})&&t.parent.children.push(t),n.children.forEach(function(n,i){e(t.children[i],n)})}(e,o),n.updateComponent(e),n.setValidState(e,!0)}!function e(t){t.zIndex=t.originZIndex,t.state="inPage",t.children.forEach(e)}(e)})}),t.style.transform="translate(0px, 0px)",n.updateComponent(e),i||(t.dispatchEvent(new PointerEvent("pointerdown",{bubbles:!0,clientX:50,clientY:120,pointerType:"mouse"})),setTimeout(function(){r||n.deleteComponent(e)},200))})},initComponent:function(e){var t={dId:e.id+"-"+Math.floor(1e3*Math.random()),valid:!0,isDropping:!1,zIndex:1,originZIndex:1,pos:{x:-1,y:-1},state:"standBy"};for(var n in t)e[n]=t[n];return e},createBackgroundPattern:function(){return new s.a(function(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=2,t.height=2,n.clearRect(0,0,2,2),n.fillStyle="rgba(255,255,255,0.05)",n.fillRect(0,0,1,1),n.fillRect(1,1,1,1),t.toBlob(function(t){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsDataURL(t)})})},startDragFromStandByPanel:function(e){var t=this.initComponent({id:(new Date).getTime()+"-"+Math.floor(1e3*Math.random()),size:{width:4,height:4},config:null,outputs:[],inputs:[],children:[],actionUrl:null,parent:null});this.componentList.push(t),this.generateInteractInstance(t,{})},deleteComponent:function(e){this.interact(e._dom).unset(),this.componentList.splice(this.componentList.indexOf(e),1)},exportScene:function(){return this.componentList.map(function(e){var t=c()({},e);return delete t._dom,delete t.dId,t})},save:function(){this.sceneList[this.curView].save=this.exportScene(),localStorage.setItem("customReportSave",o()(this.sceneList))},load:function(){var e=localStorage.getTime("customReportSave")||"[]";e=JSON.parse(e),this.sceneList=e},changeTab:function(e){var t=this;this.sceneList[this.lastView].save=this.exportScene(),this.componentList.forEach(function(e){return t.interact(e._dom).unset()}),this.componentList=this.sceneList[e.name].save||[],this.componentList.forEach(function(e){t.generateInteractInstance(e,{fromLoad:!0})}),this.lastView=e.name}},mounted:function(){var e=this;this.$nextTick(function(){e.__onWindowResize=function(){e.globleConfig.contentWidth=e.contentPanelDom.offsetWidth,e.globleConfig.contentHeight=e.contentPanelDom.offsetHeight},window.addEventListener("resize",e.__onWindowResize),e.contentPanelDom=document.querySelector("#custom_report_page .page-view"),e.__onWindowResize(),e.createBackgroundPattern().then(function(t){e.contentPanelDom.style="background-image: url("+t+"); background-size: "+200/e.globleConfig.column+"% "+200/e.globleConfig.row+"%;"})})},beforeDestory:function(){window.removeEventListen("resize",this.__onWindowResize)}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"custom_report_page"}},[n("div",{staticClass:"wrapper df dfv"},[n("el-tabs",{on:{"tab-click":e.changeTab},model:{value:e.curView,callback:function(t){e.curView=t},expression:"curView"}},e._l(e.sceneList,function(e,t){return n("el-tab-pane",{key:t,attrs:{label:e.name,name:t+""}})}),1),e._v(" "),n("div",{staticClass:"page-view"},e._l(e.componentList,function(t){return n("div",{key:t.dId,staticClass:"component",style:e.calcComponentsStyle(t),attrs:{id:"component-"+t.dId}},[n("span",[e._v("\n          x:"+e._s(t.pos.x)+" \n          y:"+e._s(t.pos.y)),n("br"),e._v("\n          w:"+e._s(t.size.width)+" \n          h:"+e._s(t.size.height)),n("br")]),e._v(" "),n("a",{staticStyle:{position:"absolute",top:"3px",right:"8px"},on:{click:function(n){return e.deleteComponent(t)}}},[e._v("×")])])}),0),e._v(" "),n("div",{staticClass:"stand-by-panel"},[n("div",{staticClass:"component",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:"button"in t&&0!==t.button?null:e.startDragFromStandByPanel(arguments[0])}}})])],1)])},staticRenderFns:[]};var u=n("VU/8")(h,f,!1,function(e){n("tQJm")},"data-v-7fd1f171",null);t.default=u.exports},Gu7T:function(e,t,n){"use strict";t.__esModule=!0;var i,o=n("c/Tr"),r=(i=o)&&i.__esModule?i:{default:i};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,r.default)(e)}},"c/Tr":function(e,t,n){e.exports={default:n("5zde"),__esModule:!0}},fBQ2:function(e,t,n){"use strict";var i=n("evD5"),o=n("X8DO");e.exports=function(e,t,n){t in e?i.f(e,t,o(0,n)):e[t]=n}},qyJz:function(e,t,n){"use strict";var i=n("+ZMJ"),o=n("kM2E"),r=n("sB3e"),s=n("msXi"),a=n("Mhyx"),c=n("QRG4"),d=n("fBQ2"),l=n("3fs2");o(o.S+o.F*!n("dY0y")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,o,h,f=r(e),u="function"==typeof this?this:Array,p=arguments.length,g=p>1?arguments[1]:void 0,m=void 0!==g,v=0,y=l(f);if(m&&(g=i(g,p>2?arguments[2]:void 0,2)),void 0==y||u==Array&&a(y))for(n=new u(t=c(f.length));t>v;v++)d(n,v,m?g(f[v],v):f[v]);else for(h=y.call(f),n=new u;!(o=h.next()).done;v++)d(n,v,m?s(h,g,[o.value,v],!0):o.value);return n.length=v,n}})},tQJm:function(e,t){}});
//# sourceMappingURL=1.js.map