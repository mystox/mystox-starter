webpackJsonp([1],{"5zde":function(t,e,n){n("zQR9"),n("qyJz"),t.exports=n("FeBl").Array.from},"6rjw":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("mvHQ"),o=n.n(i),s=n("//Fk"),r=n.n(s),a=n("woOf"),c=n.n(a),d=n("Gu7T"),l=n.n(d),u={name:"report-component",render:function(t){return t("div",[t("h3",{class:"report-header"},this.prop.name),t("div",{attrs:{id:"echart-"+this.prop.dId},class:"chart-dom"})])},props:{prop:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{},mounted:function(){}};var p={components:{ReportComponent:n("VU/8")(u,null,!1,function(t){n("cDlZ")},"data-v-750273e5",null).exports},data:function(){return{globleConfig:{row:24,column:20,contentWidth:0,contentHeight:0},curView:"0",lastView:"0",componentList:[],sceneList:new Array(10).fill("").map(function(t,e){return{name:"页面"+(e+1),editValue:"页面"+(e+1)}})}},computed:{gridWidth:function(){return this.globleConfig.contentWidth/this.globleConfig.column},gridHeight:function(){return this.globleConfig.contentHeight/this.globleConfig.row}},methods:{calcComponentsStyle:function(t){var e="";switch(t.state){case"standBy":break;case"inPage":e+="z-index: "+t.zIndex+";";break;case"transforming":e+="opacity: 0.7;",e+=t.valid||t.isDropping?"":"background: rgba(255,36,0, 0.5);",e+="z-index: "+t.zIndex+";";break;case"dropZone":e+="z-index: "+t.zIndex+";",e+="background: rgba(102, 170, 102, 0.5);"}return e},updateComponent:function(t){var e=this;!function t(n){n._dom.style.webkitTransform=n._dom.style.transform="translate("+n.pos.x*e.gridWidth+"px, "+n.pos.y*e.gridHeight+"px)",n._dom.style.width=n.size.width*e.gridWidth+"px",n._dom.style.height=n.size.height*e.gridHeight+"px",n.children.forEach(t)}(t)},conflictCheck:function(t){var e={pos:{x:0,y:this.globleConfig.row},size:{width:this.globleConfig.column,height:100}},n={pos:{x:this.globleConfig.column,y:0},size:{width:100,height:this.globleConfig.column}},i={pos:{x:0,y:-100},size:{width:this.globleConfig.column,height:100}},o={pos:{x:-100,y:0},size:{width:100,height:this.globleConfig.column}};return[].concat(l()(this.componentList),[e,n,i,o]).filter(function(e){if(t!==e){var n=t.size.width,i=e.size.width,o=t.size.height,s=e.size.height,r=t.pos.x+n/2,a=t.pos.y+o/2,c=e.pos.x+i/2,d=e.pos.y+s/2;return Math.abs(c-r)<n/2+i/2&&Math.abs(d-a)<o/2+s/2}})},setValidState:function(t,e){!function t(n){n.valid=e,n.children.forEach(t)}(t)},generateInteractInstance:function(t,e){var n=this,i=e.fromLoad,o={},s=i;this.$nextTick(function(){var e=document.getElementById("component-"+t.dId);t._dom=e,e._component=t,n.interact(e).draggable({modifiers:[n.interact.modifiers.snap({targets:[n.interact.createSnapGrid({x:n.gridWidth,y:n.gridHeight})],range:1/0,relativePoints:[{x:0,y:0}]})],inertia:!1}).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},modifiers:[n.interact.modifiers.restrictSize({min:{width:100,height:50}}),n.interact.modifiers.snapSize({targets:[n.interact.createSnapGrid({x:n.gridWidth,y:n.gridHeight})],range:1/0,relativePoints:[{x:0,y:0}]})],inertia:!1}).on("dragmove",function(e){s=!0;var i=Math.round(e.dx/n.gridWidth),o=Math.round(e.dy/n.gridHeight);!function t(e){e.pos.x+=i,e.pos.y+=o,n.updateComponent(e),e.children.forEach(t)}(t),n.setValidState(t,0===n.conflictCheck(t).length)}).on("resizemove",function(e){var i=Math.round(e.rect.width/n.gridWidth),o=Math.round(e.rect.height/n.gridHeight),s=!1,r=t.pos.x,a=t.pos.y;if(t.parent&&(s=!0,e.edges.top&&(a=t.pos.y+(t.size.height-o))<t.parent.pos.y&&(o+=a-t.parent.pos.y,a=t.parent.pos.y),e.edges.left&&(r=t.pos.x+(t.size.width-i))<t.parent.pos.x&&(i+=r-t.parent.pos.x,r=t.parent.pos.x),e.edges.bottom&&(o=Math.min(o,t.parent.size.height+t.parent.pos.y-t.pos.y)),e.edges.right&&(i=Math.min(i,t.parent.size.width+t.parent.pos.x-t.pos.x))),t.children.length>0){s=!0;var c=n.getComponentsRect(t.children);e.edges.top&&(a=t.pos.y+(t.size.height-o))>c[0]&&(o+=a-c[0],a=c[0]),e.edges.left&&(r=t.pos.x+(t.size.width-i))>c[3]&&(i+=r-c[3],r=c[3]),e.edges.bottom&&(o=Math.max(o,c[2]-t.pos.y)),e.edges.right&&(i=Math.max(i,c[1]-t.pos.x))}if(t.pos.y=a,t.pos.x=r,!s){if(e.edges.top){t.pos.y,t.size.height;t.pos.y+=t.size.height-o}e.edges.left&&(t.pos.x+=t.size.width-i)}t.size.width=i,t.size.height=o,n.updateComponent(t),n.setValidState(t,0===n.conflictCheck(t).length)}).on(["dragstart","resizestart"],function(e){o={};!function t(e,n){n.pos=c()({},e.pos),n.size=c()({},e.size),n.offset=e.offset,n.parent=e.parent,n.children=[],e.children.forEach(function(e){var i={};n.children.push(i),t(e,i)})}(t,o);!function t(e){e.zIndex=10+e.originZIndex,e.state="transforming",e.children.forEach(t)}(t)}).on(["dragend","resizeend"],function(e){n.$nextTick(function(){if(!t.valid&&!t.isDropping){if(o.pos.x<0&&o.pos.y<0)return void n.deleteComponent(t);!function t(e,n){e.pos.x=n.pos.x,e.pos.y=n.pos.y,e.size.width=n.size.width,e.size.height=n.size.height,e.offset=n.offset,e.parent=n.parent,e.parent&&!e.parent.children.find(function(t){return t===e})&&e.parent.children.push(e),n.children.forEach(function(n,i){t(e.children[i],n)})}(t,o),n.updateComponent(t),n.setValidState(t,!0)}!function t(e){e.zIndex=e.originZIndex,e.state="inPage",e.children.forEach(t)}(t)})}),e.style.transform="translate(0px, 0px)",n.updateComponent(t),i||(e.dispatchEvent(new PointerEvent("pointerdown",{bubbles:!0,clientX:50,clientY:150,pointerType:"mouse"})),setTimeout(function(){s||n.deleteComponent(t)},200))})},initComponent:function(t){var e={dId:t.id+"-"+Math.floor(1e3*Math.random()),valid:!0,isDropping:!1,zIndex:1,originZIndex:1,pos:{x:-1,y:-1},state:"standBy"};for(var n in e)t[n]=e[n];return t},createBackgroundPattern:function(){return new r.a(function(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=2,e.height=2,n.clearRect(0,0,2,2),n.fillStyle="rgba(255,255,255,0.05)",n.fillRect(0,0,1,1),n.fillRect(1,1,1,1),e.toBlob(function(e){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)})})},startDragFromStandByPanel:function(t,e){var n=this.initComponent(c()(e,{id:(new Date).getTime()+"-"+Math.floor(1e3*Math.random()),size:{width:4,height:4},config:null,outputs:[],inputs:[],children:[],actionUrl:null,parent:null}));this.componentList.push(n),this.generateInteractInstance(n,{})},deleteComponent:function(t){this.interact(t._dom).unset(),this.componentList.splice(this.componentList.indexOf(t),1)},exportScene:function(){return this.componentList.map(function(t){var e=c()({},t);return delete e._dom,delete e.dId,e})},save:function(){this.sceneList[this.curView].save=this.exportScene(),localStorage.setItem("customReportSave",o()(this.sceneList))},load:function(){var t=localStorage.getTime("customReportSave")||"[]";t=JSON.parse(t),this.sceneList=t},changeTab:function(t){var e=this;this.sceneList[this.lastView].save=this.exportScene(),this.componentList.forEach(function(t){return e.interact(t._dom).unset()}),this.componentList=this.sceneList[t].save||[],this.componentList.forEach(function(t){e.generateInteractInstance(t,{fromLoad:!0})}),this.lastView=t},startEditTabName:function(t,e){this.$set(t,"onEdit",!0);var n=document.querySelectorAll("#custom-report-tabs .el-tabs__item")[e],i=n.querySelector("input");i.setAttribute("style","width: "+(n.offsetWidth-40)+"px;"),i.select()},deleteTab:function(t,e){this.curView!==e&&this.lastView!==e||(this.lastView=null),this.sceneList.splice(e,1)}},mounted:function(){var t=this;this.$nextTick(function(){t.__onWindowResize=function(){t.globleConfig.contentWidth=t.contentPanelDom.offsetWidth,t.globleConfig.contentHeight=t.contentPanelDom.offsetHeight,t.componentList.forEach(function(e){t.updateComponent(e)})},window.addEventListener("resize",t.__onWindowResize),t.contentPanelDom=document.querySelector("#custom_report_page .page-view"),t.__onWindowResize(),t.createBackgroundPattern().then(function(e){t.contentPanelDom.style="background-image: url("+e+"); background-size: "+200/t.globleConfig.column+"% "+200/t.globleConfig.row+"%;"})})},beforeDestory:function(){window.removeEventListen("resize",this.__onWindowResize)}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"custom_report_page"}},[n("div",{staticClass:"wrapper df dfv"},[n("div",{staticClass:"el-tabs el-tabs--top",attrs:{id:"custom-report-tabs"}},[n("div",{staticClass:"el-tabs__header is-top"},[n("div",{staticClass:"el-tabs__nav-wrap is-top"},[n("div",{staticClass:"el-tabs__nav-scroll"},[n("div",{staticClass:"el-tabs__nav is-top"},[t._l(t.sceneList,function(e,i){return n("div",{key:i,staticClass:"el-tabs__item is-top",class:t.curView+""==""+i&&"is-active",on:{click:function(e){t.curView!==i&&(t.curView=i,t.changeTab(i))},dblclick:function(n){return t.startEditTabName(e,i)}}},[n("span",{directives:[{name:"show",rawName:"v-show",value:!e.onEdit,expression:"!item.onEdit"}]},[t._v(t._s(e.name))]),t._v(" "),n("input",{directives:[{name:"show",rawName:"v-show",value:e.onEdit,expression:"item.onEdit"},{name:"model",rawName:"v-model",value:e.editValue,expression:"item.editValue"}],staticClass:"edit-name",attrs:{type:"text"},domProps:{value:e.editValue},on:{click:function(t){return t.stopPropagation(),t},blur:function(t){e.name=e.editValue,e.onEdit=!1},input:function(n){n.target.composing||t.$set(e,"editValue",n.target.value)}}}),t._v(" "),n("a",{on:{click:function(n){return t.deleteTab(e,i)}}},[t._v("×")])])}),t._v(" "),n("div",{staticClass:"el-tabs__item is-top add-tab",on:{click:function(e){return t.sceneList.push({name:"新Tab页",editValue:"新Tab页"})}}},[n("span",[t._v("+")])])],2)])])])]),t._v(" "),n("div",{staticClass:"list-header"},[n("h3",[t._v("新Tab页")]),t._v(" "),n("div",{staticClass:"btn-group"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){}}},[t._v("告警拓展信息")])],1)]),t._v(" "),n("div",{staticClass:"page-view"},t._l(t.componentList,function(e){return n("div",{key:e.dId,staticClass:"component",style:t.calcComponentsStyle(e),attrs:{id:"component-"+e.dId}},[n("report-component",{ref:"component-"+e.dId,refInFor:!0,attrs:{prop:e}}),t._v(" "),n("a",{staticStyle:{position:"absolute",top:"3px",right:"8px"},on:{click:function(n){return t.deleteComponent(e)}}},[t._v("×")])],1)}),0),t._v(" "),n("div",{staticClass:"stand-by-panel"},[n("div",{staticClass:"component",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:t.startDragFromStandByPanel(arguments[0],{name:"line-1231231245",type:"line"})}}},[t._v(" line ")]),t._v(" "),n("div",{staticClass:"component",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:t.startDragFromStandByPanel(arguments[0],{name:"pie-1231231245",type:"pie"})}}},[t._v(" pie ")]),t._v(" "),n("div",{staticClass:"component",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:t.startDragFromStandByPanel(arguments[0],{name:"table-1231231245",type:"table"})}}},[t._v(" table ")]),t._v(" "),n("div",{staticClass:"component",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:t.startDragFromStandByPanel(arguments[0],{name:"link-1231231245",type:"link"})}}},[t._v(" link ")])])])])},staticRenderFns:[]};var f=n("VU/8")(p,h,!1,function(t){n("jMMI")},"data-v-54c87533",null);e.default=f.exports},Gu7T:function(t,e,n){"use strict";e.__esModule=!0;var i,o=n("c/Tr"),s=(i=o)&&i.__esModule?i:{default:i};e.default=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return(0,s.default)(t)}},"c/Tr":function(t,e,n){t.exports={default:n("5zde"),__esModule:!0}},cDlZ:function(t,e){},fBQ2:function(t,e,n){"use strict";var i=n("evD5"),o=n("X8DO");t.exports=function(t,e,n){e in t?i.f(t,e,o(0,n)):t[e]=n}},jMMI:function(t,e){},qyJz:function(t,e,n){"use strict";var i=n("+ZMJ"),o=n("kM2E"),s=n("sB3e"),r=n("msXi"),a=n("Mhyx"),c=n("QRG4"),d=n("fBQ2"),l=n("3fs2");o(o.S+o.F*!n("dY0y")(function(t){Array.from(t)}),"Array",{from:function(t){var e,n,o,u,p=s(t),h="function"==typeof this?this:Array,f=arguments.length,m=f>1?arguments[1]:void 0,g=void 0!==m,v=0,y=l(p);if(g&&(m=i(m,f>2?arguments[2]:void 0,2)),void 0==y||h==Array&&a(y))for(n=new h(e=c(p.length));e>v;v++)d(n,v,g?m(p[v],v):p[v]);else for(u=y.call(p),n=new h;!(o=u.next()).done;v++)d(n,v,g?r(u,m,[o.value,v],!0):o.value);return n.length=v,n}})}});