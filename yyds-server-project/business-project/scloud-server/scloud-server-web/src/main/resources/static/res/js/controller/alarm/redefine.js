scloudApp.controller("alarmRedefineController",["$scope","$rootScope","$timeout","treeService","alarmRedefineService","signalService",function(e,t,n,i,a,o){function l(){e.isLoading=!0,a.getRuleList(e.paginationConf,e.ruleQuery,function(t){e.isLoading=!1,e.ruleList=t.list,e.paginationConf.totalItems=t.count,d()},function(){e.isLoading=!1})}function d(){e.isLoading2=!0,a.getRedefinedSignalList(e.paginationConf2,function(t){e.isLoading2=!1,e.redefinedList=t.list,e.paginationConf2.totalItems=t.count},function(){e.isLoading2=!1})}function u(){for(var t=[],n=e.addRule.obj.selectedSiteList,i=0;i<n.length;i++)t[i]=n[i].id;return t}function c(){for(var t=[],n=e.addRule.obj.signalCodeList,i=0;i<n.length;i++)t[i]=n[i].id;return t}$state&&($state=window.$state),$stateParams&&($stateParams=window.$stateParams),e.ruleQuery={enabled:null},e.addRule={form:{},obj:{selectedSiteList:[],siteIds:[],selectedSignalList:[],signalCodes:[]},toModal:null,execute:null,clear:null},e.deleteRule={form:{},obj:{},toModal:null,execute:null,clear:null},e.signalList={data:[]},e.isLoading=!1,e.isLoading2=!1,e.paginationConf={currentPage:1,itemsPerPage:15,pagesLength:9,onChange:function(){}},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.paginationConf2={currentPage:1,itemsPerPage:15,pagesLength:9,onChange:function(){}},e.$watch("paginationConf2.currentPage + paginationConf2.itemsPerPage",d),e.query=function(){l()},e.addRule.execute=function(){e.addRule.obj.siteIds=u(),e.addRule.obj.signalCodeList=c(),a.addRule(e.addRule.obj,function(){e.addRule.clear(),l()})},e.addRule.clear=function(){e.addRule.form.$setPristine(),delete t.failToCheckRuleName,e.addRule.obj={selectedSiteList:[],siteIds:[],selectedSignalList:[],signalCodeList:[],device:null}},e.getRuleDetail=function(t,n){a.getDetail(t,function(t){e.ruleDetail=t,e.openDetailTab(n)})},e.openDetailTab=function(t){e.openDetailIndex===t?e.openDetailIndex=null:e.openDetailIndex=t},e.getNodesByParamFuzzy=function(t,n,i){e.zTree.getNodesByParamFuzzy(t,n,i,function(){e.getCheckedNodeInSelect("areaTree")})},e.getCheckedNodeInSelect=function(t){var n=i.getCheckedNode(t);n&&(e.multiNodeSelect.add(n,e.addRule.obj.selectedSiteList),e.$apply())},e.changDevice=function(){e.addRule.obj.deviceType=e.addRule.obj.device.code,e.addRule.obj.signalCodeList=[],e.signalList={data:e.addRule.obj.device.signalTypeList.map(function(e){return{id:e.code,text:e.typeName}})}},e.multiNodeSelect={add:function(e,t){!1===t.containsObj(e)&&(t[t.length]=e)},remove:function(e,t){!e||e.length<1||(t.removeObj(e[0]),e=[])}},e.deleteRule.toModal=function(t){e.deleteRule.obj=t,$("#deleteRuleModal").modal("show")},e.deleteRule.execute=function(){$("#deleteRuleModal").modal("hide"),a.deleteRule(e.deleteRule.obj.id,function(){l(),e.deleteRule.clear()})},e.deleteRule.clear=function(){e.deleteRule.obj={},$("#deleteRuleModal").modal("hide")},e.changeState=function(t){e.isLoading=!0,a.changeState(t,function(){e.isLoading=!1,l()})},e.checkRuleNameTO=null,e.checkRuleName=function(){window.clearTimeout(e.checkRuleNameTO),e.checkRuleNameTO=window.setTimeout(function(){e.addRule.failToCheckRuleName=!1,a.checkRuleNameUnique(e.addRule.obj.name,function(t){e.addRule.failToCheckRuleName=!t.success})},300)},function(){e.treeLoading=!0,i.getSiteMapTree({},function(t){e.treeLoading=!1,e.zTree=i.createZTree(t),i.initTree(e.zTree.zNodes,"areaTree","radioSiteTree",function(){e.getCheckedNodeInSelect("areaTree")})})}(),function(){o.getDeviceTypeListBySignalType(0,function(t){e.deviceList=t,t.forEach(function(e){e.signalTypeList=e.signalTypeList.filter(function(e){return"0"===e.code[0]})})})}()}]);