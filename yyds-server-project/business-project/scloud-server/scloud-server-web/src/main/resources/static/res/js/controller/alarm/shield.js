scloudApp.controller("alarmShieldController",["$scope","$rootScope","treeService","alarmShieldService","deviceService",function(e,n,t,a,i){function o(){e.isLoading=!0,a.getRuleList(e.paginationConf,e.ruleQuery,function(n){e.isLoading=!1,e.ruleList=n.list,e.paginationConf.totalItems=n.count,e.ruleList&&e.ruleList[0]&&(e.currentRuleId=e.ruleList[0].id,d())},function(){e.isLoading=!1})}function d(){e.currentRuleId&&(e.isLoading2=!0,a.getShieldAlarmList(e.paginationConf2,e.currentRuleId,function(n){e.isLoading2=!1,e.shieldList=n.list,e.paginationConf2.totalItems=n.count},function(){e.isLoading2=!1}))}function l(n){i.getDeviceListOnSite({siteCodes:[n.code],serverCode:e.user.serverCode,currentPage:1,pageSize:999999},function(t){for(var a=0;a<t.list.length;a++)t.list[a].siteName=n.name;e.addRule.obj.deviceList=t.list})}function r(){for(var n=[],t=e.addRule.obj.selectedDeviceList,a=0;a<t.length;a++)n[a]=t[a].code;return n}$state&&($state=window.$state),$stateParams&&($stateParams=window.$stateParams),e.ruleQuery={enabled:null},e.addRule={form:{},obj:{alarmLevels:[],deviceList:[],addDevice:[],removeDevice:[],selectedDeviceList:[],deviceIds:[]},toModal:null,execute:null,clear:null},e.addTimeRange={form:{},obj:{},toModal:null,execute:null,clear:null},e.deleteRule={form:{},obj:{},toModal:null,execute:null,clear:null},e.isLoading=!1,e.isLoading2=!1,e.paginationConf={currentPage:1,itemsPerPage:15,pagesLength:9,onChange:function(){}},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.paginationConf2={currentPage:1,itemsPerPage:15,pagesLength:9,onChange:function(){}},e.$watch("paginationConf2.currentPage + paginationConf2.itemsPerPage",d),e.query=function(){o()},e.getShieldAlarmList=function(n){e.currentRuleId=n,d()},e.addRule.execute=function(){var n={name:e.addRule.obj.name,deviceCodeList:r(),serverCode:e.user.serverCode};a.addRule(n,function(){e.addRule.clear(),o()})},e.addRule.clear=function(){e.addRule.form.$setPristine(),e.addRule.obj={alarmLevels:[],deviceList:[],addDevice:[],removeDevice:[],selectedDeviceList:[],deviceIds:[]}},e.addTimeRange.toModal=function(n,t){t.stopPropagation(),e.getTimeRanges(n.id),e.aaa=n.id,e.addTimeRange.obj.ruleName=n.name,e.addTimeRange.obj.ruleId=n.id,$("#addTimeRangeModal").modal("show")},e.addTimeRange.execute=function(){a.addTimer(e.addTimeRange.obj.ruleId,e.addTimeRange.obj.tStart,e.addTimeRange.obj.tEnd,function(){e.getTimeRanges(e.addTimeRange.obj.ruleId)})},e.addTimeRange.clear=function(){e.addTimeRange.form.$setPristine(),e.addTimeRange.obj={},$("#addTimeRangeModal").modal("hide")},e.getTimeRanges=function(n){a.getTimerForRule(n,function(n){e.addTimeRange.obj.timeRanges=n})},e.deleteTimeRange=function(n){a.deleteTimer(n,function(){e.getTimeRanges(e.addTimeRange.obj.ruleId)})},e.getRuleDetail=function(n,t,i){i.stopPropagation(),a.getDetail(n,function(n){e.ruleDetail=n,e.openDetailTab(t)})},e.openDetailTab=function(n){e.openDetailIndex===n?e.openDetailIndex=null:e.openDetailIndex=n},e.getNodesByParamFuzzy=function(n,t,a){e.zTree.getNodesByParamFuzzy(n,t,a,function(){e.getCheckedNodeInSelect("areaTree")})},e.getCheckedNodeInSelect=function(n){var a=t.getCheckedNode(n);if(!a)return e.addRule.obj.deviceList=[],void e.$apply();l(a)},e.multiSelect={add:function(e,n){!e||e.length<1||(!1===n.containsObj(e[0])&&(n[n.length]=e[0]),e=[])},remove:function(e,n){!e||e.length<1||(n.removeObj(e[0]),e=[])}},e.deleteRule.toModal=function(n,t){t.stopPropagation(),e.deleteRule.obj=n,$("#deleteRuleModal").modal("show")},e.deleteRule.execute=function(){$("#deleteRuleModal").modal("hide"),a.deleteRule(e.deleteRule.obj.id,function(){e.deleteRule.clear(),o(),d()})},e.deleteRule.clear=function(){e.deleteRule.obj={},e.openDetailIndex=null,e.ruleDetail=null,$("#deleteRuleModal").modal("hide")},e.changeState=function(e,n){n.stopPropagation(),a.changeState({id:e.id,state:!e.enabled},function(){o(),d()})},function(){e.treeLoading=!0,t.getSiteMapTree({serverCode:e.user.serverCode},function(n){e.treeLoading=!1,e.zTree=t.createZTree(n),t.initTree(e.zTree.zNodes,"areaTree","radioSiteTree",function(){e.getCheckedNodeInSelect("areaTree")})})}()}]);