var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window.scloudApp=angular.module("scloudApp",[]),window.ctx="..",scloudApp.directive("scloudCheckSelect",[function(){return{restrict:"AE",replace:!0,transclude:!0,scope:{sngModel:"=",sngOptions:"="},template:'<div class="scloud-cs"><div class="cs-input select-btn" ng-click="toggle();"><ul><li ng-repeat="item in sngModel"><a class="ic ic-close" ng-click="remove(item, $index, $event);"></a><span ng-bind="item.value" title={{item.value}}></span></li></ul></div><div id="check-select-body" class="cs-body"><div class="cs-option scroll"><ul><li ng-repeat="item in sngOptions"><label ng-click="select(item, $index);"><span ng-bind="item.value"></span></label></li><li ng-if="sngOptions.length === 0"><label><span>没有更多了...</span></label></li></ul></div></div> <span ng-transclude></span></div>',link:function(e,t,n){e.show=!1,e.toggle=function(e){this.show=void 0!==e?e:!this.show;var t=document.getElementById("check-select-body");this.show?t.style.display="block":t.style.display="none"},e.select=function(t,n){e.sngModel||(e.sngModel=[]),e.sngModel.push(t),e.sngOptions.splice(n,1)},e.remove=function(t,n,o){o.stopPropagation(),e.sngOptions||(e.sngOptions=[]),e.sngOptions.push(t),e.sngModel.splice(n,1)}}}}]),scloudApp.directive("scloudTooltip",[function(){return{restrict:"AE",replace:!0,scope:{name:"="},template:'<span     ng-click = "popup()"    ng-bind="name"    data-toggle="tooltip"     data-container="body"    data-trigger="manual"     data-placement="bottom"     data-html="true" ></span>',link:function(e,t,n){var o=!1;e.popup=function(){if(!o){$(t).popover("show"),o=!0;var e=function e(n){0===$(n.target).parents(".popover").length&&($(t).popover("hide"),document.removeEventListener("click",e),o=!1)};setTimeout(function(){document.addEventListener("click",e)},0)}}}}}]),scloudApp.directive("autoWidth",["$rootScope",function(e){return{restrict:"A",link:function(t,n,o){var i=$(n).outerWidth(),r=$(n).width();t.$watch(o.ngModel,function(t,o){if(t){var s=e.util.calcTextWidth(t);s>r?$(n).css("width",s+i-r+"px"):$(n).css("width",i+"px")}})}}}]),scloudApp.directive("scloudLabelBox",[function(){return{restrict:"AE",replace:!0,transclude:!0,scope:{sngModel:"=",sngRemoveCallback:"="},template:'<div class="scloud-lb"><div class="lb-input"><span ng-show="sngModel.length < 1">暂无</span><ul ng-show="sngModel.length > 0"><li ng-repeat="item in sngModel"><a class="ic ic-close" ng-click="remove($index);"></a><span ng-bind="item.name" title={{item.name}}></span></li></ul></div><span ng-transclude></span></div>',link:function(e,t,n){e.remove=function(t){var n=e.sngModel[t];e.sngModel.splice(t,1),e.sngRemoveCallback&&e.sngRemoveCallback instanceof Function&&e.sngRemoveCallback(n)}}}}]),scloudApp.directive("scloudTableSort",[function(){return{restrict:"AE",link:function(e,t,n){var o=e[n.callback],i=function(){r.forEach(function(e){$(e).removeClass("forward"),$(e).removeClass("backward")}),$(this).addClass($(this).data("order")?"backward":"forward"),o($(this).attr("field"),$(this).data("order")),$(this).data("order",!$(this).data("order"))},r=t.find("th[field]").toArray().map(function(e){return $(e).click(i),$(e).hasClass("sort")||$(e).append($('<span class="sort-wrap"><i class="ic ic-caret-up"></i><i class="ic ic-caret-down"></i></span>')),$(e).addClass("sort"),"false"===$(e).attr("default-field")?($(e).data("order",!1),$(e).addClass("backward")):($(e).data("order",!0),$(e).addClass("forward")),e})}}}]),scloudApp.directive("scloudCountDown",["$interval",function(e){return{restrict:"AE",replace:!0,transclude:!0,scope:{sngCount:"@",sngTitle:"@",sngHave:"=",sngDisabled:"="},template:'<button ng-click="countDown();" ng-disabled="show !== sngTitle || sngDisabled"><span ng-transclude></span> <span ng-bind="show"></span></button>',link:function(t,n,o){t.show=t.sngTitle,t.countDown=function(){if(!t.sngHave){var n=t.sngCount;t.show=n+" s",e(function(){t.show=--n+" s"},1e3,t.sngCount).then(function(){t.show=t.sngTitle},function(){},function(){})}},t.$watch("sngHave",function(){t.countDown(),!t.sngHave&&(t.sngHave=!0)})}}}]),scloudApp.directive("scloudmytarget",function(){return{restrict:"EACM",scope:{item:"=item",myid:"@myid",ifchecked:"=ifchecked",hint:"=hint",click:"="},template:"<span class='scloud-ct'><input class='tgl tgl-ios' id='{{myid}}' type='checkbox' ng-checked='ifchecked'><label ng-click='click(item)' class='tgl-btn' for='{{myid}}'></label><span style='margin-left: 16px' ng-if ='hint' ng-bind='ifchecked?\"是\":\"否\"'></span></span>"}}),scloudApp.directive("scloudTableHeadFix",["$compile",function(e){return{restrict:"A",scope:{},link:function(t,n,o){var i=$(n),r=$(n).find("thead"),s=r.offset().top;s-=i.closest(".scroll").parent().offset().top;var a='<table class="table table-hover table-border table-HeadFixed">'+r[0].outerHTML+"</table>",c=e(a)(t.$parent);t.oldV=null,c.css({position:"absolute",top:s+"px"}),i.closest(".scroll").parent().append(c),t.interval=setInterval(function(){$(n).outerWidth()<=0&&clearInterval(t.interval),t.oldV!==$(n).text().length+$(n).outerWidth()&&t.update()},50),t.update=function(){if("none"===$(n).css("display")?c.css("display","none"):c.css("display","table"),t.oldV=$(n).text().length+$(n).outerWidth(),!($(n).outerWidth()<=100))for(var e=0,o=0;o<r.find("th").length;o++)e=r.find("th").eq(o).width(),c.find("th").eq(o).css({width:e+"px"})},t.$parent.$on("updateFixedTable",t.update)}}}]),scloudApp.directive("onFinishRenderFilters",["$timeout",function(e){return{restrict:"A",link:function(t,n,o){!0===t.$last&&e(function(){t.$emit("ngRepeatFinished")})}}}]),scloudApp.directive("tabDirective",[function(){return{restrict:"AE",scope:{tabData:"=",currentType:"="},transclude:!0,template:'<div class="tab">            <ul class="tab-content" ng-repeat="list in tabData" ng-if="$index === curIndex">                <li ng-repeat="item in list | orderBy: item.typeName " ng-click="selectType(item.type)">                   <span class="type-image" ng-class="item.type"></span>                   <span class="type-name">{{item.typeName}}</span>                </li>            </ul>            <ul class="tab-nav">                <li ng-repeat="list in tabData" ng-click="getIndex($index);" ng-class="{active:$index===curIndex}"></li>            </ul>        </div>',link:function(e,t,n){e.curIndex=0,e.getIndex=function(t){e.curIndex=t},e.currentType="battery",e.selectType=function(t){e.$parent.selectType(t)}}}}]),scloudApp.directive("slide-list",[function(){return{restrict:"AE",scope:{isShowAlarmCountList:"="},transclude:!0,link:function(e,t,n){e.isShowAlarmCountList=!0,e.slideAlarmCountList=function(){$scope.isShowAlarmCountList=!$scope.isShowAlarmCountList}}}}]),scloudApp.directive("scloudToggle",[function(){return{restrict:"AE",replace:!0,scope:{target:"=",other:"=",position:"@",initState:"=",handler:"=",callback:"="},template:'<div class="scloud-toggle scloud-toggle-{{position}}" ng-class="isLight();" ng-click="toggle();">                        <i ng-class="toggleClass();"></i>                    </div>',link:function(e,t,n){e.isFold=!1,n.handler&&(e.handler=function(t){e.toggle(t)}),e.toggle=function(t){if(e.isFold=void 0!==t?t:!e.isFold,e.isFold){for(var n=0;n<e.target.elem.length;n++)$(e.target.elem[n]).animate(e.target.toCss);if(e.other)for(var n=0;n<e.other.elem.length;n++)$(e.other.elem[n]).animate(e.other.toCss)}else{for(var n=0;n<e.target.elem.length;n++)$(e.target.elem[n]).animate(e.target.fromCss);if(e.other)for(var n=0;n<e.other.elem.length;n++)$(e.other.elem[n]).animate(e.other.fromCss)}setTimeout(function(){window.dispatchEvent(new Event("resize"))},500),e.callback&&e.callback(e.isFold)},e.toggleClass=function(){return"right"===e.position?e.isFold?"ic ic-menu-right":"ic ic-menu-left":"left"===e.position?e.isFold?"ic ic-menu-left":"ic ic-menu-right":"top"===e.position?e.isFold?"ic ic-angle-up":"ic ic-angle-down":"bottom"===e.position?e.isFold?"ic ic-angle-down":"ic ic-angle-up":void 0},e.isLight=function(){return e.isFold?"light":""},!0===e.initState&&e.toggle(!0)}}}]),scloudApp.directive("scloudTreeToggle",[function(){return{restrict:"AE",replace:!0,scope:{target:"=",other:"=",position:"@",initState:"=",handler:"=",callback:"="},template:'<div class="scloud-tree-toggle scloud-toggle-{{position}}" ng-class="isLight();" ng-click="toggle();">                        <i ng-class="toggleClass();"></i>                    </div>',link:function(e,t,n){e.isFold=!1,n.handler&&(e.handler=function(t){e.toggle(t)});for(var o=0;o<e.target.elem.length;o++)$(e.target.elem[o])[0].style.transform="translateX(-100%)";e.toggle=function(t){if(t!==e.isFold){if(e.isFold=void 0!==t?t:!e.isFold,e.isFold)for(var n=0;n<e.target.elem.length;n++)$(e.target.elem[n])[0].style.transform="translateX(0%)",$(e.target.elem[n])[0].style.animation="rightToLeft .5s",$(e.target.elem[n])[0].style.transform="translateX(-100%)";else for(var n=0;n<e.target.elem.length;n++)$(e.target.elem[n])[0].style.transform="translateX(-100%)",$(e.target.elem[n])[0].style.animation="leftToRight .5s",$(e.target.elem[n])[0].style.transform="translateX(0%)";setTimeout(function(){window.dispatchEvent(new Event("resize")),$(".nav-tree").each(function(e){this.style.animation=""})},500),e.callback&&e.callback(e.isFold)}},e.toggleClass=function(){return"right"===e.position?e.isFold?"ic ic-menu-right":"ic ic-menu-left":"left"===e.position?e.isFold?"ic ic-menu-left":"ic ic-menu-right":"top"===e.position?e.isFold?"ic ic-angle-up":"ic ic-angle-down":"bottom"===e.position?e.isFold?"ic ic-angle-down":"ic ic-angle-up":void 0},e.isLight=function(){return e.isFold?"light":""},!0===e.initState&&e.toggle(!0)}}}]),scloudApp.directive("scloudCheckbox",[function(){return{restrict:"AE",replace:!0,scope:{content:"@",selected:"=",callback:"=",self:"=",contentClass:"@"},template:'<i class="ic" ng-class="isSelected();" ng-click="change();$event.stopPropagation();"> <span ng-bind="content" ng-class="contentClass"></span></i>',link:function(e,t,n){e.isSelected=function(){return e.selected?"ic-check-square font-primary":"ic-square"},e.change=function(){e.selected=!e.selected,e.callback&&e.callback(e.selected,e.self)}}}}]),scloudApp.directive("scloudRadio",[function(){return{restrict:"AE",replace:!0,scope:{selected:"=",isRadio:"=",callback:"=",content:"@",disabled:"@"},template:'<i class="ic scloud-radio" ng-class="isSelected();" ng-click="change();$event.stopPropagation();"><span ng-if="!!content">{{content}}</span></i>',link:function(e,t,n){e.isSelected=function(){return e.disabled?"ic-circle-o font-default":e.selected?"ic-dot-circle-o font-primary":"ic-circle-o"},e.change=function(){e.disabled||(e.isRadio?(!e.selected&&e.callback&&e.callback(!0,n.selected),e.selected=!0):(e.selected=!e.selected,e.callback&&e.callback(e.selected,n.selected)))}}}}]),scloudApp.directive("scloudTreeRadio",[function(){return{restrict:"AE",replace:!0,scope:{selected:"=",isRadio:"=",callback:"=",content:"@",disabled:"@",list:"@",index:"@",defaultIndex:"@",name:"@"},template:'<i class="ic scloud-tree-radio" ng-class="isSelected()" ng-click="change();$event.stopPropagation();"><span ng-if="!!item">{{item.name}}</span></i>',link:function(e,t,n){function o(){var t=e.parent.positions.map(function(e){return e.positionId}).indexOf(e.item.id);e.selected=-1!==t}function i(){var t=e.parent.positions.map(function(e){return e.positionId}).indexOf(e.item.id);e.selected=-1===t,-1!==t?e.parent.positions.splice(t,1):e.parent.positions.push({positionId:e.item.id,name:e.item.name})}e.parent="$last"in e.$parent?e.$parent.$parent:e.$parent,e.parent.positions=[],e.parent.positionIds="",e.item=JSON.parse(e.content||"{}"),e.isSelected=function(){return e.disabled?"ic-circle-o font-default":e.parent[e.name]===e.index||e.defaultIndex===e.index?"ic-dot-circle-o font-primary":e.selected?"ic-dot-circle-o font-primary":"ic-circle-o"},e.$watch("parent.positions.length",function(e,t){e!==t&&o()}),e.change=function(){e.disabled||(e.isRadio?e.selected?e.selected=!1:(e.parent[e.name]=e.index,e.callback&&e.callback(e.index,e.item)):i())}}}}]),scloudApp.directive("scloudCoordPicker",[function(){return{restrict:"AE",replace:!0,scope:{coord:"=",execute:"=",clear:"=",show:"="},template:'<div class="scloud-coord-picker">    <div id="b-map"></div>    <div class="hover" style="display: none"></div>    <div class="search">        <input type="text" size="small" class="search-input" ng-model = "__coord"></input>        <i class="ic ic-search cursor-point" ng-click="locate()"></i>        <br/>        <span class="position">{{lastPos}}</span>    </div>    <div class="btns">        <button type="button" class="btn btn-primary" ng-click="localExecute()">确认</button>        <button type="button" class="btn btn-default" ng-click="clear()">取消</button>    </div></div>',link:function(e,t,n){var o=!0;e.__coord=e.coord;var i=new window.BMap.Map("b-map");i.centerAndZoom("北京",11),i.enableScrollWheelZoom(!0);var r=new window.BMap.Geocoder;i.addEventListener("click",function(t){e.__coord=t.point.lng+","+t.point.lat,e.$apply(),r.getLocation(t.point,function(t){var n=t.addressComponents;e.lastPos=[n.province,n.city,n.district,n.street,n.streetNumber].filter(function(e){return!!e}).join(", "),e.$apply()})}),i.addEventListener("mousemove",function(e){var n=$(t).find(".hover")[0];n.innerText=e.point.lng+","+e.point.lat,n.style.top=e.clientY+"px",n.style.left=e.clientX+"px"}),i.addEventListener("mouseover",function(){$(t).find(".hover").show()}),i.addEventListener("mouseout",function(){$(t).find(".hover").hide()}),$(t).find(".search-input").on("keydown",function(e){"Enter"===e.key&&s()});var s=function(){if(i){var t=e.__coord;if("string"==typeof t){var n=t;if(!/^[0-9.]*,[0-9.]*$/.test(n))return void r.getPoint(n,function(e){e?i.centerAndZoom(e,16):alert("您选择地址没有解析到结果!")});try{t=t.replace("(","").replace(")","").split(",").map(function(e){return parseFloat(e)})}catch(e){return}var o=new window.BMap.Point(t[0],t[1]);return i.setCenter(o),r.getLocation(o,function(t){var n=t.addressComponents;e.lastPos=[n.province,n.city,n.district,n.street,n.streetNumber].filter(function(e){return!!e}).join(", "),e.$apply()}),!0}}};e.locate=s,e.localExecute=function(){e.coord=e.__coord,e.execute()},e.$watch("show",function(t,n){if(t!==n&&t){var r=s();e.__coord=e.coord,o&&(i.panBy(585,300),o=!1),r&&i.panBy(1170,600),setTimeout(function(){s()},300)}})}}}]),scloudApp.directive("scloudRange",[function(){return{restrict:"AE",replace:!0,scope:{min:"=",max:"=",type:"@",start:"@",end:"@",disabled:"@"},template:'<div class="scloud-range">    <div class="range" ng-click="clickToSetValue($event)" ng-mousemove="directiveMousemove($event)">        <div class="active-range"></div>        <div class="hint hover-hint"><div class="text-wrap"><span></span></div></div>        <div ng-mousedown="mousedown(\'a\', $event)" class="point point-a"><div class="hint"><div class="text-wrap"><span></span></div></div></div>        <div ng-mousedown="mousedown(\'b\', $event)" class="point point-b"><div class="hint"><div class="text-wrap"><span></span></div></div></div>    </div></div>',link:function(e,t,n){function o(n){var o=(n.pageX-e.curMouseOffsetX-t.offset().left)/t.width();o>1?o=1:o<0&&(o=0),e["value"+e.curPoint]=100*o,t.find(".hover-hint").css({left:e["value"+e.curPoint]+"%"}),t.find(".hover-hint span").text(a(e["value"+e.curPoint])),r()}function i(){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",i),l(),setTimeout(function(){e.isMousedown=!1},300)}function r(){t.find(".point-a").css({left:e.valuea+"%"}),t.find(".point-b").css({left:e.valueb+"%"}),t.find(".active-range").css({left:Math.min(e.valuea,e.valueb)+"%",right:100-Math.max(e.valuea,e.valueb)+"%"}),s()}function s(){t.find(".point-a .hint span").text(a(e.valuea)),t.find(".point-b .hint span").text(a(e.valueb))}function a(t){var n,o,i;switch(e.type){case"hm":default:n=new Date("1970-01-01 "+e.start+":00 GMT+0000").getTime(),o=new Date("1970-01-01 "+e.end+":00 GMT+0000").getTime(),i=new Date((o-n)*t/100+n-288e5).Format("hh:mm")}return i}function c(t){var n,o,i;switch(e.type){case"hm":default:n=new Date("1970-01-01 "+e.start+":00 GMT+0000").getTime(),o=new Date("1970-01-01 "+e.end+":00 GMT+0000").getTime(),t=new Date("1970-01-01 "+t+":00 GMT+0000").getTime(),i=(t-n)/(o-n)*100}return i}function l(){e.disableWatch=!0,e.min=a(Math.min(e.valuea,e.valueb)),e.max=a(Math.max(e.valuea,e.valueb)),setTimeout(function(){e.disableWatch=!1},10)}e.min=e.min||e.start,e.max=e.max||e.end,e.valuea=c(e.min),e.valueb=c(e.max),e.curPoint="",e.curMouseOffsetX=0;e.mousedown=function(t,n){e.disabled||(document.addEventListener("mousemove",o),document.addEventListener("mouseup",i),e.curPoint=t,e.curMouseOffsetX=n.offsetX-7,e.isMousedown=!0)},e.clickToSetValue=function(n){if(!e.disabled&&!e.isMousedown){var o=(("active-range"===n.target.className?n.target.offsetLeft:0)+n.offsetX)/t.width()*100;Math.abs(o-e.valuea)>Math.abs(o-e.valueb)?e.valueb=o:e.valuea=o,r(),l()}},e.directiveMousemove=function(n){if(!e.disabled){var o=0;(n.target.className.indexOf("point")>=0||"active-range"===n.target.className)&&(o+=n.target.offsetLeft),o+=n.offsetX,o=o/t.width()*100,t.find(".hover-hint").css({left:o+"%"}),t.find(".hover-hint span").text(a(o))}},e.$watch("min + max",function(){e.disableWatch||(e.min=e.min||e.start,e.max=e.max||e.end,e.valuea=c(e.min),e.valueb=c(e.max),r())}),r()}}}]),scloudApp.directive("scloudProgressBar",[function(){return{restrict:"AE",replace:!0,scope:{list:"=",curTimeLabel:"@",click:"="},template:'<div class="scloud-progress-bar" ng-click="handleClick($event)">   <div name="sceneProgressWrapper" class="scene-progress-wrapper" style="pointer-events: none;">       <div class="scene-progress" ng-style="calcWidth()">           <div class="scene-progress-header"></div>       </div>   </div>   <div class="scene-progress-text" style="pointer-events: none;">       <span ng-repeat="item in list" ng-bind="item.type"></span>   </div></div>',link:function(e,t,n){var o=t[0],i=o.children[0],r=i.children[0],s=e.list.length-1,a=i.offsetWidth/s,c=0;e.calcWidth=function(){return{width:a*(e.curTimeLabel-1)+"px"}},e.handleClick=function(t){t.stopPropagation(),c=Math.floor((t.offsetX+a/2)/a),r.style.width=a*c+"px",e.click(e.list[c])}}}}]),scloudApp.directive("scloudSelect",["$compile",function(e){return{restrict:"AE",replace:!0,scope:{disabled:"=",placeholder:"@",list:"=",position:"@"},template:'<div class="scloud-select"></div>',link:function(t,n,o){function i(e,t){function n(e){e.value=t,e.children&&e.children.forEach(function(e){n(e)})}n(e)}function r(e){function n(t){t.value=e,t.children&&t.children.forEach(function(e){n(e)})}n(t.list)}function s(e){function t(e){n&&(e.value||(n=!1),e.children&&e.children.forEach(function(e){t(e)}))}if(e){var n=!0;return e.children&&e.children.forEach(function(e){t(e)}),n}}function a(){function o(e,t){return e.children&&e.children.length?Math.max.apply(null,e.children.map(function(n){return n.parent=e,o(n,t+1)})):t}n.find(".scloud-select-tree").remove();for(var i='<div class="scloud-select-tree">   <input type="text" readonly placeholder="{{placeholder || \'多选\'}}" ng-model="selectName" ng-click="!embeded && showSelectPanel($event)">   <div class="select-items-wrapper '+t.embeded+" "+l+'" ng-show="isShowSelectPanel">       <div class="top-angle" ng-show="isShowSelectPanel"></div>       <div class="select-items" ng-class="isRadio && \'isRadio\'" ng-show="isShowSelectPanel">'+(t.isRadio?"":'<i class="expand cursor-point" ng-class="list.isCollapse && \'isCollapse\'" ng-click="expand(list)"></i>   <scloud-checkbox selected="list.value" self="list" content="{{list.name}}" callback="change"></scloud-checkbox>')+"           *       </div>   </div></div>",r=o(t.list,0),s=0;s<r;s++)i=i.replace("*",'<div class="item" style="margin-left: 20px; overflow:hidden;" ng-repeat="item'+s+" in "+(0===s?"list":"item"+(s-1))+'.children" ng-style="{height: item'+s+".parent.isCollapse ? 0 : 'auto'}\">"+(s<r-1?'    <i class="expand cursor-point" ng-class="item'+s+".isCollapse && 'isCollapse'\" ng-click=\"expand(item"+s+')"></i>':'<i class="placeholder"></i>')+(t.isRadio?s===r-1?'   <scloud-radio selected="item'+s+'.value" self="item'+s+'" content="{{item'+s+'.name}}" callback="radioChange"></scloud-radio>':'<span ng-bind="item'+s+'.name"></span>':'   <scloud-checkbox selected="item'+s+'.value" self="item'+s+'" content="{{item'+s+'.name}}" callback="change"></scloud-checkbox>')+"   *</div>");i=i.replace("*","");var a=e(i)(t);n.append(a),new PerfectScrollbar(a.find(".select-items")[0])}function c(e){var t=[];return function e(n){n.children&&n.children.length||!n.value||t.push(n),n.children&&n.children.forEach(function(t){e(t)})}(e),t}void 0!==o.isRadio&&(t.isRadio=!0),void 0!==o.embeded&&(t.embeded="embeded",t.isShowSelectPanel=!0),t.$watch("list",function(){a(t.list)}),t.$watch("disabled",function(e){(e||!1===e)&&(t.isShowSelectPanel=!e)}),t.$watch("list.update",function(e){function n(e){return e.children&&e.children.length?e.children.map(function(e){return n(e)}).every(function(e){return e})?e.value=!0:void 0:e.value}e&&(t.selectItems=c(t.list),t.selectName=t.selectItems.map(function(e){return e.name}),n(t.list),delete t.list.update)});var l="scloud-select-"+(t.position||"bottom");t.change=function(e,n,o){var r=!0;!o&&i(n,e),e?s(n.parent)?n.parent.value=!0:r=!1:n.parent&&(n.parent.value=!1),r&&n.parent&&t.change(e,n.parent,!0),t.selectItems=c(t.list),t.selectName=t.selectItems.map(function(e){return e.name})},t.radioChange=function(e,n){r(!1),n.value=e,t.selectItems=c(t.list),t.selectName=t.selectItems.map(function(e){return e.name})},t.expand=function(e){e.isCollapse=!e.isCollapse},t.showSelectPanel=function(e){e.stopPropagation(),t.isShowSelectPanel?t.hiddenSelectPanel():(t.isShowSelectPanel=!0,$("body").click(),$("body").on("click",t.hiddenSelectPanel))},t.hiddenSelectPanel=function(e){e&&$(e.target).parents(".select-items-wrapper").length>0||(t.isShowSelectPanel=!1,$("body").off("click",t.hiddenSelectPanel),setTimeout(function(){!t.$$phase&&t.$apply()},10))}}}}]),scloudApp.directive("scloudSowingMap",["$compile",function(e){return{scope:{curIndex:"=curIndex",curLeft:"=curLeft",imgList:"=imgList",rotateList:"=rotateList"},restrict:"AE",template:'<div class="scloud-sowing-map"><h2></h2><div class="sowing-top">               <div class="img-btn-wrapper img-btn-wrapper-left" ><span class="img-btn" ng-click="goLeft()"><</span></div>               <div class="img-btn-wrapper img-btn-wrapper-right" ><span class="img-btn" ng-click="goRight()">></span></div>               <img class="img-pennel" ng-repeat="v in imgList track by $index" ng-show="$index === curIndex" ng-style="{transform: \'rotate(\' + (rotateList[$index] || 0) + \'deg)\'}" ng-src="{{v}}">            </div><div class="sowing-bottom"><div class="img-nav-wrapper"><div class="img-bar" ng-style="{left: -curLeft * eachLen + \'px\'}"><img class="img-item"                                ng-repeat="v in imgList track by $index"                                ng-src="{{v}}"                                ng-click="selectImg($index)"                                ng-style="{transform: \'rotate(\' + (rotateList[$index] || 0) + \'deg)\'}"                               ng-class="{isActive : $index === curIndex }"/></div></div></div><div></div></div>',replace:!0,transclude:!0,link:function(e,t,n,o){function i(){e.curIndex>e.curLeft+3&&e.curLeft++}function r(){e.curIndex<e.curLeft&&e.curLeft--}e.curIndex=e.curIndex||0;var s,a=t[0].querySelector(".img-bar");e.$watch("imgList.length",function(e,t,n){s=e});e.eachLen=100,a.style.width=100*s+2+"px",e.curLeft=e.curLeft||0,e.selectImg=function(t){e.curIndex=t},e.goLeft=function(){for(;e.curIndex<=0;)return;e.curIndex--,r()},e.goRight=function(){for(;e.curIndex>=s-1;)return;e.curIndex++,i()}}}}]),scloudApp.directive("scloudTreeSelect",["$rootScope","$compile","treeService",function(e,t,n){return{restrict:"AE",replace:!0,scope:{list:"=",ngModel:"=",treeId:"@",treeType:"@",callback:"=",zTree:"="},template:'\n            <div class="scloud-tree-select">\n                <input type="text" ng-click="showSelectPanel()" ng-model="resultString" read-only ng-change="filter()"></input>\n                <div class="scloud-tree-select-tree cloak filter-online" ng-style="{display: isShowSelectPanel ? \'block\' : \'none\'}">\n                    <scloud-checkbox selected="searchKey.online" content="在线" callback="onKeywordChanged"></scloud-checkbox>\n                    <scloud-checkbox selected="searchKey.offline" content="离线" callback="onKeywordChanged"></scloud-checkbox>\n                    <input type="text" placeholder="搜索站点位置" ng-model="searchKey.keyword" ng-change="onKeywordChanged();">\n                    <div class="scroll-wrap">\n                        <ul id="{{ treeId }}" class="ztree scroll" ng-hide="zTree.isEmpty"></ul>\n                        <p ng-show="zTree.isEmpty">没有符合要求的结果</p>\n                    </div>\n                    <div class="loader" ng-show="treeLoading">\n                        <i class="ic ic-spinner ic-spin ic-5x"></i>\n                    </div>\n                </div>\n            </div>   \n            ',link:function(e,t,n){function o(n){[].filter.call($(n.target).parents(),function(e){return e===t[0]})[0]||e.hiddSelectPanel()}e.isShowSelectPanel=!1,e.resultString="",e.filteredList=e.list,e.searchKey={online:!0,offline:!0,keyword:""},e.showSelectPanel=function(){setTimeout(function(){document.removeEventListener("mousedown",o),document.addEventListener("mousedown",o)},200),e.isShowSelectPanel=!0},e.hiddSelectPanel=function(){document.removeEventListener("mousedown",o),e.isShowSelectPanel=!1,e.$apply()},e.onKeywordChanged=function(){e.callback(e.searchKey,e.treeId,e.treeType)},e.$watch("zTree.needUpdate",function(t){if(t){var n,o=$.fn.zTree.getZTreeObj(e.treeId);e.treeType.indexOf("Site")>-1?(n=o.getCheckedNodes().filter(function(e){return e.level>3}),e.resultString=n.length?n[0].name+(n.length>1?" 等"+(n.length-1)+"个站点":""):""):(n=o.getCheckedNodes().filter(function(e){return e.level>2}),e.resultString=n.length?n[0].name+(n.length>1?" 等"+(n.length-1)+"个区域":""):""),e.zTree.needUpdate=!1}})}}}]),scloudApp.directive("scloudTableBox",["$compile",function(e){return{restrict:"A",link:function(e,t){function n(){var n=t.width(),c=$(t).find(".table-HeadFixed"),l=a.find("th").toArray(),d=l.map(function(e,t){return 7*Math.max.apply(null,r.find("tr td:nth-child("+(t+1)+")").toArray().concat([l[t]]).map(function(e){return e.innerText.length+(e.innerText.match(/[\u4e00-\u9fa5]/g)||[]).length}))+20}),u=d.reduce(function(e,t){return Math.min(t,i)+e},0),p=d.reduce(function(e,t){return t+e}),f=$(t).scrollLeft();l.forEach(function(e){e.width=""}),u>n-50?(s.css("width",u+50+"px"),o.skipWidth=!0,u+50-f<n&&$(t).scrollLeft(-n+u+50)):($(t).scrollLeft(0),s.css("width","")),p>n-50&&d.forEach(function(e,t){e>i&&(l[t].width=i-16)}),t[0].perfectScrollbar&&t[0].perfectScrollbar.update(),s.find(".ps__rail-y").css("marginRight","0"),e.$emit("updateFixedTable"),c.css("width",r.outerWidth()+"px"),$(t).outerWidth()}var o={},i=220,r=$(t).find(".scroll table"),s=$(t).find(".scroll"),a=r.find("thead"),c=null;o.oldV=null,o.oldWidth=null;var l;o.interval=setInterval(function(){l||(l=location.hash),location.hash!==l&&clearInterval(o.interval),$(t).is(":hidden")||(o.oldV===r.html().length&&o.oldWidth===r.outerWidth()||o.skipWidth?o.skipWidth=!1:(clearTimeout(c),c=setTimeout(n,100)),o.oldV=r.html().length,o.oldWidth=r.outerWidth())},50),t[0].addEventListener("ps-scroll-x",function(e){s.find(".ps__rail-y").css("marginRight",s.width()-t.width()-t.scrollLeft()+"px")})}}}]),scloudApp.run(["$rootScope",function(e){e.CONST={ctx:window.ctx,currentMark:"",statusCode:{badRequest:400,notFound:404,internalServerError:500,requestFrequent:998,sessionTimeout:997},maxPageSize:999,signalType:{list:["遥测","遥信","遥调","遥控"],AI:"遥测",DI:"遥信",AO:"遥调",DO:"遥控"},alarmStateList:[{key:"待处理",value:"待处理"},{key:"已消除",value:"已消除"}],alarmCheckedStateList:[{key:!1,value:"待确认"},{key:!0,value:"已确认"}],alarmLevelList:[{key:"1",value:"一级告警"},{key:"2",value:"二级告警"},{key:"3",value:"三级告警"},{key:"4",value:"四级告警"}],alarmLevelListForSelect2:{data:[{id:"1",text:"一级告警"},{id:"2",text:"二级告警"},{id:"3",text:"三级告警"},{id:"4",text:"四级告警"}]},fsuStateOptions:["在线","离线"],enabledStateOptions:[{key:!1,value:"未启用"},{key:!0,value:"已启用"}],userType:{ordinary:"普通用户",manager:"管理员",globalManager:"全局管理员"},userClasses:{techSupport:"技术支持用户",enterprise:"企业用户",agency:"代理商用户"},userGroup:{read:"只读用户组",operate:"操作用户组",maintainer:"维护人员组",list:["只读用户组","操作用户组","维护人员组"]},logType:["访问日志","业务日志","门禁日志"],operationState:{list:["工程态","测试态","交维态"],PROJECT:"工程态",TEST:"测试态",MAINTENANCE:"交维态"},orderState:{list:["待提交","待审核","已通过","已作废"],SUBMIT:"待提交",CHECK:"待审核",PASS:"已通过",CANCEL:"已作废"},workList:{sendType:["自动派单","手动派单"],status:["未接工单","在途工单","超时工单","历史工单"]},animation:{list:"slide-top",detail:"scale-fade",info:"scale-fade"},fsuModelList:["ePLC-FH","ePLC-FS"],stationStateList:["所有","工程","测试","交维"],statisticsDepthList:[{key:1,value:"一级"},{key:2,value:"二级"},{key:3,value:"三级"},{key:4,value:"站点"}],statisticsDepthList2:[{key:1,value:"一级"},{key:2,value:"二级"},{key:3,value:"三级"}],dateTypeList:[{key:1,value:"按季"},{key:2,value:"按月"},{key:3,value:"按周"},{key:4,value:"按天"}],stationTypeList:[{key:1,value:"A级机房"},{key:2,value:"B级机房"},{key:3,value:"C级机房"},{key:4,value:"D级机房"}],assetNatureList:["自建","社会资源","注入"],fsuManufactoryList:["义益钛迪","里恒电气"],deviceName:[{key:"UPS",value:"UPS"},{key:"开关电源",value:"开关电源"}],monitorManufactoryList:[{key:"HK",value:"海康"},{key:"DH",value:"大华"},{key:"YS",value:"宇视"}],platformList:["动环平台","视频平台"],alarmColorList:["#FF002A","#a3b5a3","#EFD044","#5638ff"]},e.REGEX={warnInfo:"存在不规范的输入，或未获取到某些必要信息",username:/^\w{2,20}$/,usernameDesc:"2~20,字母/数字/_",password:/^\w{6,20}$/,passwordDesc:"6~20,字母/数字/_",threshold:/^(-)?(([1-9]\d*)|0)(\.\d{1})?$/,thresholdDesc:"保留1位小数",teleAdjustValue:/^([1-9]\d*|0)$/,teleAdjustValueDesc:"非负整数",teleControlValue:/^0|1$/,teleControlValueDesc:"0或1",pollingInterval:/^[1-9][0-9]*$/,pollingIntervalDesc:"正整数",float:/^[+-]?\d+(\.\d+)?$/,floatDesc:"浮点数",fsuOfflineDelayTime:/^(([0-9]|[1-9][0-9]|1[0-7][0-9])|180)$/,fsuOfflineDelayTimeDesc:"0~180 的正整数",votageFloat:/^[+-]?\d+(\.\d+)?V$/,votageFloatDesc:"浮点型电压值",fsuName:/^[\u4e00-\u9fa5\w-]{1,20}$/,fsuNameDesc:"1~20,汉字/字母/数字/_/-",personName:/^[\u4e00-\u9fa5a-zA-Z0-9·]{2,20}$/,personNameDesc:"2~20,汉字/字母/数字/·",manufactory:/^[\u4e00-\u9fa5a-zA-Z]{1,30}$/,manufactoryDesc:"1~30,汉字/字母",deviceName:/^[\u4e00-\u9fa5\w-\s（）()]{1,20}$/,deviceNameDesc:"1~20,汉字/字母/数字/_/-/空格/括号",systemName:/^[\u4e00-\u9fa5\w-]{1,20}$/,systemNameDesc:"1~20,汉字/字母/数字/_/-",deviceModel:/^[\u4e00-\u9fa5\w-]{1,20}$/,deviceModelDesc:"1~20,汉字/字母/数字/_/-",ip:/^((25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\.){3}(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)$/,ipDesc:"x.x.x.x(x为[0,255])",port:/^[0-9]+$/,portDesc:"长度大于0的数字",siteName:/^[\u4e00-\u9fa5\w-]{1,20}$/,siteNameDesc:"1~20,汉字/字母/数字/_/-",address:/^[\u4e00-\u9fa5\w-]{1,50}$/,addressDesc:"1~50,汉字/字母/数字/_/-",coordinate:/^(-)?(([1-9]?[0-9]|1[0-7][0-9])(\.[0-9]{1,6})?),(-)?(([1-6]?[0-9]|7[0-3])(\.[0-9]{1,6})?)$/,coordinateDesc:"经度(-180,180),纬度(-74,74)",phone:/(^(1)\d{10}$)|(^((0\d{2,3})|852|853)-(\d{7,8})(-\d{1,4})?$)/,phoneDesc:"手机号 或 区号-固话",cellphone:/^(1)\d{10}$/,cellphoneDesc:"手机号",enterpriseName:/^[\u4e00-\u9fa5a-zA-Z]{1,30}$/,enterpriseNameDesc:"1~30,汉字/字母",uniqueCode:/^[a-zA-Z0-9]{3,20}$/,uniqueCodeDesc:"3~20,字母/数字",messageCode:/^[0-9]{5}$/,messageCodeDesc:"5位数字",email:/^[\w-]+(.[\w-]+)+@[\w-]+(.[\w-]+)+$/,emailDesc:"邮箱标准aa.bb@cc.dd",emailCode:/^[0-9]{5}$/,emailCodeDesc:"5位数字",signalName:/^[\u4e00-\u9fa5a-zA-Z0-9]{1,20}$/,signalNameDesc:"1~20,汉字/字母/数字",department:/^[\u4e00-\u9fa5\w-]{1,20}$/,departmentDesc:"1~20,汉字/字母/数字/_/-",userGroup:/^[\u4e00-\u9fa5\w-]{1,20}$/,
userGroupDesc:"1~20,汉字/字母/数字/_/-",occupancyRate:/^[1-9][0-9]?$/,occupancyRateDesc:"1-99的自然数",positiveInteger:/^[0-9][0-9]*$/,positiveIntegerDesc:"正整数",workConfigTime:/^(?:0|[1-9][0-9]{0,3}|10000)$/,workConfigTimeDesc:"0~10000的整数",one2tenThousand:/^[1-9][0-9]{0,3}$/,one2tenThousandDesc:"1~9999的整数",one2hundredThousand:/^[1-9][0-9]{0,4}$/,one2hundredThousandDesc:"1~99999的整数",signalLinkCompareValue:/^(-{0,1}([1-9]\d{0,2})|(-{0,1}[1-9]\d{0,2}\.\d{1,2})|0)$/,signalLinkCompareValueDesc:"-999.99~999.99",idCard:/(^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$)|(^[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}$)/,idCardDesc:"身份证号码",hhmmss:/^([0-1]?[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/,hhmmssDesc:"时分秒"};var t={wall:{name:"墙体",scene:!0,mode:["normal","FOC"]},caigang:{name:"彩钢瓦墙体",scene:!0,subType:!0,mode:["normal","FOC"]},brick:{name:"混转墙体墙体",scene:!0,subType:!0,mode:["normal","FOC"]},window:{name:"窗户",scene:!0,subType:!0,mode:["normal","FOC"]},door:{name:"门",scene:!0,mode:["normal","FOC"]},securityDoor:{name:"防盗门",scene:!0,mode:["normal","FOC"]},fireProofDoor:{name:"防火门",scene:!0,mode:["normal","FOC"]},cabinet:{name:"机柜",scene:!0,mode:["normal","FOC"]},rack:{name:"蓄电池机架",scene:!0,mode:["normal","FOC"]},light:{name:"灯",scene:!0,mode:["normal","FOC"]},television:{name:"电视",scene:!0,mode:["normal","FOC"]},trashBin:{name:"垃圾桶",scene:!0,mode:["normal","FOC"]},FireExtinguisher:{name:"灭火器",scene:!0,mode:["normal","FOC"]},plant:{name:"盆栽",scene:!0,mode:["normal","FOC"]},plant2:{name:"盆栽2",scene:!0,subType:!0,mode:["normal","FOC"]},plant3:{name:"盆栽3",scene:!0,subType:!0,mode:["normal","FOC"]},sofa:{name:"沙发",scene:!0,mode:["normal","FOC"]},sofaChair:{name:"沙发椅",scene:!0,mode:["normal","FOC"]},triangleTable:{name:"三角桌",scene:!0,mode:["normal","FOC"]},sofaTable:{name:"茶几",scene:!0,mode:["normal","FOC"]},noticeBoard:{name:"公告牌",scene:!0,mode:["normal","FOC"]},FOCProductionLine:{name:"光纤生产线",scene:!0,mode:["FOC"]},capsule1:{name:"单舱体",scene:!0,mode:[]},capsule2:{name:"双舱体",scene:!0,mode:[]},capsule3:{name:"三舱体",scene:!0,mode:[]},airCon:{name:"普通空调",mode:["normal"]},airCon_embed:{name:"普通空调",mode:["capsule"],sameDevice:!0},battery:{name:"蓄电池组",mode:["normal"]},battery_embed:{name:"蓄电池组",mode:["capsule"],sameDevice:!0},BBDS:{name:"BBDS",mode:["normal"]},camera:{name:"摄像头",mode:["normal"]},camera_ballshape:{name:"摄像头",mode:["normal"],sameDevice:!0},camera_gunshape:{name:"摄像头",mode:["normal"],sameDevice:!0},centralAircon:{name:"普通空调",mode:["normal"]},distributor:{name:"配电柜",mode:["normal"]},doorLock:{name:"非智能门禁",mode:["normal"]},doorMagnet:{name:"门磁",mode:["normal"]},elecMeter:{name:"智能电表（交流）",mode:["normal"]},FSU:{name:"FSU",mode:["normal"]},infraredSensor:{name:"红外传感器",mode:["normal"]},lightSwitch:{name:"智能灯控",mode:["normal"]},powerSupply:{name:"开关电源",mode:["normal"]},powerSupply_embed:{name:"开关电源",mode:["capsule"],sameDevice:!0},smokeSensor:{name:"烟雾传感器",mode:["normal"]},tempHumiSensor:{name:"温湿度传感器",mode:["normal"]},UPS:{name:"UPS",mode:["normal"]},waterSensor:{name:"水浸传感器",mode:["normal"]},lietougui:{name:"列头柜",mode:["normal"]},shunt:{name:"分路计量",mode:["normal"]},PDU:{name:"PDU",mode:["normal"]},superAirCon:{name:"精密空调",mode:["normal"]}};e.configurationDeviceMap=function(e){var n=[];for(var o in t)t[o].name===e&&n.push(o);return n},e.configurationDeviceMap.getList=function(n){var o=[];if(n){o=t;var i="";if(n.__forEach(function(e,t){i+=t+"_"+e}),!e.configurationDeviceMap[i]){n.__forEach(function(e,t){o=o.__filter(function(n,o){return"string"==typeof e?n[t].indexOf(e)>=0:!!n[t]==!!e})});var r=[];o.__forEach(function(e,t){r.push(t)}),e.configurationDeviceMap[i]=r}return e.configurationDeviceMap[i]}return t},e.util={browserInfo:function(){var e={appname:"unknown",version:0},t=window.navigator.userAgent.toLowerCase();return/(msie|firefox|opera|chrome|netscape)\D+(\d[\d.]*)/.test(t)?(e.appname=RegExp.$1,e.version=RegExp.$2):/version\D+(\d[\d.]*).*safari/.test(t)?(e.appname="safari",e.version=RegExp.$2):/(trident)\/([\d.]+)/.test(t)&&(e.appname="msie",e.version=11),e.isLtIE10="msie"===e.appname&&parseFloat(e.version)<10,e.isLtIE9="msie"===e.appname&&parseFloat(e.version)<9,e.isIE="msie"===e.appname,e}(),calcTextWidth:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return function(e,n){return t.font=n||"14px Arial",t.measureText(e).width}}(),print:function(t){"chrome"!==e.util.browserInfo.appname?alert("打印前，请根据实际情况手动设置纸张布局，建议使用【谷歌浏览器】进行打印前的参数配置"):alert("打印前，请根据实际情况手动设置纸张布局");var n=document.createElement("div");n.className="print-screen",n.innerHTML=$(t)[0].innerHTML,document.body.appendChild(n),window.print(),document.body.removeChild(n)},tabPage:{getInstance:function(e){return{pageList:e,currentIndex:0,currentPage:e[0],showPage:function(e){this.currentIndex=e,this.currentPage=this.pageList[e],window.setTimeout(function(){$(window).resize()},0)},isActive:function(e){return this.currentIndex===e}}}},strNull:function(e){return e&&""!==(""+e).replace(/\s/g,"")?e:null},isNull:function(e){return!e||""===(""+e).replace(/\s/g,"")},getParamsFromUrl:function(){var e=location.href,t=e.split("?")[1];if(!t)return{};for(var n=t.split("&"),o={},i=0;i<n.length;i++){var r=n[i].split("=")[0],s=n[i].split("=")[1];o[r]=decodeURIComponent(s)}return o},decodeToExcel:function(e,t){this.decode(e,t,"excel")},decodeToPdf:function(e,t){this.decode(e,t,"pdf")},decode:function(e,t,n){var o={pdf:"application/pdf",excel:"application/vnd.ms-excel"}[n],i={pdf:".pdf",excel:".xls"}[n];t=(t||"下载")+i;var r=new Blob([e],{type:o});if("msie"===this.browserInfo.appname)window.navigator.msSaveBlob(r,t);else{var s=URL.createObjectURL(r),a=document.createElement("a");a.download=t,a.setAttribute("href",s);var c=document.createEvent("MouseEvent");c.initEvent("click",!0,!0),a.dispatchEvent(c)}},checkPrivilege:function(e){return!0},getToggleParam:function(e,t,n,o){return"navTreeTarget"===e?{elem:t,fromCss:{left:"0px"},toCss:{left:"-232px"}}:"navTreeOther"===e?{elem:t,fromCss:{left:"248px"},toCss:{left:"0px"}}:{elem:t,fromCss:n,toCss:o}},borderColor:function(e){return{"border-color":e}},progressStyle:function(e,t){return{width:e+"%",background:t,"background-image":"none"}},time2Int:function(e){return e.split(":").reduce(function(e,t){return 60*e+ +t},0)},alarmStateColor:function(e){return e?"font-success":"font-danger"},backgroundColor:function(e){return{"background-color":e}}},e.formData=function(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t.join("&")},e.notify=function(e){var t={success:"成功",info:"信息",warn:"警告",error:"错误"};PNotify.prototype.options.styling="bootstrap2",new PNotify({type:e.type,title:t[e.type],text:e.text,delay:e.delay||2e3,align:"center",history:!1,width:"390px"})},e.getValidClass=function(e){if(void 0!==e&&!e.$pristine)return e.$valid?void e.$modelValue:"error"},e.currentMark="",function(){function t(e){e.type="httpRequest",e.requestId=o();var t={};i[e.requestId]=t,window.parent.postMessage(e,location.href);var n={success:function(e){return t.successCallback=e,n},error:function(e){return t.errorCallback=e,n}};return n}var n=0,o=function(){return n++};window.addEventListener("message",function(t){"httpResponse"===t.data.type&&(t.data.success?i[t.data.requestId].successCallback(t.data.data):i[t.data.requestId].errorCallback(t.data),delete i[t.data.requestId],e.$apply())});var i=[];if(window.$http=t,window.$http.post=function(e){return"string"==typeof e&&(e={url:arguments[0],data:arguments[1],options:arguments[2]}),e.method="post",t(e)},window.$http.get=function(e){return"string"==typeof e&&(e={url:arguments[0],data:arguments[1]}),e.method="get",t(e)},window.getFromVue=function(t,n){return new Promise(function(o){var i=function t(n){n.data.__messageId===r&&(window.removeEventListener("message",t),o(n.data.data),e.$apply())};window.addEventListener("message",i);var r=(new Date).getTime()+Math.floor(1e10*Math.random());window.parent.postMessage({type:"AngularToVue",__messageId:r,closure:n,callback:t.toString()},location.href)})},window.$state={go:function(e,t){t&&function e(t,n){for(var o in t){var i=t[o];n>7||"function"==typeof i?delete t[o]:"object"===(void 0===i?"undefined":_typeof(i))&&e(i,n+1)}}(t),window.getFromVue(function(e,t,n){return e.prototype.$store.state.menu.stateGo(n.url,n.params)},{url:e,params:t})}},window.getFromVue(function(e){return e.prototype.$store.state.menu.menuHeight}).then(function(t){e.__navbarTreeTop=t+50,e.$apply()}),window.getFromVue(function(e){return e.prototype.$allPrivilegeList}).then(function(t){e.privilegeCodes=t}),window.getFromVue(function(e,t){return t.stateParams}).then(function(e){window.$stateParams=e}),window.getFromVue(function(e,t){return t.SCENE_ASSETS_PATH}).then(function(e){window.ENV&&(window.ENV.SCENE_ASSETS_PATH=e),window.Scene3D&&(window.Scene3D.prototype.setting.ctx=e||"./js/scene")}),window.getFromVue(function(e){return e.prototype.$store.state.menu.currentMark}).then(function(t){e.currentMark=t||".."}),window.getFromVue(function(e){return e.prototype.$currentUser}).then(function(t){e.user=t}),window.getFromVue(function(e){return e.prototype.$store.state.menu.currentPageRoute}).then(function(t){e.currentPageRoute=t}),window.getFromVue(function(e){return e.prototype.$store.state.menu.$currentEnterprise}).then(function(t){e.enterprise=t}),window.ENV&&ENV.PROD)window.getFromVue(function(e){return e.prototype.$store.state.menu.navbarHideSidebar}).then(function(t){var n=document.createElement("style");n.innerText=t?"body > #page-wrapper{ position: absolute; left: 0; padding: 16px; } #page-content{ height:100%; }":"body > #page-wrapper{ position: absolute; left: 232px; padding: 16px; } #page-content{ height:100%; }",document.head.append(n),e.$apply()});else{var r=document.createElement("style");r.innerText="body > #page-wrapper{ top:72px; left: 248px; right:16px; bottom: 16px; margin: -16px; padding: 16px; }\n                #page-content{ height:100%; }",document.head.append(r)}}(),function(){var e=$.fn.modal;$.fn.modal=function(t){window.ENV&&ENV.PROD&&("show"===t?window.getFromVue(function(){document.querySelector("#side-bar-mask").style.display="block"}):window.getFromVue(function(e){document.querySelector("#side-bar-mask").style.display="none"})),e.call(this,t)}}()}]),window.timerTaskManager={singletonTimer:null,list:[],create:function(e,t,n){var o=window.setInterval(function(){e()},t);return n?(window.clearInterval(this.singletonTimer),this.singletonTimer=o):this.list.push(o),o},clearAll:function(e){for(var t=0;t<this.list.length;t++)window.clearInterval(this.list[t]);this.list=[],e&&(window.clearInterval(this.singletonTimer),this.singletonTimer=null)}},function(){function e(e){var t=e.data.callback.match(/\((.*?)\)/)[1],o=e.data.callback.match(/\{([\s\S]*?)\}/)[1],i=new Function(t,o),r={__messageId:e.data.__messageId,data:i(n,window)};window.parent.postMessage(r,location.href)}var t=[],n=null;scloudApp.run(["$rootScope",function(o){t.forEach(function(t){e(t)}),n=o}]),window.addEventListener("message",function(o){if("VueToAngular"===o.data.type)return n?void e(o):void t.push(o)})}(),function(){window.registerMainRouter=function(pageUrl,scriptUrl,controllerName){scloudApp.config(["$stateProvider","$urlRouterProvider","$controllerProvider",function($stateProvider,$urlRouterProvider,$controllerProvider){function createState(pageUrl,scriptUrl,controllerName){var url=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"/";return{url:url,templateProvider:["$http",function(e){return e.get(pageUrl).then(function(e){return e.data})}],resolve:{controllerName:["$timeout","$q","$http",function($timeout,$q,$http){var deferred=$q.defer();return $http.get(scriptUrl).then(function(response){var res="//@ sourceURL="+scriptUrl+"\n"+response.data;eval(res),setTimeout(function(){deferred.resolve(controllerName)},50)}),deferred.promise}]},controllerProvider:["controllerName",function(e){return e}],ts:(new Date).toString()}}scloudApp.controller=$controllerProvider.register,"alarmSettingController"===controllerName?(window.location.hash="#/setting",$stateProvider.state("main",createState(pageUrl,scriptUrl,controllerName,"/setting")),["shield","delay","filter","major","redefine"].forEach(function(e){$stateProvider.state("main."+e,createState(pageUrl.replace("setting",e),scriptUrl.replace("setting",e),"alarm"+e[0].toUpperCase()+e.substr(1)+"Controller","/"+e)),$("head").append('<link rel="stylesheet" type="text/css" charset="utf-8" href="../../css/content/alarm/'+e+'.css" />')})):$stateProvider.state("main",createState(pageUrl,scriptUrl,controllerName,location.hash.replace("#","")))}])}}(),scloudApp.factory("ajaxInterceptor",["$rootScope",function(e){return{request:function(e){return e.headers["X-Requested-With"]="XMLHttpRequest",e},response:function(e){return e},requestError:function(e){return e},responseError:function(t){return t.status===e.CONST.statusCode.notFound?(e.notify({type:"error",text:t.status+"：请求路径未找到"}),!1):t.status===e.CONST.statusCode.badRequest?(e.notify({type:"error",text:t.status+"：请求格式错误"}),!1):t.status===e.CONST.statusCode.internalServerError?(e.notify({type:"error",text:t.status+"：内部服务器出错"}),!1):t.status===e.CONST.statusCode.requestFrequent?(e.notify({type:"warn",text:t.status+"：请求过于频繁"}),!1):t.status===e.CONST.statusCode.sessionTimeout?(location.href=ctx+"/res/index.html",!1):t}}}]),scloudApp.config(["$httpProvider",function(e){e.interceptors.push("ajaxInterceptor")}]),scloudApp.config(["$compileProvider",function(e){e.imgSrcSanitizationWhitelist(/^\s*(https?|blob):/)}]),scloudApp.service("verifyCodeService",["$rootScope","$http",function(e,t){window.ENV&&window.ENV.PROD&&(t=window.$http),this.sendPhoneCode=function(n){t.post(e.currentMark+"/phoneFunc/sendPhoneCode",n).success(function(t){if(!1===t.success)return void e.notify({type:"warn",text:"验证短信发送失败"});e.notify({type:"success",text:"验证短信已发送"})}).error(function(){console.error("验证短信发送请求失败")})},this.sendForgetPwdPhoneCode=function(n,o){t.post(e.currentMark+"/phoneFunc/sendForgetPwdPhoneCode",n).success(function(t){if(o(t),!1===t.success)return void e.notify({type:"warn",text:"验证短信发送失败"});e.notify({type:"success",text:"验证短信已发送"})}).error(function(){console.error("验证短信发送请求失败")})},this.checkPhone=function(n,o,i,r){t.post(e.currentMark+"/phoneFunc/checkPhone",{objForCheck:n,code:o}).success(function(e){if(!1===e.success)return void r(e);i()}).error(function(){console.error("验证请求失败")})},this.checkPhoneExist=function(n,o){t.post(e.currentMark+"/phoneFunc/checkPhoneExist",n).success(function(e){o(e)}).error(function(){console.error("验证手机号是否存在请求失败")})}}]),scloudApp.service("initService",["$rootScope",function(e){window.ENV&&window.ENV.PROD&&($http=window.$http),this.initDatetimePicker=function(){var e={onClose:!1,format:"YYYY/MM/DD hh:mm:ss",donefun:function(e){$(e.elem).trigger("input")},clearfun:function(e){$(this.valCell).trigger("input")}};$(".startTime,.endTime").each(function(){var t,n=$.extend({},e);(t=$(this).attr("setting"))&&(n=$.extend(n,JSON.parse(t))),jeDate(this.querySelector("input"),n)})},this.initNiceScroll=function(){setTimeout(function(){$(".scroll").each(function(){new PerfectScrollbar(this)})},100)},this.initTooltip=function(){setTimeout(function(){$("[data-toggle='tooltip']").tooltip()},500)},this.initClipboard=function(){if(!0!==e.isClipboardInited){new Clipboard(".clipboard").on("success",function(t){e.notify({type:"success",text:"复制成功"})}),e.isClipboardInited=!0}},this.initAll=function(){this.initDatetimePicker(),this.initNiceScroll(),this.initTooltip(),this.initClipboard()}}]),scloudApp.service("enterpriseService",["$rootScope","$http",function(e,t){window.ENV&&window.ENV.PROD&&(t=window.$http),this.getEnterpriseList=function(n,o){t.post(e.currentMark+"/enterpriseFunc/enterprise/list").success(function(t){if(!1===t.success)return e.notify({type:"warn",text:"统计信息获取失败"}),void o();n(t.data)}).error(function(){console.error("统计信息获取请求失败！")})},this.addEnterprise=function(n,o){t.post(e.currentMark+"/enterpriseFunc/enterprise/add",n).success(function(t){if(!1===t.success)return void e.notify({type:"warn",text:"企业添加失败"});e.notify({type:"success",text:"企业添加成功"}),o(t.data)}).error(function(){console.error("企业添加请求失败！")})},this.modifyEnterprise=function(n,o){t.post(e.currentMark+"/enterpriseFunc/enterprise/update",n).success(function(t){if(!1===t.success)return void e.notify({type:"warn",text:"修改失败"});e.notify({type:"success",text:"修改成功"}),o(t)}).error(function(){console.error("修改请求失败！")})},this.addAgency=function(n,o){t.post(e.currentMark+"/agencyFunc/addAgency",n).success(function(t){if(!1===t.success)return void e.notify({type:"warn",text:"添加失败"});e.notify({type:"success",text:"添加代理商成功"}),o(t.data)}).error(function(){console.error("添加请求失败！")})},this.getEnterpriseStatList=function(n,o){t.post(e.currentMark+"/enterpriseFunc/enterprise/stat/list").success(function(t){if(!1===t.success)return e.notify({type:"warn",text:"统计信息获取失败"}),void o();n(t.data)}).error(function(){console.error("统计信息获取请求失败！")})},this.getAgencyList=function(n){t.post(e.currentMark+"/agencyFunc/getAgencyFacadeView").success(function(e){if(!1===e.success)return void console.error("获取代理商列表失败");n(e.data)}).error(function(){console.error("获取代理商列表请求失败")})},this.intoEnterprise=function(n,o){t.post(e.currentMark+"/agencyFunc/agentLogin",n).success(function(e){if(!1===e.success)return void console.error("获取代理商列表失败");o(e.data)}).error(function(){console.error("获取代理商列表请求失败")})},this.setModuleEnbale=function(n,o,i,r){t.post(e.currentMark+"/enterpriseFunc/setModuleEnable",{enterpriseId:n,moduleType:o,enable:i}).success(function(e){if(!1===e.success)return void console.error("设置模块失败");r()}).error(function(){console.error("设置模块请求失败")})},this.clearUniqueCode=function(){t.post(e.currentMark+"/commonFunc/uniqueCode/clear").success(function(e){e.success}).error(function(){console.error("清除uniqueCode请求失败")})},this.checkUniqueCode=function(n,o){t.post(e.currentMark+"/enterpriseFunc/checkUniqueCode",n).success(function(e){o(e)}).error(function(){console.error("/enterpriseFunc/checkUniqueCode请求失败")})},this.modifyPollingInterval=function(n,o,i){t.post(e.currentMark+"/enterpriseFunc/setPollingInterval",n).success(function(t){if(!1===t.success)return e.notify({type:"warn",text:"FSU轮询时间修改失败"}),void i();e.notify({type:"success",text:"FSU轮询时间修改成功"}),o()}).error(function(){console.error("FSU轮询时间修改请求失败")})},this.modifyRefreshInterval=function(n,o,i){t.post(e.currentMark+"/enterpriseFunc/setRefreshInterval",n).success(function(t){if(!1===t.success)return e.notify({type:"warn",text:"页面刷新间隔修改失败"}),void i();e.notify({type:"success",text:"页面刷新间隔修改成功"}),o()}).error(function(){console.error("页面刷新间隔修改请求失败")})},this.modifyAlarmInterval=function(n,o,i){t.post(e.currentMark+"/enterpriseFunc/updateAlarmReminder",n).success(function(t){if(!1===t.success)return e.notify({type:"warn",text:"告警刷新间隔修改失败"}),void i();e.notify({type:"success",text:"告警刷新间隔修改成功"}),o()}).error(function(){console.error("告警刷新间隔修改请求失败")})},this.getAlarmConfig=function(n){t.post(e.currentMark+"/alarmConfigFunc/config/get").success(function(t){if(!1===t.success)return void e.notify({type:"warn",text:"获取告警配置失败"});e.CONST.alarmConfigList=t.data;for(var o=[],i=[],r=0;r<t.data.length;r++)o.push(t.data[r].color),i.push(t.data[r].audio);e.CONST.alarmColorList=o,e.CONST.alarmAudioList=i,n&&n()}).error(function(){console.error("获取告警配置请求失败")})},this.modifyAlarmConfig=function(n,o){t.post(e.currentMark+"/alarmConfigFunc/config/update",{list:n}).success(function(t){if(!1===t.success)return void e.notify({type:"warn",text:"修改告警配置失败"});e.notify({type:"success",text:"修改告警配置成功"}),o()}).error(function(){console.error("修改告警配置请求失败")})}}]),scloudApp.service("indexService",["$rootScope","$http",function(e,t){window.ENV&&window.ENV.PROD&&(t=window.$http),this.checkLogin=function(n,o,i){t.post(e.currentMark+"/commonFunc/checkLogin",n).success(function(e){if(!1===e.success)return void i(e.info);o(e.data)}).error(function(){console.error("登录请求失败")})},this.resetpwd=function(n,o,i){t.post(e.currentMark+"/commonFunc/password/reset",n).success(function(e){if(!1===e.success)return void i(e);o(e)}).error(function(){console.error("重置密码请求失败")})}}]),scloudApp.controller("indexController",["$scope","$rootScope","indexService","verifyCodeService",function(e,t,n,o){e.login={form:{},obj:{},toModal:null,execute:null,clear:null},e.forget={form:{},obj:{},toModal:null,execute:null,clear:null,have:!0},e.isLoginPanel=!0,e.login.execute=function(){n.checkLogin({loginName:e.login.obj.loginName,password:e.login.obj.password},function(t){e.pwdErrorInfo="",location.href=ctx+"/res/main.html#"+t},function(t){e.pwdErrorInfo=t})},e.sendPhoneCode=function(t){o.sendForgetPwdPhoneCode(t,function(t){!1===t.success?e.forget.have=!0:e.forget.have=!1})},e.forget.execute=function(){n.resetpwd({phone:e.forget.obj.phone,password:e.forget.obj.password,code:e.forget.obj.messageCode},function(n){t.notify({type:"success",text:"密码重置成功，请登录"}),e.forget.clear(),e.toLogin()},function(t){e.codeErrorInfo=t.info})},e.forget.clear=function(){e.forget.obj={}},e.toLogin=function(){e.isLoginPanel=!0,e.clearErrorInfo()},e.toForgetpwd=function(){e.isLoginPanel=!1,e.clearErrorInfo()},e.clearErrorInfo=function(){e.pwdErrorInfo="",e.codeErrorInfo=""}}]);