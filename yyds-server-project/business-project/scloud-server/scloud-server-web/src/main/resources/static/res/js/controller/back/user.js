scloudApp.controller("backUserController",["$scope","$rootScope","userService","verifyCodeService","enterpriseService",function(e,s,r,n,o){function t(){e.isLoading=!0,r.getBackUserList(e.paginationConf,e.userQuery,function(s){e.isLoading=!1,e.paginationConf.totalItems=s.count,e.userList=s.list},function(){e.isLoading=!1})}function a(e){for(var s=[],r=0;r<e.length;r++)s.push(e[r].id);return s}function i(){o.getAgencyList(function(s){e.agencyList=s})}$state&&($state=window.$state),$stateParams&&($stateParams=window.$stateParams),e.userQuery={},e.addAgency={form:{},obj:{},toModal:null,execute:null,clear:null},e.addUser={form:{},obj:{},toModal:null,execute:null,clear:null},e.modifyUser={form:{},obj:{},toModal:null,execute:null,clear:null},e.updateUserEnterprise={form:{},obj:{},toModal:null,execute:null,clear:null},e.isLoading=!1,e.paginationConf={currentPage:1,itemsPerPage:15,pagesLength:9,onChange:function(){}},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",t),e.query=function(){t()},e.reset=function(){e.userQuery={}},e.exportBackUserList=function(){e.isExportUserListLoading=!0,r.exportBackUserList(e.userQuery,function(){e.isExportUserListLoading=!1})},e.addAgency.toModal=function(){$("#addAgencyModal").modal("show")},e.addAgency.execute=function(){e.addAgency.obj.receiveAlarmMsg=e.addAgency.obj.receiveAlarmMsg||"0",o.addAgency(e.addAgency.obj,function(){t(),i(),e.addAgency.clear()})},e.addAgency.clear=function(){e.addAgency.form.$setPristine(),e.addAgency.obj={},$("#addAgencyModal").modal("hide")},e.checkPhoneExist=function(s){e.phoneExistInfo="",n.checkPhoneExist(s,function(s){e.isPhoneExist=!s.success,e.phoneExistInfo=s.info})},e.addUser.toModal=function(){s.user.classes===s.CONST.userClasses.techSupport?e.classesList=[s.CONST.userClasses.agency,s.CONST.userClasses.techSupport]:s.user.classes===s.CONST.userClasses.agency&&(e.classesList=[s.CONST.userClasses.agency],e.addUser.obj.companyId=s.user.companyId),$("#addUserModal").modal("show")},e.addUser.execute=function(){e.addUser.obj.type===s.CONST.userType.ordinary&&(e.addUser.obj.userGroup=s.CONST.userGroup.read),e.addUser.obj.classes===s.CONST.userClasses.techSupport&&(e.addUser.obj.companyId=null),r.addUser(e.addUser.obj,function(){t(),e.addUser.clear()})},e.addUser.clear=function(){e.addUser.form.$setPristine(),e.addUser.obj={},e.isPhoneExist=!1,e.phoneExistInfo="",$("#addUserModal").modal("hide")},e.modifyUser.toModal=function(s){e.modifyUser.obj=angular.copy(s),e.modifyUser.originalUser=s,$("#modifyUserModal").modal("show")},e.modifyUser.execute=function(){r.modifyUser(e.modifyUser.obj,function(){t(),e.modifyUser.clear()})},e.modifyUser.clear=function(){e.modifyUser.form.$setPristine(),e.modifyUser.obj={},e.isPhoneExist=!1,e.phoneExistInfo="",$("#modifyUserModal").modal("hide")},e.updateUserEnterprise.toModal=function(s){r.getUserEnterprise(s.id,function(r){var n=[];r&&r.forEach(function(s){n.push({id:s,text:e.enterpriseMap[s]})}),e.updateUserEnterprise.obj={userId:s.id,name:s.name,enterprises:n},$("#updateUserEnterpriseModal").modal("show")})},e.updateUserEnterprise.execute=function(){e.updateUserEnterprise.obj.companyIds=a(e.updateUserEnterprise.obj.enterprises),r.updateUserEnterprise(e.updateUserEnterprise.obj,function(){e.updateUserEnterprise.clear()})},e.updateUserEnterprise.clear=function(){e.updateUserEnterprise.form.$setPristine(),e.updateUserEnterprise.obj={},$("#updateUserEnterpriseModal").modal("hide")},function(){r.getTypeList(function(s){e.typeList=s})}(),function(){o.getEnterpriseList(function(s){for(var r=[],n={},o=0;o<s.length;o++)r.push({id:s[o].enterprise.id,text:s[o].enterprise.name}),n[s[o].enterprise.id]=s[o].enterprise.name;e.enterpriseList={data:r},e.enterpriseMap=n})}(),i()}]);