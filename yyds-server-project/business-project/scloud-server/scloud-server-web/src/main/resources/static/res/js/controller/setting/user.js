scloudApp.controller("userController",["$scope","$rootScope","userService","verifyCodeService","fileUploadService","privilegeService","treeService",function(e,o,i,r,t,n,s){function d(){e.isLoading=!0,i.getUserList(e.paginationConf,e.userQuery,function(o){e.isLoading=!1,e.paginationConf.totalItems=o.count,e.userList=o.list},function(){e.isLoading=!1})}function l(){i.getLowerUserList(function(o){e.lowerUserIds=o})}function a(){i.getDepartmentList(function(o){e.departmentList=o.filter(function(e){return"维护人员组"!==e})})}$state&&($state=window.$state),$stateParams&&($stateParams=window.$stateParams),e.isLoading=!1,e.isPhoneExistWhenAdd=!1,e.isPhoneExistWhenModify=!1,e.userQuery={},e.addUser={form:{},obj:{},toModal:null,execute:null,clear:null,style:!1},e.modifyUser={form:{},obj:{},toModal:null,execute:null,clear:null,style:!1},e.deleteUser={form:{},obj:{},toModal:null,execute:null,clear:null},e.modifyTier={form:{},obj:{},toModal:null,execute:null,clear:null},e.addUsers={form:{},obj:{},toModal:null,execute:null,select:null,clear:null},e.paginationConf={currentPage:1,itemsPerPage:15,pagesLength:9,onChange:function(){}},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.query=function(){d()},e.reset=function(){e.userQuery={}},e.exportUserList=function(){e.exportUserList.have=!1,i.exportUserList(e.userQuery,function(){})},e.exportUserList.have=!0,e.exportUserListPdf=function(){e.exportUserListPdf.have=!1,i.exportUserListPdf(e.userQuery,function(){})},e.exportUserListPdf.have=!0,e.addUser.toModal=function(){$("#addUserModal").modal("show")},e.addUser.execute=function(){$("#addUserModal").modal("hide"),i.addUser(e.addUser.obj,function(){d(),a(),l(),e.addUser.clear()})},e.addUser.clear=function(){e.addUser.form.$setPristine(),e.addUser.obj={},e.isPhoneExist=!1,e.phoneExistInfo="",$("#addUserModal").modal("hide")},e.checkPhoneExist=function(o){e.phoneExistInfo="",r.checkPhoneExist(o,function(o){e.isPhoneExist=!o.success,e.phoneExistInfo=o.info})},e.modifyUser.toModal=function(o){e.modifyUser.obj=angular.copy(o),e.modifyUser.originalUser=o,$("#modifyUserModal").modal("show"),e.modifyUser.obj.informRule=e.alarmInformList.filter(function(o){return o.strId===e.modifyUser.obj.informRule.strId})[0]},e.modifyUser.execute=function(){$("#modifyUserModal").modal("hide"),i.modifyUser(e.modifyUser.obj,function(){d(),a(),e.modifyUser.clear()})},e.modifyUser.clear=function(){e.modifyUser.form.$setPristine(),e.modifyUser.obj={},e.isPhoneExist=!1,e.phoneExistInfo="",$("#modifyUserModal").modal("hide")},e.modifyTier.toModal=function(o){e.modifyTier.obj={name:o.name,userId:o.id},i.getUserTier(o.id,function(o){e.modifyTier.obj.tierCodes=o,s.checkNodeByCodes("areaTree",o),$("#modifyTierModal").modal("show")})},e.modifyTier.execute=function(){e.modifyTier.obj.tierCodes=s.getCheckedTierCodes("areaTree"),i.modifyUserTier(e.modifyTier.obj,function(){d(),l(),e.modifyTier.clear()})},e.modifyTier.clear=function(){e.modifyTier.form.$setPristine(),e.modifyTier.obj={},$("#modifyTierModal").modal("hide")},e.deleteUser.toModal=function(o){e.deleteUser.obj=o,$("#deleteUserModal").modal("show")},e.deleteUser.execute=function(){$("#deleteUserModal").modal("hide"),i.deleteUser(e.deleteUser.obj.id,function(){d(),a(),e.deleteUser.clear()})},e.deleteUser.clear=function(){e.deleteUser.form.$setPristine(),$("#deleteUserModal").modal("hide")},e.addUsers.toModal=function(){$("#addUsersModal").modal("show"),e.fileUpload=t.getFileUpload()},e.addUsers.select=function(){e.fileUpload.selectFile("fileUploadBtn")},e.addUsers.execute=function(){e.fileUpload.upload("/userFunc/addMultiUser",function(i){if($("#addUsersModal").modal("hide"),e.addUsers.clear(),!1===i.success)return void o.notify({type:"error",text:i.info});o.notify({type:"success",text:"导入成功"}),d(),a(),l()},function(){$("#addUsersModal").modal("hide"),e.addUsers.clear(),console.log("请求失败")})},e.addUsers.clear=function(){$("#addUsersModal").modal("hide"),e.fileUpload.files=null,e.fileUpload.info={id:null,name:null,url:null,size:null,progress:null}},function(){e.treeLoading=!0,s.getUserTierTree(null,function(o){e.treeLoading=!1,e.zTree=s.createZTree(o),s.initTree(e.zTree.zNodes,"areaTree","checkboxTierTreeOpenOne")})}(),function(){i.getTypeList(function(o){e.typeList=o})}(),function(){n.getUserGroupList(function(o){e.userGroupList=o.filter(function(e){return"维护人员组"!==e.name})})}(),l(),a(),function(){i.getAlarmInformList(function(o){e.alarmInformList=o})}()}]);