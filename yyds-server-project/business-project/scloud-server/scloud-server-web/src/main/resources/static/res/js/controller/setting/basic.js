scloudApp.controller("basicController",["$scope","$rootScope","treeService","deviceService","enterpriseService","fileUploadService",function(e,i,o,l,t,n){function a(){e.isLoading=!0,o.getAllTierTree(null,function(i){e.isFirstTime=!1,e.isLoading=!1,e.zTree=o.createZTree(i),o.initTree(e.zTree.zNodes,"areaTree","simpleTierTree")},function(){e.isFirstTime=!0,o.getDefaultTierTree(function(i){e.isLoading=!1,e.zTree=o.createZTree(i),o.initTree(e.zTree.zNodes,"areaTree","simpleTierTree")})})}function r(){e.modifyAlarmConfig.obj.alarmConfig=angular.copy(i.CONST.alarmConfigList),e.modifyAlarmConfig.obj.alarmConfig.forEach(function(i){i.audio=e.alarmAudioList.filter(function(e){return e.id===i.audio})[0]}),c()}function u(){t.getAlarmConfig(function(){r()})}function c(){$("#level1").colpick({layout:"rgbhex",submit:1,colorScheme:"dark",color:e.modifyAlarmConfig.obj.alarmConfig[0].color,onSubmit:function(i,o,l,t){$(t).colpickHide(),e.modifyAlarmConfig.obj.alarmConfig[0].color="#"+o,e.$apply()}}),$("#level2").colpick({layout:"rgbhex",submit:1,colorScheme:"dark",color:e.modifyAlarmConfig.obj.alarmConfig[1].color,onSubmit:function(i,o,l,t){$(t).colpickHide(),e.modifyAlarmConfig.obj.alarmConfig[1].color="#"+o,e.$apply()}}),$("#level3").colpick({layout:"rgbhex",submit:1,colorScheme:"dark",color:e.modifyAlarmConfig.obj.alarmConfig[2].color,onSubmit:function(i,o,l,t){$(t).colpickHide(),e.modifyAlarmConfig.obj.alarmConfig[2].color="#"+o,e.$apply()}}),$("#level4").colpick({layout:"rgbhex",submit:1,colorScheme:"dark",color:e.modifyAlarmConfig.obj.alarmConfig[3].color,onSubmit:function(i,o,l,t){$(t).colpickHide(),e.modifyAlarmConfig.obj.alarmConfig[3].color="#"+o,e.$apply()}})}function m(){var o=i.enterprise.alarmInterval,l=i.enterprise.keepTime;e.modifyAlarmInterval._interval=!o||o<0?300:o,e.modifyAlarmInterval.interval=o||-1,e.modifyAlarmInterval._keepTime=!l||l<0?60:l,e.modifyAlarmInterval.keepTime=l||-1}$state&&($state=window.$state),$stateParams&&($stateParams=window.$stateParams),e.setCustomTier={form:{},toModal:null,execute:null,select:null,clear:null,loading:null},e.setDefaultTier={toModal:null,execute:null,clear:null,loading:null},e.modifyAlarmColor={form:{},obj:{},execute:null,clear:null},e.importDeviceSignalType={form:{},toModal:null,execute:null,select:null,clear:null,loading:!1},e.alarmAudioList=new Array(4).join(" ").split(" ").map(function(e,i){return i++,{name:"提示音"+i,id:"alarm"+i+".mp3",src:ctx+"/res/audio/alarm/alarm"+i+".mp3"}}),e.alarmIntervals=[300,600,900],e.alarmKeepTimes=[60,120,300],e.alarmLevelList=[0,1,2,3],e.isFirstTime=!1,e.isLoading=!1,e.isLoading2=!1,e.setDefaultTier.toModal=function(o){if(!1===e.isFirstTime)return i.notify({type:"warn",text:"已经设置过站点分级了"}),void o.stopPropagation();$("#setDefaultTierModal").modal("show")},e.setDefaultTier.execute=function(){o.setDefaultTierTree(i.enterprise.uniqueCode,function(){e.setDefaultTier.clear(),e.setDefaultTier.loading=!1,e.isFirstTime=!1,a(),i.getNavInfo()}),e.setDefaultTier.loading=!0},e.setDefaultTier.clear=function(){$("#setDefaultTierModal").modal("hide")},e.setCustomTier.toModal=function(o){if(!1===e.isFirstTime)return i.notify({type:"warn",text:"已经设置过站点分级了"}),void o.stopPropagation();$("#setCustomTierModal").modal("show"),e.fileUpload=n.getFileUpload()},e.setCustomTier.select=function(){e.fileUpload.selectFile("fileUploadBtn")},e.setCustomTier.execute=function(){e.fileUpload.upload("/systemFunc/importTierTree?uniqueCode="+i.enterprise.uniqueCode,function(o){if(e.setCustomTier.clear(),e.setCustomTier.loading=!1,!1===o.success)return void i.notify({type:"error",text:o.info});i.notify({type:"success",text:"设置成功"}),e.isFirstTime=!1,a(),i.getNavInfo()},function(){e.setCustomTier.clear(),e.setCustomTier.loading=!1,console.log("请求失败")}),e.setCustomTier.loading=!0},e.setCustomTier.clear=function(){$("#setCustomTierModal").modal("hide"),e.fileUpload.files=null,e.fileUpload.info={id:null,name:null,url:null,size:null,progress:null}},e.modifyAlarmConfig={obj:{},execute:function(){var i=e.modifyAlarmConfig.obj.alarmConfig.map(function(e){return{id:e.id,level:e.level,color:e.color,audio:e.audio&&e.audio.id||""}});t.modifyAlarmConfig(i,function(){u()}),e.modifyAlarmInterval.execute()},clear:function(){e.modifyAlarmConfig.obj.alarmConfig=angular.copy(i.CONST.alarmConfigList),e.modifyAlarmConfig.obj.alarmConfig.forEach(function(i){i.audio=e.alarmAudioList.filter(function(e){return e.id===i.audio})[0]}),m()}},e.$watch("enterprise",m),e.modifyAlarmInterval={_interval:null,interval:null,_keepTime:null,keepTime:null,toggle:function(){this.interval<0?(this.interval=this._interval,this.keepTime=this._keepTime):(this.interval=-1,this.keepTime=-1)},change:function(e){this._interval=this.interval},changeKeepTime:function(e){this._keepTime=this.keepTime},execute:function(){t.modifyAlarmInterval({alarmInterval:this.interval,keepTime:this.keepTime},function(){i.getEnterprise(function(){i.navAlarmIntervalFn(void 0,1),i.navAlarmIntervalFn(2,1)})})},audition:function(e){var i=$("#audition")[0];i.src=e,i.play()}},e.importDeviceSignalType.toModal=function(){$("#importDeviceSignalTypeModal").modal("show"),e.fileUpload=n.getFileUpload()},e.importDeviceSignalType.select=function(){e.fileUpload.selectFile("fileUploadBtn2")},e.importDeviceSignalType.execute=function(){e.fileUpload.upload("/systemFunc/importSignalType?uniqueCode="+i.enterprise.uniqueCode,function(o){if(e.importDeviceSignalType.clear(),e.importDeviceSignalType.loading=!1,!1===o.success)return void i.notify({type:"error",text:o.info});i.notify({type:"success",text:"设备、信号类型映射表导入请求成功"}),e.deviceTypeList=o.data},function(){e.importDeviceSignalType.clear(),e.importDeviceSignalType.loading=!1,console.log("设备、信号类型映射表导入请求失败")}),e.importDeviceSignalType.loading=!0},e.importDeviceSignalType.clear=function(){$("#importDeviceSignalTypeModal").modal("hide"),e.fileUpload.files=null,e.fileUpload.info={id:null,name:null,url:null,size:null,progress:null}},e.target=i.util.getToggleParam(null,["._top"],{height:"350px"},{height:"53px"}),e.other=i.util.getToggleParam(null,["._right"],{top:"374px"},{top:"77px"}),a(),u(),function(){e.isLoading2=!0,l.getDeviceTypeList(null,function(i){e.isLoading2=!1,e.deviceTypeList=i},function(){e.isLoading2=!1})}()}]);