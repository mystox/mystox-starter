<section id="alarmRedefinePage">
    <div class="_top card-bg">
        <div class="page-header">
            <h3>添加重定义规则</h3>
        </div>

        <div class="page-body">
            <form class="form-horizontal _top_left scroll" id="addRuleModal" name="addRule.form" novalidate ng-submit="addRule.execute();">
                <div class="control-group" ng-class="getValidClass(addRule.form.name) + ' ' +  (addRule.failToCheckRuleName && 'error')">
                    <label class="control-label">规则名称</label>
                    <div class="controls">
                        <input type="text" name="name" maxlength="15" ng-change="checkRuleName()" ng-model="addRule.obj.name" required>
                        <span class="help-inline"></span> <small class="font-danger" ng-show="addRule.failToCheckRuleName">规则名称重复</small>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">设备类型</label>
                    <div class="controls">
                        <select ng-options = "item as item.typeName for item in deviceList"  ng-model="addRule.obj.device" ng-change="changDevice()" required></select>
                        <span class="help-inline"></span>
                    </div>
                </div>

                <div class="control-group" ng-class="getValidClass(addRule.form.addSignal);">
                    <label class="control-label">选择信号类型</label>
                    <div class="controls">
                        <input type="text" class="form-control" multiple
                               ng-disabled = '!addRule.obj.device'
                               select2 config="signalList"
                               select2-model="addRule.obj.signalCodeList"/>
                    </div>
                </div>

                <div class="control-group" ng-class="getValidClass(addRule.form.alarmLevel);">
                    <label class="control-label">重定义为</label>
                    <div class="controls">
                        <select name="alarmLevel" ng-model="addRule.obj.alarmLevel" required
                                ng-options="item.key as item.value for item in alarmLevelList"></select>
                        <span class="help-inline"></span>
                    </div>
                </div>

                <div class="control-group" ng-class="getValidClass(addRule.form.reason);">
                    <label class="control-label">原因</label>
                    <div class="controls">
                        <textarea name="reason" ng-model="addRule.obj.reason" required></textarea>
                        <span class="help-inline"></span>
                    </div>
                </div>

                <div class="control-group">
                    <div class="controls">
                        <button type="submit" class="btn btn-primary"
                                ng-if="util.checkPrivilege(1302)"
                                ng-disabled="addRule.form.$invalid || addRule.obj.signalCodeList.length < 1 || addRule.obj.selectedSiteList.length < 1 || addRule.failToCheckRuleName">保存</button>

                        <button type="reset" class="btn btn-default" ng-click="addRule.clear();">清除</button>
                    </div>
                </div>
            </form>

            <form class="form-horizontal _top_right">

            <div class="control-group">
                <label class="control-label">选择站点</label>
                <div class="controls">
                    <input type="text" placeholder="搜索站点" ng-model="searchKey" ng-change="getNodesByParamFuzzy(searchKey, 'areaTree', 'radioSiteTree');">
                </div>
            </div>

            <div class="control-group">
                <div class="controls">
                    <div class="tree-box scroll">
                        <ul id="areaTree" class="ztree" ng-hide="zTree.isEmpty"></ul>
                        <div ng-show="zTree.isEmpty" class="no-data">
                            <div class="img img-1x"></div>
                        </div>
                        <div class="loader" ng-show="treeLoading">
                            <i class="ic ic-spinner ic-spin ic-5x"></i>
                        </div>
                    </div>
                    <i class="ic ic-angle-right"></i>
                    <select multiple="multiple" class="multiselect scroll"
                            ng-model="addRule.obj.removeSite"
                            ng-click="multiNodeSelect.remove(addRule.obj.removeSite,addRule.obj.selectedSiteList);"
                            ng-options="item as item.name for item in addRule.obj.selectedSiteList"></select>
                </div>
            </div>

        </form>
        </div>
    </div>
    <div class="_left card-bg">
        <div class="page-header">
            <h3>重定义规则</h3>
            <select title="启用状态" ng-model="ruleQuery.enabled" ng-options="item.key as item.value for item in CONST.enabledStateOptions" ng-change="query();">
                <option ng-bind="'全部'"></option>
            </select>
        </div>
        <div class="table-box scroll">
            <table scloud-table-head-fix class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>规则名称</th><th>状态</th><th>创建人</th><th>创建时间</th><th>操作</th>
                    </tr>
                </thead>
                <tbody ng-repeat="r in ruleList" ng-class="CONST.animation.list">
                    <tr ng-click="reGetSignalList(r)" class="cursor-point">
                        <td ng-bind="r.name"></td>
                        <td>
                            <label class="label" ng-class="{true:'font-success',false:'font-danger'}[r.enabled]" ng-bind="r.enabled | enabledFilter"></label>
                        </td>
                        <td ng-bind="r.creator.name"></td>
                        <td ng-bind="r.updateTime | date: 'yyyy-MM-dd HH:mm:ss'"></td>
                        <td>
                            <a ng-if="util.checkPrivilege(1312) && !r.enabled" ng-click="addRule.toModal(r);" title="修改" class="ic ic-edit"></a>
                            <a ng-if="util.checkPrivilege(1312) && !r.enabled" ng-click="changeState(r);" title="启用" class="ic ic-check"></a>
                            <a ng-if="util.checkPrivilege(1312) && r.enabled" ng-click="changeState(r);" title="禁用" class="ic ic-times"></a>
                            <a ng-click="getRuleDetail(r, $index);" title="详情" class="ic ic-detail"></a>
                            <a ng-if="!r.enabled" ng-click="deleteRule.toModal(r);" title="删除" class="ic ic-delete"></a>
                        </td>
                    </tr>
                    <tr ng-if="openDetailIndex !== null && openDetailIndex === $index" ng-class="CONST.animation.detail" ng-cloak>
                        <td colspan="5" class="detail">
                            <ul>
                                <li>重定义为：<span ng-bind="ruleDetail.targetLevel | nullFilter"></span></li>
                                <li>所选站点：
                                    <select multiple="multiple" readonly>
                                        <option ng-repeat="item in ruleDetail.siteInfoList track by $index" ng-bind="item"></option>
                                    </select>
                                </li>
                                <li>信号类型：
                                    <select multiple="multiple" readonly>
                                        <option ng-repeat="item in ruleDetail.signalInfoList track by $index" ng-bind="item"></option>
                                    </select>
                                </li>
                                <li>原因：<span ng-bind="ruleDetail.reason | nullFilter"></span></li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="loader" ng-show="isLoading">
            <i class="ic ic-spinner ic-spin ic-5x"></i>
        </div>
        <div class="no-data" ng-hide="isLoading || paginationConf.totalItems">
            <div class="img img-1x"></div>
        </div>
        <tm-pagination conf="paginationConf"></tm-pagination>
    </div>
        
    <div class="_right card-bg">
        <div class="page-header">
            <h3>重定义列表</h3>
        </div>
        <div class="table-box scroll">
            <table scloud-table-head-fix class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>规则名称</th><th>告警名称</th><th>站点名称</th><th>原等级</th><th>重定义等级</th><th>启用时间</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="r in redefinedList" ng-class="CONST.animation.list">
                        <td ng-bind="r.ruleName"></td>
                        <td ng-bind="r.alarmName"></td>
                        <td ng-bind="r.siteName"></td>
                        <td ng-style="util.alarmColor(r.sourceLevel);">
                            <i class="ic ic-alarm"></i>
                            <span ng-bind="r.sourceLevel | alarmLevelFilter"></span>
                        </td>
                        <td ng-style="util.alarmColor(r.targetLevel);">
                            <i class="ic ic-alarm"></i>
                            <span ng-bind="r.targetLevel | alarmLevelFilter"></span>
                        </td>
                        <td ng-bind="r.useTime | date: 'yyyy-MM-dd HH:mm:ss'"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="loader" ng-show="isLoading2">
            <i class="ic ic-spinner ic-spin ic-5x"></i>
        </div>
        <div class="no-data" ng-hide="isLoading2 || paginationConf2.totalItems">
            <div class="img img-1x"></div>
        </div>
        <tm-pagination conf="paginationConf2"></tm-pagination>
    </div>
        
    <div>
        <form class="modal hide form-horizontal" data-backdrop="static" id="deleteRuleModal"
              name="deleteRule.form" novalidate ng-submit="deleteRule.execute();">
            <div class="modal-header">
                <button type="reset" class="close" ng-click="deleteRule.clear();"><i class="ic ic-close"></i></button>
                <h3>删除重定义规则</h3>
            </div>
            <div class="modal-body scroll">
                <div class="notification">
                    <h4 class="title"><i class="ic ic-warning font-warning"></i>确定要删除该规则？</h4>
                    <p class="content">
                        确定要删除 <strong class="font-danger" ng-bind="deleteRule.obj.name"></strong> 这条重定义规则吗？
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary" ng-disabled="deleteRule.form.$invalid">确认</button>
                <button type="reset" class="btn btn-default" ng-click="deleteRule.clear();">取消</button>
            </div>
        </form>
    </div>
</section>