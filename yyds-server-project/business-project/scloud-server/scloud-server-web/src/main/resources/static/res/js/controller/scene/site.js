scloudApp.controller("sceneSiteController",["$scope","$rootScope","$state","treeService","siteService","cameraService","configurationService","$q","$stateParams","fsuService","deviceService","fileUploadService",function(e,i,t,n,o,r,a,c,d,s,l,u){function f(t,n,r){e.treeLoading=!0,e.$$phase||e.$apply(),o.querySite({siteCode:r.code,tierCodes:[r.code.substr(0,6)],serverCode:e.user.serverCode},function(t){e.currentSite=t[0],e.currentSite.fsuState=t.fsuState,window.videoPlayerInScene.disposePlayer(),clearTimeout(window.refreshDeviceTimer),clearInterval(window.refreshDeviceInterval),v().then(function(){var i=c.defer(),t=i.promise;return c.all([I(),C()]).then(h).then(F).then(S).then(function(){e.treeLoading=!1}).catch(function(i){a.scene_import([{}],function(){}),e.treeLoading=!1}),c.all([M(),L()]).then(function(){i.resolve()}).catch(function(){e.treeLoading=!1}),t}).then(function(){O()}).catch(function(){e.treeLoading=!1}),e.c++,i.loadCount++})}function m(){window.scene3D||(window.scene3D=new Scene3D),e.scene3D=window.scene3D}function v(){var i=c.defer(),t=i.promise;return a.getDevicesListApi(e.currentSite.code,function(t,n){e.deviceList=t,e.fsuAndDevice=n,i.resolve()}),t}function p(){e.treeLoading=!0,n.getSiteMapTree({serverCode:e.user.serverCode},function(i){e.treeLoading=!1,e.zTree=n.createZTree(i),n.initTree(e.zTree.zNodes,"areaTree","radioSiteTree",f),n.checkNodeBySiteId("areaTree",d.siteId)})}function h(i){var t=c.defer(),n=t.promise;return a.executeModelFile(function(){e.deviceTypeList=a.sliceObjectToArray(e.devices,6,!0),e.sceneModelList=a.sliceObjectToArray(e.devices,6,!1),a.scene_import(i[0]||{},function(){a.showLoadingBar(!1,100),t.resolve()})}),n}function I(){var i=c.defer(),t=i.promise;return a.loadSceneApi({siteId:e.currentSite.siteId},function(t){e.devicesNeedLoad=sceneIO.getDeviceTypeFromSaveData(t),i.resolve(t)}),t}function S(){var i=c.defer(),t=i.promise,n=[];for(var o in e.devicesInScene)n.push(e.devicesInScene[o]);e.deviceIdListInScene=n.filter(function(e){return e}).map(function(e){return e.map(function(e){return e.code})}).join(",").split(",").filter(function(e){return!!e});for(var r=0;r<e.deviceAndFsu.length;r++)e.deviceAndFsu[r].infoList.map(function(i){i.isInScene=-1!==e.deviceIdListInScene.indexOf(i.deviceCode||i.code+"")});return i.resolve(),t}function g(){var i=c.defer(),t=i.promise;return a.getRoomHistoryAlarm({siteId:e.currentSite.id},function(t){e.historyAlarmCounts=[{value:t.level1,name:"一级告警"},{value:t.level2,name:"二级告警"},{value:t.level3,name:"三级告警"},{value:t.level4,name:"四级告警"}],e.allHistoryAlarmCounts=t.level1+t.level2+t.level3+t.level4,i.resolve()}),t}function y(){document.getElementById(e.allAlarmCountPie)&&chart.alarmCountPie({id:e.allAlarmCountPie,name:"0个",title:" ",data:e.historyAlarmCounts})}function b(){var i=c.defer(),t=i.promise;return a.getRoomHistoryTop({siteId:e.currentSite.id},function(t){e.historyAlarmTop3=t,i.resolve()}),t}function T(){var i=c.defer(),t=i.promise;if(document.getElementById(e.top3AlarmLineForScene)){for(var n=e.historyAlarmTop3,o={alarmNames:[n.signal01?n.signal01.name:"",n.signal02?n.signal02.name:"",n.signal03?n.signal03.name:""],counts:[n.infoList?n.infoList.map(function(e){return e.time}):[],n.infoList?n.infoList.map(function(e){return e.count1}):[],n.infoList?n.infoList.map(function(e){return e.count2}):[],n.infoList?n.infoList.map(function(e){return e.count3}):[]]},r=$.extend([],o.alarmNames),a=$.extend([],o.counts),d=0;d<3;d++)r[d]?r[d]=d+1+" "+r[d]:r[d]=d+1+" 暂无";return chart.alarmLine({id:e.top3AlarmLineForScene,title:" ",color:["#7C41F5","#00B1FF","#FFB700"],seriesName:r,series:[a[1],a[2],a[3]],xAxis:{data:a[0]}}),i.resolve(),t}}function L(){var i=c.defer(),t=i.promise;return a.getSiteInfo({siteId:e.currentSite.siteId},function(t){e.currentSite.deviceNum=t.deviceNum,e.currentSite.signalNum=t.signalNum,i.resolve()}),t}function C(){var i=c.defer(),t=i.promise;e.deviceAndFsu=[],e.deviceListInSite=e.fsuAndDevice;var n=e.deviceListInSite.filter(function(e){return"FSU动环主机"===e.type}),o=e.deviceListInSite.filter(function(e){return-1==n.indexOf(e)});return e.deviceListInSite=[].concat(n).concat(o),e.deviceList.forEach(function(e){return e.id=e.code}),setTimeout(function(){AlarmBinding.BindAlarmByDeviceId(e.deviceList.map(function(e){return{deviceId:e.code,alarmCount:[0,e.alarmNum,0,0,0]}}))},1e3),e.currentSite.isAlarm=e.deviceList.some(function(e){return e.alarmNum}),n[0]&&n[0].infoList.forEach(function(i){a.getRelatedDeviceList({serverCode:e.user.serverCode,siteCode:e.currentSite.code,deviceCode:i.code},function(t){i.children=[],t.forEach(function(t){var n=e.deviceList.find(function(e){return e.code===t.deviceCode});n&&(n.fsuId=i.code,n.online="在线"===i.status,i.children.push(n))})}),i.online="在线"===i.status}),e.deviceAndFsu=e.deviceListInSite,e.deviceAndFsu.forEach(function(i){i=i.infoList||[],i.forEach(function(i){i.fsuId=(e.deviceList.filter(function(e){return e.id===i.deviceId})[0]||{}).fsuId})}),window.refreshDeviceTimer=setTimeout(function(){w(e.deviceListInSite),console.log("综合机房setTimeout: runing"),clearTimeout(refreshDeviceTimer),clearInterval(window.refreshDeviceInterval),window.refreshDeviceInterval=setInterval(function(){w(e.deviceListInSite),console.log("综合机房intervarl: runing")},3e5)},6e4),i.resolve(),t}function w(e){for(var i,t=1;t<e.length;t++){var n=e[t];i=1===t?D(n)():i.then(D(n))}}function D(e){return function(){for(var i=c.defer(),t=i.promise,n=[],o=0;o<e.infoList.length;o++)n.push(function(i){var t=c.defer(),n=t.promise;return a.freshDevice({deviceId:e.infoList[i].deviceId},function(n){n?(e.infoList[i].aiValue1=n.aiValue1,e.infoList[i].aiValue2=n.aiValue2,e.infoList[i].status=n.status):e.infoList[i].status="离线",t.resolve()}),n}(o));return c.all(n).then(function(){i.resolve()}),t}}function j(e){a.freshDevice({deviceId:e.deviceId},function(i){e=i})}function F(i){var t=e.deviceList.filter(function(e){return"FSU动环主机"===e.type});fsuIdList=t.map(function(e){return e.code});var n=function(){var i=e.deviceList.filter(function(e){return e.alarm={alarmCount:[e.alarmNum]},-1!==fsuIdList.indexOf(e.fsuId)}),n=[];e.toggleTopoGraph=chart.topologyMap({deviceList:i,fsuList:t.concat(e.deviceList.filter(function(e){return!e.fsuId&&e.id&&"FSU动环主机"!==e.type})),alarmList:n,siteName:e.currentSite.name,id:"topologyMap",curIndex:e.topoGraphIndex}).toggle,setTimeout(function(){$(window).resize()},0)},o=0;!function e(){!t[0]||t.every(function(e){return e.children})?(n(),clearTimeout(o)):o=setTimeout(e,50)}()}function O(i){i&&$(i.target).parents(".drop-menu").length>0||(e.curButtonIndex=null,$("body").off("click",O),!e.$$phase&&e.$apply())}function M(){var i=c.defer(),t=i.promise;return i.resolve(),e.curButtonIndex=e.curViewIndex=1,t}function P(){var t=c.defer(),n=t.promise;return a.updateConfig({siteId:e.currentSite.id,userId:i.user.id,home:e.defaultViewTypeIndex,alarm:e.alarmStatisticCycle,alarmTop:e.alarmStatisticCycleTop3},function(e){t.resolve()}),n}function x(e){for(e=e.substring(e.length-4);e&&"0"===e[0];)e=e.substring(1);return"1"===e&&(e=""),e}t&&(t=window.$state),d&&(d=window.$stateParams),e.fsuModelList=["ePLC-FS","ePLC-FH"];var A=Math.floor((new Date).getTime()/1e3);e.top3AlarmLineForScene="top3AlarmLineForScene"+A,e.allAlarmCountPie="allAlarmCountPie"+A,e.fsuListForSelect2={data:[]},e.shareInfoList=["移动","电信","联通","移动电信","电信联通","移动联通","移动电信联通"],e.approvalStatusList=["在建","竣工","存量","拆除"],e.towerTypeList=["插接式单管塔","外法兰单管塔","一体化","仿生树","三管塔","角钢塔","楼顶装饰塔","增高架桅杆","拉线塔","灯杆塔"],e.url={add:null,modify:null},e.alarmLabelIndex=0,e.alarmLabelTop3Index=0,e.needLoad=function(i){return e.devicesNeedLoad.indexOf(i.name.type)<0?0:scene3D.model[i.name.type]?1:2},e.searchKey={online:!0,offline:!0,keyword:""},e.getNodesByParamFuzzy=function(){setTimeout(function(){e.zTree.getNodesByParamFuzzy(e.searchKey,"areaTree","radioSiteTree",f)},10)},e.curLayout=[0,0],e.pictureList=[],e.curLayout=[0,0],e.prevImage={currentImageUrl:"",currentRotate:null,showImage:function(e,i){this.showSiteImage=!0,this.currentImageUrl=e,this.currentRotate=i,$("#imageShowModalInScene").modal("show")},hideImage:function(){this.showSiteImage=!1,$("#imageShowModalInScene").modal("hide")}},e.topoList=[{name:" 星状拓扑图",id:0},{name:" 组织拓扑图",id:1}],e.topoGraphIndex="1",e.selectType=function(i){e.currentType=i},e.selectAll=function(){if(e.allSelected){e.oneSelected=!0,angular.forEach(scene3D.devices,function(i){e.checked.push(i.type),e.ifType[i.type]=!0});for(var i in scene3D.deviceToMesh)scene3D.deviceToMesh[i].show()}else{angular.forEach(scene3D.devices,function(i){e.ifType[i.type]=!1}),e.oneSelected=!1,e.checked=[];for(var i in scene3D.deviceToMesh)scene3D.deviceToMesh[i].hide()}},e.selectOne=function(i){for(var t in scene3D.deviceToMesh)scene3D.deviceToMesh[t].device.type===i&&(e.ifType[i]?scene3D.deviceToMesh[t].show():scene3D.deviceToMesh[t].hide());angular.forEach(e.ifType,function(i,t){var n=e.checked.indexOf(t);i&&-1===n?e.checked.push(t):i||-1===n||e.checked.splice(n,1)}),Object.keys(e.devices),Object.keys(e.devices).length===e.checked.length?e.allSelected=!0:e.allSelected=!1},e.isShowAlarmCountList=!0,e.slideAlarmCountList=function(i){e.isShowAlarmCountList=!e.isShowAlarmCountList,angular.element(i).toggleClass("rotate-direction")},e.resizeCanvas=function(){var e=31;!function i(){$(window).resize(),--e>0&&window.setTimeout(i,Math.floor(1e3/60))}()},e.recoverView=function(){scene3D.resetCamera()},e.zoomOut=function(){scene3D.controller.zoomOut()},e.zoomIn=function(){scene3D.controller.zoomIn()},e.viewList=[{type:"topo",class:"flat",text:"拓",isShowMenu:"",id:1,target:"拓扑图"},{type:"video",class:"ic ic-video",text:"",isShowMenu:"",id:2,target:"视频监控"},{type:"configuration",class:"ic ic-configuration",text:"",isShowMenu:"",id:3,target:"组态"}],e.handleClickViewListItem=function(i,t,n){switch(n.stopPropagation(),e.preViewIndex=e.curViewIndex,e.preButtonIndex=e.curButtonIndex,4===i?(e.curViewIndex=e.preViewIndex,e.curButtonIndex=i):e.curButtonIndex=e.curViewIndex=i,$("body").on("click",O),t.type){case"topo":window.videoPlayerInScene.disposePlayer(),setTimeout(function(){$(window).resize()},0);break;case"video":e.cameraList.length>0&&window.videoPlayerInScene.startPlay(e.curCameraId);break;case"configuration":window.videoPlayerInScene.disposePlayer();break;default:return}},e.selectList=[{isSelected:!0,toggle:function(e){scene3D.setting.display.nameTag=e}},{isSelected:!0,toggle:function(e){scene3D.setting.display.alarm=e}},{isSelected:!1,toggle:function(i){scene3D.toggleAllCameraSE(i),e.selectList[3].isSelected=!1,e.selectList[4].isSelected=!1,e.selectList[5].isSelected=!1}},{isSelected:!1,toggle:function(i){e.selectList[2].isSelected=!1,scene3D.toggleAllCameraSE(!1),e.selectList[4].isSelected=!1,e.selectList[5].isSelected=!1}},{isSelected:!1,toggle:function(i){e.selectList[2].isSelected=!1,scene3D.toggleAllCameraSE(!1),e.selectList[3].isSelected=!1,e.selectList[5].isSelected=!1}},{isSelected:!1,toggle:function(i){e.selectList[2].isSelected=!1,scene3D.toggleAllCameraSE(!1),e.selectList[3].isSelected=!1,e.selectList[4].isSelected=!1}}],e.viewTypeList=[{name:" 组态",id:0},{name:" 星状拓扑图",id:1},{name:" 组织拓扑图",id:2},{name:" 监控视频",id:3}],e.handleViewTypeRadioClick=function(i){e.defaultViewTypeIndex=i,P()},e.timeList=[{type:"周",key:7},{type:"月",key:30},{type:"季",key:90}],e.handleClickProgressAlarm=function(i){e.alarmStatisticCycle=i.key,P().then(g).then(y)},e.handleClickProgressAlarmTop3=function(i){e.alarmStatisticCycleTop3=i.key,P().then(b).then(T)},e.is3D=!0,e.handle2d3dRadioClick=function(i){"1"===i?e.is3D&&(scene3D.changeController(),e.is3D=!e.is3D):e.is3D||(scene3D.changeController(),e.is3D=!e.is3D)},e.is3DButton=!0,e.videoPlayerInScene=window.videoPlayerInScene={startPlay:function(e){THREEx.Camera.initPlayer("videoPlayer"),r.startVideoSource(e,function(e){e.info&&THREEx.Camera.setPlayerSrc(e.info)},function(){THREEx.Camera.disposePlayer("videoPlayer")})},disposePlayer:function(){THREEx.Camera.disposePlayer("videoPlayer")}},e.simulateStateTime=new Array(30).join(" ").split(" ").map(function(e,i,t){return{key:i+1,value:i+1+"分钟"}}),e.simulateOperation={form:{},obj:{},toModal:function(i){i&&(e.simulateOperation.obj=i),this.obj.selectedFsuList=[],this.obj.operateTime=(new Date).getTime(),$("#simulateOperationModal").modal("show")},execute:function(){e.saveThreshold(),e.simulateOperation.obj={},e.signalThreshold={},$("#simulateOperationModal").modal("hide")},clear:function(){e.simulateOperation.obj={},e.signalThreshold={},$("#simulateOperationModal").modal("hide")}},e.getDeviceTypeByFsuId=function(i){a.getDeviceTypeByFsuId({fsuId:i.id},function(i){e.deviceTypeByFsuId=i;var t=e.deviceTypeByFsuId.map(function(e){return e.code}).indexOf("038");e.deviceTypeByFsuId.splice(t,1)})},e.getDeviceByCode=function(){a.getDeviceByCode({fsuId:e.simulateOperation.obj.fsu.id,typeCode:e.simulateOperation.obj.deviceTypeCode},function(i){e.deviceListByCode=i})},e.getSignalByDevice=function(){a.getSignalByDevice({deviceId:e.simulateOperation.obj.device.id},function(i){e.signalListByDevice=i})},e.getThreshold=function(){a.getThreshold({signalId:e.simulateOperation.obj.signal.id},function(i){e.signalThreshold=i,e.signalThreshold&&(-1===e.signalThreshold.result?e.simulateOperation.obj.threshold=e.signalThreshold.beThreshold:0===e.signalThreshold.result&&(e.simulateOperation.obj.threshold=e.signalThreshold.beThreshold))})},e.saveThreshold=function(){a.saveThreshold({siteId:e.currentSite.id,fsuId:e.simulateOperation.obj.fsu.id,deviceId:e.simulateOperation.obj.device.id,signalId:e.simulateOperation.obj.signal.id,beThreshold:e.simulateOperation.obj.signal.threshold,afThreshold:e.simulateOperation.obj.threshold,reMinutes:e.simulateOperation.obj.reMinutes,userId:i.user.id},function(e){})},e.updateThreshold=function(){a.updateThreshold({deviceId:e.simulateOperation.obj.device.id,signalId:e.simulateOperation.obj.signal.id,logId:e.signalThreshold.id,value:e.signalThreshold.beThreshold},function(e){})},e.operateInfo={form:{},obj:{},toModal:function(i){i&&(e.operateInfo.obj=i),e.operateInfo.obj.operateTime=(new Date).getTime(),e.operateInfo.obj.isChecked=!e.operateInfo.obj.isChecked,$("#operateInfoModal").modal("show")},execute:function(){a.setAdjustValue({signalId:e.operateInfo.obj.doSinId&&e.operateInfo.obj.doSinId,value:1&e.operateInfo.obj.isChecked},function(){j(e.operateInfo.obj),e.operateInfo.saveLog()},function(){e.operateInfo.obj.isChecked=!e.operateInfo.obj.isChecked}),$("#operateInfoModal").modal("hide")},clear:function(){$("#operateInfoModal").modal("hide"),e.operateInfo.obj.isChecked=!e.operateInfo.obj.isChecked,e.operateInfo.obj={}},saveLog:function(){a.saveLog({siteId:e.currentSite.id,tierName:e.currentSite.tierString,tierCode:e.currentSite.tierCode,userName:i.user.name,userId:i.user.id,deviceId:e.operateInfo.obj.deviceId,deviceName:e.operateInfo.obj.deviceName,operate:!0===e.operateInfo.obj.isChecked?1:0,ctime:e.operateInfo.obj.operateTime,signalName:e.operateInfo.obj.doSinName,model:"综合机房"},function(e){})}},e.addSiteInScene={form:{},obj:{tier:[]},status:"",title:"",toModal:function(i,t){this.status="modify",this.title={add:"增加站点",modify:"修改站点",detail:"站点详情"}[i],t&&(this.obj=angular.copy(t)),"modify"===this.status&&(this.obj=e.currentSite),this.docUplad=u.getFileUpload(),this.docUpladSelect=function(){this.docUplad.selectFile("repairsDocBtn")},this.docUplad.onFileSelectCallback=function(){}.bind(this),this.docUplad.info.name=e.currentSite.fileName,$("#addSiteInSceneModal").modal("show")},execute:function(){var i=Object.assign({},this.obj);i.serverCode=e.user.serverCode,i.isModified="0",i.createTime&&(i.createTime=new Date(i.createTime).getTime()),this.docUplad.info.name!=i.fileName&&(i.fileName=this.docUplad.info.name),o.modifySite(i,function(){L()}),this.clear()},clear:function(){e.addSiteInScene.form.$setPristine(),e.addSiteInScene.obj={tier:[]},$("#addSiteInSceneModal").modal("hide")},deleteMaintainer:function(e){var i=this;o.deleteMaintainer({siteId:i.obj.id,maintainerIds:[e.id]},function(){i.toModal("detail",i.obj)})}},e.coordPickerInSceneModal={toModal:function(){$("#coordPickerInSceneModal").modal("show"),e.addSiteInScene.showMap=!0},execute:function(){e.coordPickerInSceneModal.clear()},clear:function(){e.addSiteInScene.showMap=!1,$("#coordPickerInSceneModal").modal("hide")}},e.addFsuInScene={form:{},obj:{},toModal:function(){e.addFsuInScene.obj.siteId=e.currentSite.id,e.addFsuInScene.obj.name=e.currentSite.name,e.addFsuInScene.obj.manufactory=i.CONST.fsuManufactoryList[0],e.createFsuCode(e.currentSite.id),$("#addFsuInSceneModal").modal("show")},execute:function(){$("#addFsuInSceneModal").modal("hide"),console.log(e.addFsuInScene.obj);var i=Object.assign({},this.obj);i.createTime&&(i.createTime=new Date(i.createTime).getTime()),i.tierCode=e.currentSite.tierCode,i.siteCode=e.currentSite.code,i.tierName=e.currentSite.tierName,i.siteId=e.currentSite.siteId,i.type="FSU动环主机",i.typeCode="038",i.serverCode=e.user.serverCode,s.addFsu(i,function(){e.addFsuInScene.clear(),C()})},clear:function(){e.addFsuInScene.form.$setPristine(),e.addFsuInScene.obj={},$("#addFsuInSceneModal").modal("hide")}},e.createFsuCode=function(){e.currentSite.code&&s.createFsuCode({serverCode:e.user.serverCode,siteCode:e.currentSite.code,type:"FSU动环主机",typeCode:"038"},function(i){e.addFsuInScene.obj.code=i,e.addFsuInScene.obj.name=e.currentSite.name+"FSU"+x(i)})},e.modifyFsuInScene={form:{},obj:{},toModal:function(e,i){this.obj=angular.copy(e),$("#modifyFsuInSceneModal").modal("show")},execute:function(){this.obj.name=e.modifyFsuInScene.obj.name,this.obj.respName=e.modifyFsuInScene.obj.respName,this.obj.systemName=e.modifyFsuInScene.obj.systemName,this.obj.manufactory=i.util.strNull(e.modifyFsuInScene.obj.manufactory),$("#modifyFsuInSceneModal").modal("hide"),s.modifyFsu(this.obj,function(){C()})},clear:function(){e.modifyFsuInScene.form.$setPristine(),$("#modifyFsuInSceneModal").modal("hide")}},e.addDeviceOnFsuInScene={form:{},obj:{},toModal:function(i,t){e.currentFsuId=i.id,this.obj.fsuId=i.id,this.obj.siteId=i.siteId,this.obj.fsuName=i.name,$("#addDeviceOnFsuInSceneModal").modal("show")},execute:function(){$("#addDeviceOnFsuInSceneModal").modal("hide"),l.addDeviceOnFsu(e.url.add,{fsuId:e.addDeviceOnFsuInScene.obj.fsuId,siteId:e.addDeviceOnFsuInScene.obj.siteId,name:e.addDeviceOnFsuInScene.obj.name,type:e.addDeviceOnFsuInScene.obj.type.typeName,typeCode:e.addDeviceOnFsuInScene.obj.type.code,code:e.addDeviceOnFsuInScene.obj.code,systemName:e.addDeviceOnFsuInScene.obj.systemName,manufactory:e.addDeviceOnFsuInScene.obj.manufactory,model:e.addDeviceOnFsuInScene.obj.model,ip:e.addDeviceOnFsuInScene.obj.ip,port:e.addDeviceOnFsuInScene.obj.port,rtspPort:e.addDeviceOnFsuInScene.obj.rtspPort,username:e.addDeviceOnFsuInScene.obj.username,password:e.addDeviceOnFsuInScene.obj.password},function(){C(),e.addDeviceOnFsuInScene.clear()})},clear:function(){e.addDeviceOnFsuInScene.form.$setPristine(),e.addDeviceOnFsuInScene.obj={},$("#addDeviceOnFsuInSceneModal").modal("hide")},style:!1},e.getAddingUrl=function(i){l.getAddingUrl(i,function(i){e.url.add=i})},e.getModifyingUrl=function(i){l.getModifyingUrl(i,function(i){e.url.modify=i})},e.createDeviceCode=function(){var i=e.addDeviceOnFsuInScene.obj;l.createDeviceCode(i,function(t){i.code=t,e.getAddingUrl(i.type.code),e.addDeviceOnFsuInScene.obj.name=i.type.typeName+x(t)})},e.findDeviceInScene=function(e){a.highlightDeviceInScene(e)},e.openConfigurationPage=function(i){var n={siteId:e.currentSite.id};t.go("configuration/manager",n)},e.openDevicePage=function(n,o,r,a){if(window.videoPlayerInScene.disposePlayer(),n.typeCode===e.specialDevice.monitor)l.getDeviceInfo(n.id,function(e){window.open("http://"+e.ip+":"+e.webPort)});else{switch(o){case"摄像头":var c={dataSiteData:{deviceQuery:this.deviceQuery,paginationConf:this.paginationConf},deviceId:n.deviceId,deviceIdx:a};t.go("monitor/list",c);break;default:n.id=n.deviceId,n.typeCode=r,t.go("data/device",{dataSiteData:{deviceQuery:this.deviceQuery,paginationConf:this.paginationConf},device:n,parentPage:"scenePage"})}i.util.browserInfo.isIE&&window.location.reload()}},e.openAlarmStatistic=function(){t.go("scene/alarmStatistic",{siteId:e.currentSite.id,alarmStatisticCycle:e.alarmStatisticCycle}),i.util.browserInfo.isIE&&window.location.reload()},e.selectDeviceInSidebar=function(i){i.isInScene&&e.findDeviceInScene({code:i.deviceCode||i.code}),"FSU动环主机"===i.type&&(e.selectedFsuList=i.code)},function(){e.target=i.util.getToggleParam("navTreeTarget",[".nav-tree",".side-bar"],{left:"250px"},{left:"0"}),e.other=i.util.getToggleParam("null",["#page-wrapper"],{left:"248px"},{left:"20px"}),e.target3=i.util.getToggleParam(null,[".top"],{top:"0"},{top:"-157px"}),e.other3=i.util.getToggleParam(null,[".bottom"],{top:"175px"},{top:"0px"}),e.target2=i.util.getToggleParam(null,[".right"],{right:"0"},{right:"-340px"}),e.other2=i.util.getToggleParam(null,[".top",".bottom"],{right:"351px"},{right:"0px"})}(),function(){e.allSelected=!0,e.oneSelected=!0,e.checked=[],e.ifType={},e.devicesNeedLoad=[],m(),THREEx.Cache.connectToDB(function(){e.SetConfiguration=a,a.getScope(e),e.scene3D.init(e,"guest")}),p()}()}]);