scloudApp.controller("sceneSiteController",["$scope","$rootScope","$state","treeService","siteService","cameraService","configurationService","$q","$stateParams","fsuService","deviceService","fileUploadService",function(e,t,i,n,o,a,r,c,d,s,l,u){function f(i,n,a){e.treeLoading=!0,e.$$phase||e.$apply(),o.querySite({siteCode:a.code,tierCodes:[a.code.substr(0,6)],serverCode:e.user.serverCode},function(i){e.currentSite=i[0],e.currentSite.fsuState=i.fsuState,window.videoPlayerInScene.disposePlayer(),clearTimeout(window.refreshDeviceTimer),clearInterval(window.refreshDeviceInterval),v().then(function(){var t=c.defer(),i=t.promise;return c.all([I(),C()]).then(h).then(F).then(S).then(function(){e.treeLoading=!1}).catch(function(t){r.scene_import([{}],function(){}),e.treeLoading=!1}),c.all([M(),w()]).then(function(){t.resolve()}).catch(function(){e.treeLoading=!1}),i}).then(function(){O()}).catch(function(){e.treeLoading=!1}),e.c++,t.loadCount++})}function m(){window.scene3D||(window.scene3D=new Scene3D),e.scene3D=window.scene3D}function v(){var t=c.defer(),i=t.promise;return r.getDevicesListApi(e.currentSite.code,function(i,n){e.deviceList=i,e.fsuAndDevice=n,t.resolve()}),i}function p(){e.treeLoading=!0,n.getSiteMapTree({serverCode:e.user.serverCode},function(t){e.treeLoading=!1,e.zTree=n.createZTree(t),n.initTree(e.zTree.zNodes,"areaTree","radioSiteTree",f),n.checkNodeBySiteId("areaTree",d.siteId)})}function h(t){var i=c.defer(),n=i.promise;return r.executeModelFile(function(){e.deviceTypeList=r.sliceObjectToArray(e.devices,6,!0),e.sceneModelList=r.sliceObjectToArray(e.devices,6,!1),r.scene_import(t[0]||{},function(){r.showLoadingBar(!1,100),i.resolve()})}),n}function I(){var t=c.defer(),i=t.promise;return r.loadSceneApi({siteId:e.currentSite.siteId},function(i){e.devicesNeedLoad=sceneIO.getDeviceTypeFromSaveData(i),t.resolve(i)}),i}function S(){var t=c.defer(),i=t.promise,n=[];for(var o in e.devicesInScene)n.push(e.devicesInScene[o]);e.deviceIdListInScene=n.filter(function(e){return e}).map(function(e){return e.map(function(e){return e.code})}).join(",").split(",").filter(function(e){return!!e});for(var a=0;a<e.deviceAndFsu.length;a++)e.deviceAndFsu[a].infoList.map(function(t){t.isInScene=-1!==e.deviceIdListInScene.indexOf(t.deviceCode||t.code+"")});return t.resolve(),i}function g(){var t=c.defer(),i=t.promise;return r.getRoomHistoryAlarm({siteId:e.currentSite.id},function(i){e.historyAlarmCounts=[{value:i.level1,name:"一级告警"},{value:i.level2,name:"二级告警"},{value:i.level3,name:"三级告警"},{value:i.level4,name:"四级告警"}],e.allHistoryAlarmCounts=i.level1+i.level2+i.level3+i.level4,t.resolve()}),i}function y(){document.getElementById(e.allAlarmCountPie)&&chart.alarmCountPie({id:e.allAlarmCountPie,name:"0个",title:" ",data:e.historyAlarmCounts})}function b(){var t=c.defer(),i=t.promise;return r.getRoomHistoryTop({siteId:e.currentSite.id},function(i){e.historyAlarmTop3=i,t.resolve()}),i}function T(){var t=c.defer(),i=t.promise;if(document.getElementById(e.top3AlarmLineForScene)){for(var n=e.historyAlarmTop3,o={alarmNames:[n.signal01?n.signal01.name:"",n.signal02?n.signal02.name:"",n.signal03?n.signal03.name:""],counts:[n.infoList?n.infoList.map(function(e){return e.time}):[],n.infoList?n.infoList.map(function(e){return e.count1}):[],n.infoList?n.infoList.map(function(e){return e.count2}):[],n.infoList?n.infoList.map(function(e){return e.count3}):[]]},a=$.extend([],o.alarmNames),r=$.extend([],o.counts),d=0;d<3;d++)a[d]?a[d]=d+1+" "+a[d]:a[d]=d+1+" 暂无";return chart.alarmLine({id:e.top3AlarmLineForScene,title:" ",color:["#7C41F5","#00B1FF","#FFB700"],seriesName:a,series:[r[1],r[2],r[3]],xAxis:{data:r[0]}}),t.resolve(),i}}function w(){var t=c.defer(),i=t.promise;return r.getSiteInfo({siteId:e.currentSite.siteId},function(i){e.currentSite.deviceNum=i.deviceNum,e.currentSite.signalNum=i.signalNum,t.resolve()}),i}function C(){var t=c.defer(),i=t.promise;e.deviceAndFsu=[],e.deviceListInSite=e.fsuAndDevice;var n=e.deviceListInSite.filter(function(e){return"FSU动环主机"===e.type}),o=e.deviceListInSite.filter(function(e){return-1==n.indexOf(e)});return e.deviceListInSite=[].concat(n).concat(o),n[0]&&n[0].infoList.forEach(function(t){r.getRelatedDeviceList({serverCode:e.user.serverCode,siteCode:e.currentSite.code,deviceCode:t.code},function(i){t.children=[],i.forEach(function(i){var n=e.deviceList.find(function(e){return e.code===i.deviceCode});n&&(n.fsuId=t.code,n.online="在线"===t.status,t.children.push(n))})})}),e.deviceAndFsu=e.deviceListInSite,e.deviceAndFsu.forEach(function(t){t=t.infoList||[],t.forEach(function(t){t.fsuId=(e.deviceList.filter(function(e){return e.id===t.deviceId})[0]||{}).fsuId})}),window.refreshDeviceTimer=setTimeout(function(){L(e.deviceListInSite),console.log("综合机房setTimeout: runing"),clearTimeout(refreshDeviceTimer),clearInterval(window.refreshDeviceInterval),window.refreshDeviceInterval=setInterval(function(){L(e.deviceListInSite),console.log("综合机房intervarl: runing")},3e5)},6e4),t.resolve(),i}function L(e){for(var t,i=1;i<e.length;i++){var n=e[i];t=1===i?D(n)():t.then(D(n))}}function D(e){return function(){for(var t=c.defer(),i=t.promise,n=[],o=0;o<e.infoList.length;o++)n.push(function(t){var i=c.defer(),n=i.promise;return r.freshDevice({deviceId:e.infoList[t].deviceId},function(n){n?(e.infoList[t].aiValue1=n.aiValue1,e.infoList[t].aiValue2=n.aiValue2,e.infoList[t].status=n.status):e.infoList[t].status="离线",i.resolve()}),n}(o));return c.all(n).then(function(){t.resolve()}),i}}function j(e){r.freshDevice({deviceId:e.deviceId},function(t){e=t})}function F(t){var i=e.deviceList.filter(function(e){return"FSU动环主机"===e.type});fsuIdList=i.map(function(e){return e.code});var n=function(){var t=e.deviceList.filter(function(e){return e.alarm={alarmCount:[e.alarmNum]},-1!==fsuIdList.indexOf(e.fsuId)}),n=[];e.toggleTopoGraph=chart.topologyMap({deviceList:t,fsuList:i.concat(e.deviceList.filter(function(e){return!e.fsuId&&e.id&&"FSU动环主机"!==e.type})),alarmList:n,siteName:e.currentSite.name,id:"topologyMap",curIndex:e.topoGraphIndex}).toggle,setTimeout(function(){$(window).resize()},0)},o=0;!function e(){!i[0]||i.every(function(e){return e.children})?(n(),clearTimeout(o)):o=setTimeout(e,50)}()}function O(t){t&&$(t.target).parents(".drop-menu").length>0||(e.curButtonIndex=null,$("body").off("click",O),!e.$$phase&&e.$apply())}function M(){var t=c.defer(),i=t.promise;return t.resolve(),e.curButtonIndex=e.curViewIndex=1,i}function x(){var i=c.defer(),n=i.promise;return r.updateConfig({siteId:e.currentSite.id,userId:t.user.id,home:e.defaultViewTypeIndex,alarm:e.alarmStatisticCycle,alarmTop:e.alarmStatisticCycleTop3},function(e){i.resolve()}),n}function P(e){for(e=e.substring(e.length-4);e&&"0"===e[0];)e=e.substring(1);return"1"===e&&(e=""),e}i&&(i=window.$state),d&&(d=window.$stateParams),e.fsuModelList=["ePLC-FS","ePLC-FH"];var A=Math.floor((new Date).getTime()/1e3);e.top3AlarmLineForScene="top3AlarmLineForScene"+A,e.allAlarmCountPie="allAlarmCountPie"+A,e.fsuListForSelect2={data:[]},e.shareInfoList=["移动","电信","联通","移动电信","电信联通","移动联通","移动电信联通"],e.approvalStatusList=["在建","竣工","存量","拆除"],e.towerTypeList=["插接式单管塔","外法兰单管塔","一体化","仿生树","三管塔","角钢塔","楼顶装饰塔","增高架桅杆","拉线塔","灯杆塔"],e.url={add:null,modify:null},e.alarmLabelIndex=0,e.alarmLabelTop3Index=0,e.needLoad=function(t){return e.devicesNeedLoad.indexOf(t.name.type)<0?0:scene3D.model[t.name.type]?1:2},e.searchKey={online:!0,offline:!0,keyword:""},e.getNodesByParamFuzzy=function(){setTimeout(function(){e.zTree.getNodesByParamFuzzy(e.searchKey,"areaTree","radioSiteTree",f)},10)},e.curLayout=[0,0],e.pictureList=[],e.curLayout=[0,0],e.prevImage={currentImageUrl:"",currentRotate:null,showImage:function(e,t){this.showSiteImage=!0,this.currentImageUrl=e,this.currentRotate=t,$("#imageShowModalInScene").modal("show")},hideImage:function(){this.showSiteImage=!1,$("#imageShowModalInScene").modal("hide")}},e.topoList=[{name:" 星状拓扑图",id:0},{name:" 组织拓扑图",id:1}],e.topoGraphIndex="1",e.selectType=function(t){e.currentType=t},e.selectAll=function(){if(e.allSelected){e.oneSelected=!0,angular.forEach(scene3D.devices,function(t){e.checked.push(t.type),e.ifType[t.type]=!0});for(var t in scene3D.deviceToMesh)scene3D.deviceToMesh[t].show()}else{angular.forEach(scene3D.devices,function(t){e.ifType[t.type]=!1}),e.oneSelected=!1,e.checked=[];for(var t in scene3D.deviceToMesh)scene3D.deviceToMesh[t].hide()}},e.selectOne=function(t){for(var i in scene3D.deviceToMesh)scene3D.deviceToMesh[i].device.type===t&&(e.ifType[t]?scene3D.deviceToMesh[i].show():scene3D.deviceToMesh[i].hide());angular.forEach(e.ifType,function(t,i){var n=e.checked.indexOf(i);t&&-1===n?e.checked.push(i):t||-1===n||e.checked.splice(n,1)}),Object.keys(e.devices),Object.keys(e.devices).length===e.checked.length?e.allSelected=!0:e.allSelected=!1},e.isShowAlarmCountList=!0,e.slideAlarmCountList=function(t){e.isShowAlarmCountList=!e.isShowAlarmCountList,angular.element(t).toggleClass("rotate-direction")},e.resizeCanvas=function(){var e=31;!function t(){$(window).resize(),--e>0&&window.setTimeout(t,Math.floor(1e3/60))}()},e.recoverView=function(){scene3D.resetCamera()},e.zoomOut=function(){scene3D.controller.zoomOut()},e.zoomIn=function(){scene3D.controller.zoomIn()},e.viewList=[{type:"topo",class:"flat",text:"拓",isShowMenu:"",id:1,target:"拓扑图"},{type:"video",class:"ic ic-video",text:"",isShowMenu:"",id:2,target:"视频监控"},{type:"configuration",class:"ic ic-configuration",text:"",isShowMenu:"",id:3,target:"组态"},{type:"setting",class:"ic ic-setting",text:"",isShowMenu:"",id:4,target:"默认设置"}],e.handleClickViewListItem=function(t,i,n){switch(n.stopPropagation(),e.preViewIndex=e.curViewIndex,e.preButtonIndex=e.curButtonIndex,4===t?(e.curViewIndex=e.preViewIndex,e.curButtonIndex=t):e.curButtonIndex=e.curViewIndex=t,$("body").on("click",O),i.type){case"topo":window.videoPlayerInScene.disposePlayer(),setTimeout(function(){$(window).resize()},0);break;case"video":e.cameraList.length>0&&window.videoPlayerInScene.startPlay(e.curCameraId);break;case"configuration":window.videoPlayerInScene.disposePlayer();break;default:return}},e.selectList=[{isSelected:!0,toggle:function(e){scene3D.setting.display.nameTag=e}},{isSelected:!0,toggle:function(e){scene3D.setting.display.alarm=e}},{isSelected:!1,toggle:function(t){scene3D.toggleAllCameraSE(t),e.selectList[3].isSelected=!1,e.selectList[4].isSelected=!1,e.selectList[5].isSelected=!1}},{isSelected:!1,toggle:function(t){e.selectList[2].isSelected=!1,scene3D.toggleAllCameraSE(!1),e.selectList[4].isSelected=!1,e.selectList[5].isSelected=!1}},{isSelected:!1,toggle:function(t){e.selectList[2].isSelected=!1,scene3D.toggleAllCameraSE(!1),e.selectList[3].isSelected=!1,e.selectList[5].isSelected=!1}},{isSelected:!1,toggle:function(t){e.selectList[2].isSelected=!1,scene3D.toggleAllCameraSE(!1),e.selectList[3].isSelected=!1,e.selectList[4].isSelected=!1}}],e.viewTypeList=[{name:" 组态",id:0},{name:" 星状拓扑图",id:1},{name:" 组织拓扑图",id:2},{name:" 监控视频",id:3}],e.handleViewTypeRadioClick=function(t){e.defaultViewTypeIndex=t,x()},e.timeList=[{type:"周",key:7},{type:"月",key:30},{type:"季",key:90}],e.handleClickProgressAlarm=function(t){e.alarmStatisticCycle=t.key,x().then(g).then(y)},e.handleClickProgressAlarmTop3=function(t){e.alarmStatisticCycleTop3=t.key,x().then(b).then(T)},e.is3D=!0,e.handle2d3dRadioClick=function(t){"1"===t?e.is3D&&(scene3D.changeController(),e.is3D=!e.is3D):e.is3D||(scene3D.changeController(),e.is3D=!e.is3D)},e.is3DButton=!0,e.videoPlayerInScene=window.videoPlayerInScene={startPlay:function(e){THREEx.Camera.initPlayer("videoPlayer"),a.startVideoSource(e,function(e){e.info&&THREEx.Camera.setPlayerSrc(e.info)},function(){THREEx.Camera.disposePlayer("videoPlayer")})},disposePlayer:function(){THREEx.Camera.disposePlayer("videoPlayer")}},e.simulateStateTime=new Array(30).join(" ").split(" ").map(function(e,t,i){return{key:t+1,value:t+1+"分钟"}}),e.simulateOperation={form:{},obj:{},toModal:function(t){t&&(e.simulateOperation.obj=t),this.obj.selectedFsuList=[],this.obj.operateTime=(new Date).getTime(),$("#simulateOperationModal").modal("show")},execute:function(){e.saveThreshold(),e.simulateOperation.obj={},e.signalThreshold={},$("#simulateOperationModal").modal("hide")},clear:function(){e.simulateOperation.obj={},e.signalThreshold={},$("#simulateOperationModal").modal("hide")}},e.getDeviceTypeByFsuId=function(t){r.getDeviceTypeByFsuId({fsuId:t.id},function(t){e.deviceTypeByFsuId=t;var i=e.deviceTypeByFsuId.map(function(e){return e.code}).indexOf("038");e.deviceTypeByFsuId.splice(i,1)})},e.getDeviceByCode=function(){r.getDeviceByCode({fsuId:e.simulateOperation.obj.fsu.id,typeCode:e.simulateOperation.obj.deviceTypeCode},function(t){e.deviceListByCode=t})},e.getSignalByDevice=function(){r.getSignalByDevice({deviceId:e.simulateOperation.obj.device.id},function(t){e.signalListByDevice=t})},e.getThreshold=function(){r.getThreshold({signalId:e.simulateOperation.obj.signal.id},function(t){e.signalThreshold=t,e.signalThreshold&&(-1===e.signalThreshold.result?e.simulateOperation.obj.threshold=e.signalThreshold.beThreshold:0===e.signalThreshold.result&&(e.simulateOperation.obj.threshold=e.signalThreshold.beThreshold))})},e.saveThreshold=function(){r.saveThreshold({siteId:e.currentSite.id,fsuId:e.simulateOperation.obj.fsu.id,deviceId:e.simulateOperation.obj.device.id,signalId:e.simulateOperation.obj.signal.id,beThreshold:e.simulateOperation.obj.signal.threshold,afThreshold:e.simulateOperation.obj.threshold,reMinutes:e.simulateOperation.obj.reMinutes,userId:t.user.id},function(e){})},e.updateThreshold=function(){r.updateThreshold({deviceId:e.simulateOperation.obj.device.id,signalId:e.simulateOperation.obj.signal.id,logId:e.signalThreshold.id,value:e.signalThreshold.beThreshold},function(e){})},e.operateInfo={form:{},obj:{},toModal:function(t){t&&(e.operateInfo.obj=t),e.operateInfo.obj.operateTime=(new Date).getTime(),e.operateInfo.obj.isChecked=!e.operateInfo.obj.isChecked,$("#operateInfoModal").modal("show")},execute:function(){r.setAdjustValue({signalId:e.operateInfo.obj.doSinId&&e.operateInfo.obj.doSinId,value:1&e.operateInfo.obj.isChecked},function(){j(e.operateInfo.obj),e.operateInfo.saveLog()},function(){e.operateInfo.obj.isChecked=!e.operateInfo.obj.isChecked}),$("#operateInfoModal").modal("hide")},clear:function(){$("#operateInfoModal").modal("hide"),e.operateInfo.obj.isChecked=!e.operateInfo.obj.isChecked,e.operateInfo.obj={}},saveLog:function(){r.saveLog({siteId:e.currentSite.id,tierName:e.currentSite.tierString,tierCode:e.currentSite.tierCode,userName:t.user.name,userId:t.user.id,deviceId:e.operateInfo.obj.deviceId,deviceName:e.operateInfo.obj.deviceName,operate:!0===e.operateInfo.obj.isChecked?1:0,ctime:e.operateInfo.obj.operateTime,signalName:e.operateInfo.obj.doSinName,model:"综合机房"},function(e){})}},e.addSiteInScene={form:{},obj:{tier:[]},status:"",title:"",toModal:function(t,i){this.status="modify",this.title={add:"增加站点",modify:"修改站点",detail:"站点详情"}[t],i&&(this.obj=angular.copy(i)),"modify"===this.status&&(this.obj=e.currentSite),this.docUplad=u.getFileUpload(),this.docUpladSelect=function(){this.docUplad.selectFile("repairsDocBtn")},this.docUplad.onFileSelectCallback=function(){}.bind(this),this.docUplad.info.name=e.currentSite.fileName,$("#addSiteInSceneModal").modal("show")},execute:function(){var t=Object.assign({},this.obj);t.serverCode=e.user.serverCode,t.isModified="0",t.createTime&&(t.createTime=new Date(t.createTime).getTime()),this.docUplad.info.name!=t.fileName&&(t.fileName=this.docUplad.info.name),o.modifySite(t,function(){w()}),this.clear()},clear:function(){e.addSiteInScene.form.$setPristine(),e.addSiteInScene.obj={tier:[]},$("#addSiteInSceneModal").modal("hide")},deleteMaintainer:function(e){var t=this;o.deleteMaintainer({siteId:t.obj.id,maintainerIds:[e.id]},function(){t.toModal("detail",t.obj)})}},e.coordPickerInSceneModal={toModal:function(){$("#coordPickerInSceneModal").modal("show"),e.addSiteInScene.showMap=!0},execute:function(){e.coordPickerInSceneModal.clear()},clear:function(){e.addSiteInScene.showMap=!1,$("#coordPickerInSceneModal").modal("hide")}},e.addFsuInScene={form:{},obj:{},toModal:function(){e.addFsuInScene.obj.siteId=e.currentSite.id,e.addFsuInScene.obj.name=e.currentSite.name,e.addFsuInScene.obj.manufactory=t.CONST.fsuManufactoryList[0],e.createFsuCode(e.currentSite.id),$("#addFsuInSceneModal").modal("show")},execute:function(){$("#addFsuInSceneModal").modal("hide"),console.log(e.addFsuInScene.obj);var t=Object.assign({},this.obj);t.createTime&&(t.createTime=new Date(t.createTime).getTime()),t.tierCode=e.currentSite.tierCode,t.siteCode=e.currentSite.code,t.tierName=e.currentSite.tierName,t.siteId=e.currentSite.siteId,t.type="FSU动环主机",t.typeCode="038",t.serverCode=e.user.serverCode,s.addFsu(t,function(){e.addFsuInScene.clear(),C()})},clear:function(){e.addFsuInScene.form.$setPristine(),e.addFsuInScene.obj={},$("#addFsuInSceneModal").modal("hide")}},e.createFsuCode=function(){e.currentSite.code&&s.createFsuCode({serverCode:e.user.serverCode,siteCode:e.currentSite.code,type:"FSU动环主机",typeCode:"038"},function(t){e.addFsuInScene.obj.code=t,e.addFsuInScene.obj.name=e.currentSite.name+"FSU"+P(t)})},e.modifyFsuInScene={form:{},obj:{},toModal:function(e,t){this.obj=angular.copy(e),$("#modifyFsuInSceneModal").modal("show")},execute:function(){this.obj.name=e.modifyFsuInScene.obj.name,this.obj.respName=e.modifyFsuInScene.obj.respName,this.obj.systemName=e.modifyFsuInScene.obj.systemName,this.obj.manufactory=t.util.strNull(e.modifyFsuInScene.obj.manufactory),$("#modifyFsuInSceneModal").modal("hide"),s.modifyFsu(this.obj,function(){C()})},clear:function(){e.modifyFsuInScene.form.$setPristine(),$("#modifyFsuInSceneModal").modal("hide")}},e.addDeviceOnFsuInScene={form:{},obj:{},toModal:function(t,i){e.currentFsuId=t.id,this.obj.fsuId=t.id,this.obj.siteId=t.siteId,this.obj.fsuName=t.name,$("#addDeviceOnFsuInSceneModal").modal("show")},execute:function(){$("#addDeviceOnFsuInSceneModal").modal("hide"),l.addDeviceOnFsu(e.url.add,{fsuId:e.addDeviceOnFsuInScene.obj.fsuId,siteId:e.addDeviceOnFsuInScene.obj.siteId,name:e.addDeviceOnFsuInScene.obj.name,type:e.addDeviceOnFsuInScene.obj.type.typeName,typeCode:e.addDeviceOnFsuInScene.obj.type.code,code:e.addDeviceOnFsuInScene.obj.code,systemName:e.addDeviceOnFsuInScene.obj.systemName,manufactory:e.addDeviceOnFsuInScene.obj.manufactory,model:e.addDeviceOnFsuInScene.obj.model,ip:e.addDeviceOnFsuInScene.obj.ip,port:e.addDeviceOnFsuInScene.obj.port,rtspPort:e.addDeviceOnFsuInScene.obj.rtspPort,username:e.addDeviceOnFsuInScene.obj.username,password:e.addDeviceOnFsuInScene.obj.password},function(){C(),e.addDeviceOnFsuInScene.clear()})},clear:function(){e.addDeviceOnFsuInScene.form.$setPristine(),e.addDeviceOnFsuInScene.obj={},$("#addDeviceOnFsuInSceneModal").modal("hide")},style:!1},e.getAddingUrl=function(t){l.getAddingUrl(t,function(t){e.url.add=t})},e.getModifyingUrl=function(t){l.getModifyingUrl(t,function(t){e.url.modify=t})},e.createDeviceCode=function(){var t=e.addDeviceOnFsuInScene.obj;l.createDeviceCode(t,function(i){t.code=i,e.getAddingUrl(t.type.code),e.addDeviceOnFsuInScene.obj.name=t.type.typeName+P(i)})},e.findDeviceInScene=function(e){r.highlightDeviceInScene(e)},e.openConfigurationPage=function(t){var n={siteId:e.currentSite.id};i.go("configuration/manager",n)},e.openDevicePage=function(n,o,a,r){if(window.videoPlayerInScene.disposePlayer(),n.typeCode===e.specialDevice.monitor)l.getDeviceInfo(n.id,function(e){window.open("http://"+e.ip+":"+e.webPort)});else{switch(o){case"摄像头":var c={dataSiteData:{deviceQuery:this.deviceQuery,paginationConf:this.paginationConf},deviceId:n.deviceId,deviceIdx:r};i.go("monitor/list",c);break;default:n.id=n.deviceId,n.typeCode=a,i.go("data/device",{dataSiteData:{deviceQuery:this.deviceQuery,paginationConf:this.paginationConf},device:n,parentPage:"scenePage"})}t.util.browserInfo.isIE&&window.location.reload()}},e.openAlarmStatistic=function(){i.go("scene/alarmStatistic",{siteId:e.currentSite.id,alarmStatisticCycle:e.alarmStatisticCycle}),t.util.browserInfo.isIE&&window.location.reload()},e.selectDeviceInSidebar=function(t){t.isInScene&&e.findDeviceInScene({code:t.deviceCode||t.code}),"FSU动环主机"===t.type&&(e.selectedFsuList=t.code)},function(){e.target=t.util.getToggleParam("navTreeTarget",[".nav-tree",".side-bar"],{left:"250px"},{left:"0"}),e.other=t.util.getToggleParam("null",["#page-wrapper"],{left:"248px"},{left:"20px"}),e.target3=t.util.getToggleParam(null,[".top"],{top:"0"},{top:"-157px"}),e.other3=t.util.getToggleParam(null,[".bottom"],{top:"175px"},{top:"0px"}),e.target2=t.util.getToggleParam(null,[".right"],{right:"0"},{right:"-340px"}),e.other2=t.util.getToggleParam(null,[".top",".bottom"],{right:"351px"},{right:"0px"})}(),function(){e.allSelected=!0,e.oneSelected=!0,e.checked=[],e.ifType={},e.devicesNeedLoad=[],m(),THREEx.Cache.connectToDB(function(){e.SetConfiguration=r,r.getScope(e),e.scene3D.init(e,"guest")}),p()}()}]);