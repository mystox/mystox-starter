<section id="settingBasicPage">
    <div class="nav-tree cloak" ng-style="{top: __navbarTreeTop + 'px', display: 'block'}">
        <div class="page-header">
            <h3>站点分级
                <small>
                    <i class="ic ic-help" scloud-tooltip data-content = "【默认站点分级】<br>按全国所有省市区三级对站点进行划分。<br>
                       【自定义站点分级】<br>系统目前最高支持三层分级,若使用自定义站点分级，请先下载模板文件，按照要求填入信息，再上传即可。<br>
                       【注意】<br>目前，站点分级的导入是一次性的，无法更改，如确实需要修改，请联系服务提供商。"></i>
                </small>
            </h3>

            <div class="btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    配置 <i class="ic ic-angle-down ic-min"></i>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a href="{{CONST.ctx}}/res/doc/template/customizeTier.xls">下载自定义Excel模板</a>
                    </li>
                    <li ng-class="{'disabled':isFirstTime === false}">
                        <a title="系统目前最高支持三层分级,若使用自定义站点分级，请先下载模板文件，按照要求填入信息，再上传即可"
                           ng-click="setCustomTier.toModal($event);">导入自定义分级</a>
                    </li>
                    <li ng-class="{'disabled':isFirstTime === false}">
                        <a title="按全国所有省市区三级对站点进行划分"
                           ng-click="setDefaultTier.toModal($event);">使用默认分级</a>
                    </li>
                </ul>
            </div>
        </div>
        <input type="text" placeholder="搜索站点位置" ng-model="searchKey" ng-change="zTree.getNodesByParamFuzzy(searchKey,'areaTree','simpleTierTree');">
        <div class="scroll-wrap">
            <ul id="areaTree" class="ztree scroll" ng-hide="zTree.isEmpty"></ul>
            <div ng-show="zTree.isEmpty" class="no-data">
                <div class="img img-2x"></div>
            </div>
        </div>
        <div class="loader" ng-show="isLoading">
            <i class="ic ic-spinner ic-spin ic-5x"></i>
        </div>
        <div class="no-data" ng-hide="isLoading || zTree.zNodes">
            <div class="img img-2x"></div>
        </div>
    </div>

<!--     <form class="_top query-form" name="modifyAlarmColor.form" novalidate ng-submit="modifyAlarmColor.execute();">
        <div class="form-inline">
            <label>一级告警</label>
            <input type="text" id="level1" class="level" readonly required
                   ng-model="modifyAlarmColor.obj.alarmColor[0]"
                   ng-style="util.borderColor(modifyAlarmColor.obj.alarmColor[0]);">

            <label>二级告警</label>
            <input type="text" id="level2" class="level" readonly required
                   ng-model="modifyAlarmColor.obj.alarmColor[1]"
                   ng-style="util.borderColor(modifyAlarmColor.obj.alarmColor[1]);" >

            <label>三级告警</label>
            <input type="text" id="level3" class="level" readonly required
                   ng-model="modifyAlarmColor.obj.alarmColor[2]"
                   ng-style="util.borderColor(modifyAlarmColor.obj.alarmColor[2]);" >

            <label>四级告警</label>
            <input type="text" id="level4" class="level" readonly required
                   ng-model="modifyAlarmColor.obj.alarmColor[3]"
                   ng-style="util.borderColor(modifyAlarmColor.obj.alarmColor[3]);" >

            <button class="btn btn-primary" type="submit" ng-disabled="modifyAlarmColor.form.$invalid">保存</button>
            <button class="btn btn-default" type="button" ng-click="modifyAlarmColor.clear();">恢复</button>
        </div>
    </form> -->


    <form class="_top card-bg" name="modifyAlarmConfig.form" novalidate ng-submit="modifyAlarmConfig.execute();">
        <div scloud-toggle target="target" other="other" position="bottom"></div>
        <div class="page-header">
            <h3>基础配置</h3>
        </div>
        <div class="_top-wrapper">
            <audio id = 'audition' src=""></audio>
            <table>
                <tr>
                    <td width="120">弹出告警提示</td>
                    <td height = "46" width="220">
                        <a ng-click="modifyAlarmInterval.toggle()">
                            <scloudMytarget myid="if-show-alarm" ifchecked="modifyAlarmInterval.interval >= 0"></scloudMytarget>
                        </a>
                    </td>
                    <td ng-show = 'modifyAlarmInterval.interval >= 0'>
                        <label>提示间隔</label>
                        <select id = 'alarm-interval'
                            ng-change = "modifyAlarmInterval.change()"
                            ng-model="modifyAlarmInterval.interval"
                            ng-options="item | secondFilter for item in alarmIntervals"></select>
                    </td>
                    <td ng-show = 'modifyAlarmInterval.interval >= 0'>
                        <label>弹框保持时间</label>
                        <select id = 'alarm-keepTime'
                            ng-change = "modifyAlarmInterval.changeKeepTime()"
                            ng-model="modifyAlarmInterval.keepTime"
                            ng-options="item | secondFilter for item in alarmKeepTimes"></select>
                    </td>
                </tr>
                <tr ng-repeat = 'i in alarmLevelList'>
                    <td>
                        <label ng-bind="$index + 1 | alarmLevelFilter"></label>
                    </td>
                    <td>
                        <input type="text" id = "{{'level' + ($index + 1)}}" class="level" readonly required
                           ng-model="modifyAlarmConfig.obj.alarmConfig[i].color"
                           ng-style="util.backgroundColor(modifyAlarmConfig.obj.alarmConfig[i].color);">     
                    </td>
                    <td width="200">                           
                        <select
                            required
                            ng-model="modifyAlarmConfig.obj.alarmConfig[i].audio"
                            ng-options="i.name for i in alarmAudioList">
                                <option value="">无</option>
                            </select>        
                    </td>
                    <td>
                        <a  ng-show = 'modifyAlarmConfig.obj.alarmConfig[i].audio' ng-click = 'modifyAlarmInterval.audition(modifyAlarmConfig.obj.alarmConfig[i].audio.src)'>试听</a>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button class="btn btn-primary" type="submit" 
                            ng-disabled="modifyAlarmConfig.form.$invalid || 
                            (modifyAlarmInterval.keepTime >= modifyAlarmInterval.interval) && modifyAlarmInterval.interval > 0 "
                           ng-if="util.checkPrivilege(7402)"
                        >保存</button>
                        <button class="btn btn-default" type="button" ng-click="modifyAlarmConfig.clear();">恢复</button>                
                    </td>
                </tr>
            </table>
        </div>
    </form>
    
    <div class="_right card-bg">
        <div class="page-header">
            <h3>设备信号类型映射表配置
                <small>（<div scloud-checkbox selected="isShowSignal" ng-init="isShowSignal=true;"></div>是否显示信号类型数据）</small>
            </h3>
            <div class="btn-group" ng-if="util.checkPrivilege(7406)">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    配置 <i class="ic ic-angle-down ic-min"></i>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a href="{{CONST.ctx}}/res/doc/template/deviceSignal.xls">下载默认表</a>
                    </li>
                    <li>
                        <a ng-click="importDeviceSignalType.toModal();">导入设备信号量类型</a>
                    </li>
                    <li>
                        <a href="{{CONST.ctx}}/systemFunc/exportSignalType">导出信号点映射表</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="table-box scroll">
            <table ng-show="isShowSignal" class="table table-hover table-bordered">
                <thead>
                    <tr>
                        <th>设备类型</th><th>设备类型编号</th><th>信号类型</th><th>信号类型编号</th><th>信号单位</th><th>告警等级</th>
                    </tr>
                </thead>
                <tbody ng-repeat="d in deviceTypeList">
                    <tr>
                        <td ng-bind="d.typeName"></td>
                        <td ng-bind="d.code"></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr ng-repeat="s in d.signalTypeList">
                        <td></td>
                        <td></td>
                        <td ng-bind="s.typeName"></td>
                        <td ng-bind="s.code"></td>
                        <td ng-bind="s.measurement | nullFilter"></td>
                        <td ng-bind="s.alarmLevel"></td>
                    </tr>
                </tbody>
            </table>

            <table ng-hide="isShowSignal" class="table table-hover table-bordered">
                <thead>
                    <tr>
                        <th>设备类型</th><th>设备类型编号</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="d in deviceTypeList">
                        <td ng-bind="d.typeName"></td>
                        <td ng-bind="d.code"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="loader" ng-show="isLoading2">
            <i class="ic ic-spinner ic-spin ic-5x"></i>
        </div>
        <div class="no-data" ng-hide="isLoading2 || deviceTypeList">
            <div class="img img-2x"></div>
        </div>
    </div>
    
    <form class="modal hide form-horizontal" data-backdrop="static" id="setCustomTierModal"
          name="setCustomTier.form" novalidate ng-submit="setCustomTier.execute();">
        <div class="modal-header">
            <button type="reset" class="close" ng-click="setCustomTier.clear();"><i class="ic ic-close"></i></button>
            <h3>设置自定义分级</h3>
        </div>
        <div class="modal-body scroll">
            <button type="button" class="btn btn-primary" ng-click="setCustomTier.select();">选择文件</button>
            
            <span ng-hide="!fileUpload.files" ng-bind="fileUpload.info.name" class="label label-info"></span>
            <span ng-hide="!fileUpload.files" ng-bind="fileUpload.info.size" class="label label-info"></span>
            <span ng-show="!fileUpload.files" class="label label-default"><i class="ic ic-paperclip"></i> 未选择任何文件</span>
            
            <input id="fileUploadBtn" name="file" type="file" accept=".xls,.xlsx" ng-file-select="fileUpload.onFileSelect($files, 'excel');"/>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-primary" 
                    ng-disabled="!fileUpload.files || setCustomTier.loading">
                <i ng-class="{'ic ic-spinner ic-spin':setCustomTier.loading}"></i>确认
            </button>
            <button type="reset" class="btn btn-default" ng-click="setCustomTier.clear();">取消</button>
        </div>
    </form>
    
    <form class="modal hide form-horizontal" data-backdrop="static" id="setDefaultTierModal"
          name="setDefaultTier.form" novalidate ng-submit="setDefaultTier.execute();">
        <div class="modal-header">
            <button type="reset" class="close" ng-click="setDefaultTier.clear();"><i class="ic ic-close"></i></button>
            <h3>设置默认分级</h3>
        </div>
        <div class="modal-body scroll">
            <div class="notification">
                <h4 class="title"><i class="ic ic-warning font-warning"></i>确定要使用默认站点分级吗？</h4>
                <p class="content">
                    默认站点分级采用的是全国三级行政区划
                </p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-primary" 
                    ng-disabled="setDefaultTier.loading">
                <i ng-class="{'ic ic-spinner ic-spin':setDefaultTier.loading}"></i>确认
            </button>
            <button type="reset" class="btn btn-default" ng-click="setDefaultTier.clear();">取消</button>
        </div>
    </form>
    
    <form class="modal hide form-horizontal" data-backdrop="static" id="importDeviceSignalTypeModal"
          name="importDeviceSignalType.form" novalidate ng-submit="importDeviceSignalType.execute();">
        <div class="modal-header">
            <button type="reset" class="close" ng-click="importDeviceSignalType.clear();"><i class="ic ic-close"></i></button>
            <h3>导入设备信号量类型</h3>
        </div>
        <div class="modal-body scroll">
            <button type="button" class="btn btn-primary" ng-click="importDeviceSignalType.select();">选择文件</button>
            
            <span ng-hide="!fileUpload.files" ng-bind="fileUpload.info.name" class="label label-info"></span>
            <span ng-hide="!fileUpload.files" ng-bind="fileUpload.info.size" class="label label-info"></span>
            <span ng-show="!fileUpload.files" class="label label-default"><i class="ic ic-paperclip"></i> 未选择任何文件</span>
            
            <input id="fileUploadBtn2" name="file" type="file" accept=".xls,.xlsx" ng-file-select="fileUpload.onFileSelect($files, 'excel');"/>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-primary" 
                    ng-disabled="!fileUpload.files || importDeviceSignalType.loading">
                <i ng-class="{'ic ic-spinner ic-spin':importDeviceSignalType.loading}"></i>确认
            </button>
            <button type="reset" class="btn btn-default" ng-click="importDeviceSignalType.clear();">取消</button>
        </div>
    </form>
</section>