scloudApp.controller("batteryConfigController",["$scope","$rootScope","treeService","batteryService",function(e,t,o,a){function r(a){var r=o.getCheckedNode(a);if(!r)return void t.notify({type:"warn",text:"请选择一个站点"});e.currentSite=r,i(),n()}function i(){if(!e.currentSite)return void(e.isLoading1=!1);e.isLoading1=!0,a.getBatteryGroupList(e.currentSite.id,e.paginationConf1,function(t){e.paginationConf1.totalItems=t.count,e.batteryGroupList=t.list,e.isLoading1=!1},function(){e.isLoading1=!1})}function n(){a.getBatteryAlarmQueryList(e.currentSite.id,function(t){e.query.alarmSetting.option=t,e.query.alarmSetting.value=t&&t[0],e.queryAlarmParamList()})}function l(){if(e.alarmConfigList=null,!e.currentSite||!e.query.alarmSetting.value||null===e.query.alarmSetting.value.specVoltage)return void(e.isLoading2=!1);e.isLoading2=!0,a.getAlarmParamList(e.currentSite.id,e.query.alarmSetting.value,function(t){e.alarmConfigList=t,e.isLoading2=!1},function(){e.isLoading2=!1})}$state&&($state=window.$state),$stateParams&&($stateParams=window.$stateParams),e.query={alarmSetting:{value:null,option:[]}},e.tabPage=t.util.tabPage.getInstance(["设备参数","告警参数"]),e.isLoading1=!1,e.isLoading2=!1,e.paginationConf1={currentPage:1,itemsPerPage:15,pagesLength:9,onChange:function(){}},e.$watch("paginationConf1.currentPage + paginationConf1.itemsPerPage",i),e.searchKey={online:!0,offline:!0,keyword:""},e.getNodesByParamFuzzy=function(){setTimeout(function(){e.zTree.getNodesByParamFuzzy(e.searchKey,"areaTree","radioSiteTree")},10)},e.getNodesByParamFuzzy=function(t,o,a){e.zTree.getNodesByParamFuzzy(t,o,a,function(){r("areaTree")})},e.setParameter={obj:null},e.setParameter.toModal=function(t){$("#setParameterModal").modal(),a.getConfig(t,function(t){e.setParameter.obj=t})},e.setParameter.clear=function(){$("#setParameterModal").modal("hide")},e.queryAlarmParamList=function(){l()},e.modifyThreshold={obj:{},toModal:null,execute:null,clear:null,loading:!1},e.modifyThreshold.toModal=function(t){$("#modifyThreshold").modal("show"),e.modifyThreshold.obj={siteId:e.currentSite.id,voltageLevel:e.query.alarmSetting.value.voltageLevel,specVoltage:e.query.alarmSetting.value.specVoltage,specCapacity:e.query.alarmSetting.value.specCapacity,code:t.signalType.code,threshold:t.threshold,defaultThreshold:t.defaultThreshold}},e.modifyThreshold.execute=function(){e.modifyThreshold.loading=!0,a.modifyThreshold(e.modifyThreshold.obj,function(){$("#modifyThreshold").modal("hide"),e.modifyThreshold.loading=!1,l()},function(t){e.modifyThreshold.loading=!1,e.modifyThreshold.obj.bbdsCodes=t})},e.modifyThreshold.clear=function(){$("#modifyThreshold").modal("hide"),e.modifyThreshold.obj={},e.modifyThreshold.form.$setPristine(),e.modifyThreshold.loading=!1},function(){e.target=t.util.getToggleParam("navTreeTarget",[".nav-tree"]),e.other=t.util.getToggleParam("navTreeOther",[".top",".bottom"])}(),function(){e.treeLoading=!0,o.getSiteMapTree({},function(t){e.treeLoading=!1,e.zTree=o.createZTree(t),o.initTree(e.zTree.zNodes,"areaTree","radioSiteTree",function(){r("areaTree")}),o.checkNodeBySiteId("areaTree",null)})}()}]);