scloudApp.controller("batterySiteController",["$scope","$rootScope","$stateParams","treeService","batteryService",function(e,t,i,n,o){function r(){e.currentSite&&(e.isLoading=!0,o.getDeviceList(e.currentSite.id,e.paginationConf,e.query.model,function(t){e.deviceList=t.list,e.paginationConf.totalItems=t.count,e.isLoading=!1},function(){e.isLoading=!1}))}function a(i){var o=n.getCheckedNode(i);if(!o)return void t.notify({type:"warn",text:"请选择一个站点"});e.currentSite=o,r()}$state&&($state=window.$state),i&&(i=window.$stateParams),e.query={model:{power:i.powerSysType,status:i.status},conditions:{},confirm:function(){r()},clear:function(){e.query.model={}}},e.isLoading=!1,e.paginationConf={currentPage:1,itemsPerPage:15,pagesLength:9},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.searchKey={online:!0,offline:!0,keyword:""},e.getNodesByParamFuzzy=function(){setTimeout(function(){e.zTree.getNodesByParamFuzzy(e.searchKey,"areaTree","radioSiteTree")},10)},e.getNodesByParamFuzzy=function(t,i,n){e.zTree.getNodesByParamFuzzy(t,i,n,function(){a("areaTree")})},e.toBatteryDetail=function(e){location.hash="#/battery/device?deviceId="+e,t.util.browserInfo.isIE&&window.location.reload()},function(){e.target=t.util.getToggleParam("navTreeTarget",[".nav-tree"]),e.other=t.util.getToggleParam("navTreeOther",[".right-top",".right-bottom"])}(),function(){e.treeLoading=!0,n.getSiteMapTree({},function(t){e.treeLoading=!1,e.zTree=n.createZTree(t),n.initTree(e.zTree.zNodes,"areaTree","radioSiteTree",function(){a("areaTree")}),n.checkNodeBySiteId("areaTree",i.siteId)})}(),function(){o.getBatteryQueryList(function(t){e.query.conditions=t})}()}]);