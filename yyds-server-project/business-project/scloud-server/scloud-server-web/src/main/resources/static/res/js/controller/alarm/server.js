scloudApp.controller("alarmServerController",["$scope","$rootScope","$filter","serverService",function(e,a,t,r){function i(){if(!e.alarmQuery.startTime||!e.alarmQuery.endTime){var a=new Date;a.setDate(a.getDate()+1),e.alarmQuery.endTime=t("date")(a,"yyyy/MM/dd 00:00:00"),a.setDate(a.getDate()-30),e.alarmQuery.startTime=t("date")(a,"yyyy/MM/dd 00:00:00")}e.isLoading=!0,e.alarmQuery.alarmState===e.CURRENT_ALARM?r.getCurrentAlarm(function(a){e.isLoading=!1,e.alarmList=a}):e.alarmQuery.alarmState===e.HISTORY_ALARM&&r.getHistoryAlarm(e.alarmQuery,function(a){e.isLoading=!1,e.alarmList=a})}function n(e){r.getPerformance(function(a){!function(e,a){for(var t=0;t<4;t++)e[t].push(a[t]),e[t].length>100&&e[t].shift()}(e,[t("date")(new Date(a.recordTime),"HH:mm:ss"),a.cpuRate.toFixed(2),a.memoryRate.toFixed(2),a.fileRate.toFixed(2)]),s(e)})}function s(a){null===l?(m=chart.serverDataGauge({id:"serverDataGauge",nameList:["CPU","内存","硬盘"],axisLineColorList:[[[e.serverData.cpu/100,"#91c7ae"],[1,"#c23531"]],[[e.serverData.memory/100,"#91c7ae"],[1,"#c23531"]],[[e.serverData.disk/100,"#91c7ae"],[1,"#c23531"]]],data:[a[1][0],a[2][0],a[3][0]]}),l=chart.serverDataLine({id:"serverDataLine",nameList:["CPU","内存","硬盘"],xList:a[0],yList:[a[1],a[2],a[3]],dataZoom:{show:!1}})):(m.setOption({series:[{axisLine:{lineStyle:{color:[[e.serverData.cpu/100,"#91c7ae"],[1,"#c23531"]]}},data:[{name:"CPU",value:a[1][a[1].length-1]}]},{axisLine:{lineStyle:{color:[[e.serverData.memory/100,"#91c7ae"],[1,"#c23531"]]}},data:[{name:"内存",value:a[2][a[2].length-1]}]},{axisLine:{lineStyle:{color:[[e.serverData.disk/100,"#91c7ae"],[1,"#c23531"]]}},data:[{name:"硬盘",value:a[3][a[3].length-1]}]}]}),l.setOption({xAxis:[{data:a[0]},{data:a[0]},{data:a[0]}],series:[{name:"CPU",data:a[1]},{name:"内存",data:a[2]},{name:"硬盘",data:a[3]}]}))}$state&&($state=window.$state),$stateParams&&($stateParams=window.$stateParams),e.CURRENT_ALARM=a.CONST.alarmStateList[0].key,e.HISTORY_ALARM=a.CONST.alarmStateList[1].key,e.alarmQuery={alarmState:e.CURRENT_ALARM},e.isLoading=!1,e.query=function(){i()},e.reset=function(){e.alarmQuery={alarmState:e.CURRENT_ALARM}};var o=[[],[],[],[]],l=null,m=null;!function(){r.getServerThreshold(function(a){e.serverData={cpu:a.cpuThreshold,memory:a.memoryThreshold,disk:a.fileThreshold},n(o),window.timerTaskManager.create(function(){n(o)},5e3,!1)})}(),i()}]);