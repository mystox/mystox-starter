scloudApp.controller("backServerController",["$scope","$rootScope","$filter","serverService",function(e,r,a,t){function o(){t.getServerThreshold(function(r){e.serverData={cpu:r.cpuThreshold,memory:r.memoryThreshold,disk:r.fileThreshold},e.modifyServerThreshold.obj=angular.copy(e.serverData),s(c),window.timerTaskManager.create(function(){s(c)},5e3,!1)})}function s(e){t.getPerformance(function(r){!function(e,r){for(var a=0;a<4;a++)e[a].push(r[a]),e[a].length>100&&e[a].shift()}(e,[a("date")(new Date(r.recordTime),"HH:mm:ss"),r.cpuRate.toFixed(2),r.memoryRate.toFixed(2),r.fileRate.toFixed(2)]),i(e)})}function i(r){null===l?(u=chart.serverDataGauge({id:"serverDataGauge",nameList:["CPU","内存","硬盘"],axisLineColorList:[[[e.serverData.cpu/100,"#91c7ae"],[1,"#c23531"]],[[e.serverData.memory/100,"#91c7ae"],[1,"#c23531"]],[[e.serverData.disk/100,"#91c7ae"],[1,"#c23531"]]],data:[r[1][0],r[2][0],r[3][0]]}),l=chart.serverDataLine({id:"serverDataLine",nameList:["CPU","内存","硬盘"],xList:r[0],yList:[r[1],r[2],r[3]],dataZoom:{show:!1}})):(u.setOption({series:[{axisLine:{lineStyle:{color:[[e.serverData.cpu/100,"#91c7ae"],[1,"#c23531"]]}},data:[{name:"CPU",value:r[1][r[1].length-1]}]},{axisLine:{lineStyle:{color:[[e.serverData.memory/100,"#91c7ae"],[1,"#c23531"]]}},data:[{name:"内存",value:r[2][r[2].length-1]}]},{axisLine:{lineStyle:{color:[[e.serverData.disk/100,"#91c7ae"],[1,"#c23531"]]}},data:[{name:"硬盘",value:r[3][r[3].length-1]}]}]}),l.setOption({xAxis:[{data:r[0]},{data:r[0]},{data:r[0]}],series:[{name:"CPU",data:r[1]},{name:"内存",data:r[2]},{name:"硬盘",data:r[3]}]}))}function n(){if(!e.serverQuery.startTime||!e.serverQuery.endTime){var r=new Date;r.setDate(r.getDate()+1),e.serverQuery.endTime=a("date")(r,"yyyy/MM/dd 00:00:00"),r.setDate(r.getDate()-30),e.serverQuery.startTime=a("date")(r,"yyyy/MM/dd 00:00:00")}t.getHistoryPerformance(e.serverQuery,function(e){for(var r=[[],[],[],[]],t=0;t<e.length;t++)r[0].push(a("date")(new Date(e[t].recordTime),"MM-dd HH:mm")),r[1].push(e[t].cpuRate.toFixed(2)),r[2].push(e[t].memoryRate.toFixed(2)),r[3].push(e[t].fileRate.toFixed(2));d(r)})}function d(e){chart.serverDataLine({id:"serverHistoryData",nameList:["CPU","内存","硬盘"],xList:e[0],yList:[e[1],e[2],e[3]],dataZoom:{show:!0,start:100*(1-100/e[0].length),end:100}})}$state&&($state=window.$state),$stateParams&&($stateParams=window.$stateParams),e.serverQuery={};var c=[[],[],[],[]],l=null,u=null;e.modifyServerThreshold={form:{},obj:{},execute:null,clear:null},e.query=function(){n()},e.reset=function(){e.serverQuery={}},e.modifyServerThreshold.execute=function(){t.setServerThreshold(e.modifyServerThreshold.obj,function(r){e.serverData={cpu:r.cpuThreshold,memory:r.memoryThreshold,disk:r.fileThreshold},e.modifyServerThreshold.obj=angular.copy(e.serverData)})},e.modifyServerThreshold.clear=function(){e.modifyServerThreshold.obj=angular.copy(e.serverData)},e.resetServerThreshold=function(){t.resetServerThreshold(function(){o()})},o(),n()}]);