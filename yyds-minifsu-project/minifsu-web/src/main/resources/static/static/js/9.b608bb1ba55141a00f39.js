webpackJsonp([9],{VG4s:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("aA9S"),n=a.n(i),r={name:"s-sites",props:{},data:function(){return{searcher:{sn:""},multipleSelection:[],fsuList:[],columns:[{label:"SN 编码",value:"sN",filter:"nullFilter",className:""},{label:"绑定状态",value:"bindMark",filter:"bindMarkFilter",className:""},{label:"在线状态",value:"status",filter:"statusFilter",className:""},{label:"已绑定FSU ID",value:"fsuId",filter:"nullFilter",className:""},{label:"SN 别名",value:"name",filter:"nullFilter",className:""},{label:"适配层版本号",value:"adapterVer",filter:"nullFilter",className:""},{label:"引擎版本号",value:"engineVer",filter:"nullFilter",className:""}],modifyCont:{},typeList:[{label:"引擎",value:1},{label:"适配层",value:2}],pagination:{total:0,currentPage:1,pageSize:15,onChange:this.onPaginationChanged},upgradeParam:{type:null,documentObj:""},loading:!1,allDocument:[],documentList:[],disabled:!0,upgradeDialogVisible:!1,compilerInfo:{engine:"",program:""}}},computed:{optionBind:function(){return{name:"绑定",form:{"SN ID":[{type:"span",text:this.modifyCont.sN,rule:{}}],"FSU ID":[{type:"input",name:"fsuId",defaultValue:this.modifyCont.fsuId||"",disabled:!0,rule:{}}],"FSU 设备列表":[{type:"textarea",name:"devIds",rows:8,rule:{}}]},clearText:this.$t("OPERATION.CLEAR"),clear:this.clear,executeText:this.$t("OPERATION.CONFIRM"),execute:this.executeModify,style:{}}}},methods:{addMockData:function(){for(var e=0;e<10;e++)this.fsuList.push({username:"某某某",password:"123456",group_name:"城管大队一组",comment:"**********",sN:"123123123123123123"});this.pagination.total=this.fsuList.length},getFsuList:function(){var e=this,t={sn:this.searcher.sn,page:this.pagination.currentPage,count:this.pagination.pageSize};this.$api.getFsuList(t).then(function(t){t.data&&(e.pagination.total=t.data.totalSize,e.fsuList=t.data.list,e.loading=!1)},function(t){t&&(e.loading=!1)})},getDocumentList:function(){var e=this;this.$api.getDocumentList().then(function(t){e.allDocument=t.data}.bind(this))},handleChange:function(e){var t=this;this.upgradeParam.documentObj={},this.documentList=this.allDocument.filter(function(t){return t.name===(1===e?"engine":"program")})[0].list,0!==this.documentList.length&&this.documentList.forEach(function(e){t.$set(e,"label",e.name),t.$set(e,"value",e)})},compiler:function(){var e=this,t=this.upgradeParam.documentObj.name,a=this.upgradeParam.documentObj.url,i={url:"http://"+window.location.host+"/"+a,name:t,type:this.upgradeParam.type,md5:"sdfwefwefwef"};this.$api.compiler(i,this.modifyCont.sN).then(function(t){1===t.data.result&&(1===e.upgradeParam.type?(e.compilerInfo.engine="编译成功,文件名为"+t.data.fileName+",文件大小为"+t.data.totalLen,e.delOption(1),e.paramForUpgradeEngine={file:{fileName:t.data.fileName,totalLen:t.data.totalLen,type:e.upgradeParam.type,md5:"12342jlagjkljl24gajklgj"}}):2===e.upgradeParam.type&&(e.compilerInfo.program="编译成功,文件名为"+t.data.fileName+",文件大小为"+t.data.totalLen,e.delOption(2),e.paramForUpgradeProgram={file:{fileName:t.data.fileName,totalLen:t.data.totalLen,type:e.upgradeParam.type,md5:"12342jlagjkljl24gajklgj"}})),e.$refs.upgradeDialog.resetFields()}.bind(this))},delOption:function(e){this.typeList=this.typeList.filter(function(t){return t.value!=e})},upgrade:function(){var e=this;this.compilerInfo.engine&&this.$api.upgrade(this.paramForUpgradeEngine,this.modifyCont.sN).then(function(t){e.upgradeDialogVisible=!1}),this.$nextTick(function(){e.compilerInfo.program&&e.$api.upgrade(e.paramForUpgradeProgram,e.modifyCont.sN).then(function(t){e.upgradeDialogVisible=!1})})},handleCancel:function(){this.upgradeDialogVisible=!1,this.$refs.upgradeDialog.resetFields(),this.compilerInfo={engine:"",program:""},this.typeList=[{label:"引擎",value:1},{label:"适配层",value:2}]},onPaginationChanged:function(e){this.pagination.pageSize=e.pageSize,this.pagination.currentPage=e.currentPage,this.getFsuList()},handleSelectionChange:function(e){this.multipleSelection=this.comFunc.map(e,"username")},intoNextPage:function(){},executeAdd:function(e){},executeModify:function(e){this.modifyCont=n()({},this.modifyCont,e),e.devIds&&(this.modifyCont.devIds=e.devIds.split("\n")),this.setFsu(this.modifyCont)},executeUpgrade:function(e){this.upgradeParam=n()({},e),this.upgrade()},clear:function(e){},showDialog:function(e,t){t&&(this.modifyCont=t),this.$refs[e]&&this.$refs[e].toModal()},showUpgradeDialog:function(e){e&&(this.modifyCont=e),this.upgradeDialogVisible=!0},setFsu:function(e){var t=this,a={fsuId:e.fsuId,devCodeList:e.devIds||[],sn:e.sN,name:e.name,address:e.address,setUpTime:(new Date).getTime(),vpnName:"全国7",fsuClass:e.fsuClass,imsi:e.imsi,operators:e.operaters,heartCycle:e.heartCycle,businessRhythm:e.businessRhythm,runStatusRhythm:e.runStatusRhythm,alarmRhythm:e.alarmRhythm,coordinate:e.coordinate};this.$api.setFsu(a).then(function(e){t.getFsuList()})},unbind:function(e){var t=this,a={fsuId:e.fsuId};this.$api.unbind(a,e.sN).then(function(e){t.getFsuList()})}},mounted:function(){this.getFsuList(!0),this.getDocumentList()}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"fsuList flex-column"},[a("operation-bar-layout",{staticStyle:{}},[a("div",{attrs:{slot:"query"},slot:"query"},[a("el-form",{ref:"searcher",attrs:{model:e.searcher,"label-position":"right",inline:!0}},[a("el-form-item",{attrs:{label:"SN",prop:"sn","label-width":"35px"}},[a("el-input",{attrs:{placeholder:"请输入SN"},model:{value:e.searcher.sn,callback:function(t){e.$set(e.searcher,"sn","string"==typeof t?t.trim():t)},expression:"searcher.sn"}})],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"operate"},slot:"operate"},[a("el-button",{attrs:{type:"primary"},on:{click:e.getFsuList}},[e._v("查询")])],1)]),e._v(" "),a("table-box",{staticClass:"flex-1",attrs:{"row-class-name":"cursor-point","row-click":e.intoNextPage,loading:e.loading,stripe:!0,border:!0,pagination:e.pagination,data:e.fsuList},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),e._l(e.columns,function(t){return a("el-table-column",{key:t.label,attrs:{formatter:e.$tableFilter(t.filter),prop:t.value,label:t.label,"min-width":t.width,fixed:t.fixed,className:t.className,resizable:!1}})}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("SECURITY.USER.OPERATION"),width:"550"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("i",{staticStyle:{color:"#20A0FF",cursor:"pointer"},on:{click:function(a){return e.showDialog("bindDialog",t.row)}}},[e._v("/ 绑定")]),e._v(" "),t.row.bindMark?a("i",{staticStyle:{color:"#20A0FF",cursor:"pointer"},on:{click:function(a){return e.unbind(t.row)}}},[e._v("/ 解绑")]):e._e(),e._v(" "),2===t.row.status?a("i",{staticStyle:{color:"#20A0FF",cursor:"pointer"},on:{click:function(a){return e.showUpgradeDialog(t.row)}}},[e._v("/ 升级")]):e._e(),e._v(" "),a("router-link",{staticStyle:{color:"#20A0FF",cursor:"pointer"},attrs:{to:{path:"/devices",query:{sN:t.row.sN}},tag:"span"}},[e._v("\n            / 查看设备\n          ")]),e._v(" "),2===t.row.status?a("router-link",{staticStyle:{color:"#20A0FF",cursor:"pointer"},attrs:{to:{path:"/alarmsForSN",query:{sN:t.row.sN}},tag:"span"}},[e._v("\n            / 实时告警\n          ")]):e._e(),e._v(" "),a("router-link",{staticStyle:{color:"#20A0FF",cursor:"pointer"},attrs:{to:{path:"/fsuInfoList",query:{sN:t.row.sN}},tag:"span"}},[e._v("\n            / SN 运行状态\n          ")]),e._v(" "),a("router-link",{staticStyle:{color:"#20A0FF",cursor:"pointer"},attrs:{to:{path:"/fsuPKT",query:{sN:t.row.sN}},tag:"span"}},[e._v("\n            / SN 终端日志\n          ")])],1)]}}])})],2),e._v(" "),a("el-dialog",{attrs:{title:"升级",visible:e.upgradeDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.upgradeDialogVisible=t},close:e.handleCancel}},[a("el-form",{ref:"upgradeDialog",attrs:{model:e.upgradeParam,"label-width":"125px"}},[a("el-form-item",{attrs:{label:"SN ID"}},[a("span",[e._v(e._s(e.modifyCont.sN))])]),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:0!=e.typeList.length,expression:"typeList.length != 0"}],attrs:{label:"选择升级类型",prop:"type"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{"auto-complete":"off"},on:{change:e.handleChange},model:{value:e.upgradeParam.type,callback:function(t){e.$set(e.upgradeParam,"type",t)},expression:"upgradeParam.type"}},e._l(e.typeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:0!=e.typeList.length,expression:"typeList.length != 0"}],attrs:{label:"选择升级文件",prop:"documentObj"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{"auto-complete":"off",disabled:!e.upgradeParam.type},model:{value:e.upgradeParam.documentObj,callback:function(t){e.$set(e.upgradeParam,"documentObj",t)},expression:"upgradeParam.documentObj"}},e._l(e.documentList,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.upgradeParam.type&&e.upgradeParam.documentObj&&e.upgradeParam.documentObj.name&&0!=e.typeList.length,expression:"upgradeParam.type && (upgradeParam.documentObj && upgradeParam.documentObj.name) && typeList.length != 0"}],attrs:{label:"后端编译"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.compiler}},[e._v(" 编译 ")])],1),e._v(" "),e.compilerInfo.engine?a("el-form-item",{attrs:{label:"引擎编译结果"}},[a("span",[e._v(e._s(e.compilerInfo.engine))])]):e._e(),e._v(" "),e.compilerInfo.program?a("el-form-item",{attrs:{label:"适配层编译结果"}},[a("span",{},[e._v(e._s(e.compilerInfo.program))])]):e._e()],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:!(e.compilerInfo.engine||e.compilerInfo.program)},nativeOn:{click:function(t){return e.upgrade(t)}}},[e._v("确定")])],1)],1),e._v(" "),a("modal",{ref:"bindDialog",attrs:{option:e.optionBind}})],1)},staticRenderFns:[]};var o=a("C7Lr")(r,s,!1,function(e){a("X873")},null,null);t.default=o.exports},X873:function(e,t){}});